<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>11.&nbsp;&#20107;&#21153;&#31649;&#29702;</title><link rel="stylesheet" type="text/css" href="css/manual-multipage.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="Spring Framework Reference Documentation"><link rel="up" href="spring-data-tier.html" title="Part&nbsp;IV.&nbsp;&#25968;&#25454;&#35775;&#38382;"><link rel="prev" href="spring-data-tier.html" title="Part&nbsp;IV.&nbsp;&#25968;&#25454;&#35775;&#38382;"><link rel="next" href="dao.html" title="12.&nbsp;DAO &#25903;&#25345;"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">11.&nbsp;&#20107;&#21153;&#31649;&#29702;</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="spring-data-tier.html">Prev</a>&nbsp;</td><th width="60%" align="center">Part&nbsp;IV.&nbsp;&#25968;&#25454;&#35775;&#38382;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="dao.html">Next</a></td></tr></table><hr></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a name="transaction" href="#transaction"></a>11.&nbsp;&#20107;&#21153;&#31649;&#29702;</h2></div></div></div>

<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="transaction-intro" href="#transaction-intro"></a>11.1&nbsp;Spring Framework&#20107;&#21153;&#31649;&#29702;&#20171;&#32461;</h2></div></div></div>

<p>&#24191;&#27867;&#30340;&#20107;&#21153;&#25903;&#25345;&#26159;Spring Framework&#21560;&#24341;&#20154;&#20204;&#20351;&#29992;&#30340;&#21407;&#22240;&#20043;&#19968;. Spring Framework&#25552;&#20379;&#30340;&#23545;&#20107;&#21153;&#30340;&#19968;&#33268;&#24615;&#25277;&#35937;
&#30340;&#22909;&#22788;&#20307;&#29616;&#22312;&#22914;&#19979;&#26041;&#38754;:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
&#22312;&#19981;&#21516;&#30340;API&#20043;&#38388;&#20351;&#29992;&#19968;&#33268;&#30340;&#32534;&#31243;&#27169;&#22411;, &#22914;Java Transaction API (Java&#20107;&#21153;API, JTA), JDBC, Hibernate,
Java Persistence API (Java&#25345;&#20037;&#21270;API, JPA), &#20197;&#21450; Java Data Objects (JDO).
</li><li class="listitem">
&#25903;&#25345;<a class="link" href="transaction.html#transaction-declarative" title="11.5&nbsp;&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;">&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;</a>.
</li><li class="listitem">
&#23545;<a class="link" href="transaction.html#transaction-programmatic" title="11.6&nbsp;&#32534;&#31243;&#24335;&#20107;&#21153;&#31649;&#29702;">&#21487;&#32534;&#31243;&#20107;&#21153;&#31649;&#29702;</a>&#27604;&#22797;&#26434;&#30340;API, &#22914;JTA,&#25552;&#20379;&#26356;&#31616;&#21333;&#30340;API.
</li><li class="listitem">
&#19982;Spring&#30340;&#25968;&#25454;&#35775;&#38382;&#23618;&#25277;&#35937;&#30340;&#23436;&#32654;&#38598;&#25104;.
</li></ul></div>

<p>&#19979;&#38754;&#30340;&#31456;&#33410;&#21521;&#20320;&#20171;&#32461;Spring Framework&#30340;&#20107;&#21153;&#20215;&#20540;&#25552;&#21319;&#21644;&#25216;&#26415;. (&#26412;&#31456;&#21516;&#26679;&#22218;&#25324;&#20102;&#26368;&#20339;&#23454;&#36341;, &#24212;&#29992;&#38598;&#25104;, &#21644;&#23545;
&#24120;&#35265;&#38382;&#39064;&#30340;&#35299;&#20915;&#26041;&#26696;.)</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<a class="link" href="transaction.html#transaction-motivation" title="11.2&nbsp;Spring Framework&#30340;&#20107;&#21153;&#25903;&#25345;&#27169;&#22411;&#30340;&#20248;&#28857;">Spring Framework&#30340;&#20107;&#21153;&#25903;&#25345;&#27169;&#22411;&#30340;&#20248;&#28857;</a> &#25551;&#36848;&#20102;&#20320; <span class="emphasis"><em>&#20026;&#20160;&#20040;</em></span> &#38656;&#35201;&#22312;EJB
&#30340;&#23481;&#22120;&#31649;&#29702;&#20107;&#21153;(Container-Managed Transactions,CMT)&#20013;&#25110;&#32773;&#20351;&#29992;&#26412;&#22320;&#30340;&#21333;&#29420;API, &#22914;Hibernate,
&#26102;&#20351;&#29992;Spring Framework&#30340;&#20107;&#21153;&#25277;&#35937;&#26469;&#20195;&#26367;Hibernate.
</li><li class="listitem">
<a class="link" href="transaction.html#transaction-strategies" title="11.3&nbsp;&#29702;&#35299; Spring Framework &#30340;&#20107;&#21153;&#25277;&#35937;">&#29702;&#35299;Spring Framework&#20107;&#21153;&#25277;&#35937;</a> &#32473;&#20986;&#20102;&#26680;&#24515;&#31867;, &#24182;&#19988;&#35828;&#26126;&#20102;&#24590;&#26679;&#20174;&#21508;&#31181;
&#25968;&#25454;&#28304;&#20013;&#37197;&#32622;&#21644;&#33719;&#21462;<code class="literal">DataSource</code>&#23454;&#20363;.
</li><li class="listitem">
<a class="link" href="transaction.html#tx-resource-synchronization" title="11.4&nbsp;&#22312;&#20107;&#21153;&#20013;&#21516;&#27493;&#36164;&#28304;">&#20107;&#21153;&#20013;&#30340;&#36164;&#28304;&#21516;&#27493;</a> &#25551;&#36848;&#20102;&#24212;&#29992;&#20195;&#30721;&#24590;&#20040;&#30830;&#20445;&#36164;&#28304;&#26159;created, reused,
&#21644;cleaned up&#23436;&#25104;&#20102;.
</li><li class="listitem">
<a class="link" href="transaction.html#transaction-declarative" title="11.5&nbsp;&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;">&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;</a> &#25551;&#36848;&#20102;&#23545;&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;&#30340;&#25903;&#25345;.
</li><li class="listitem">
<a class="link" href="transaction.html#transaction-programmatic" title="11.6&nbsp;&#32534;&#31243;&#24335;&#20107;&#21153;&#31649;&#29702;">&#21487;&#32534;&#31243;&#20107;&#21153;&#31649;&#29702;</a> &#28085;&#30422;&#20102;&#23545;&#32534;&#31243;&#24335;(&#20063;&#23601;&#26159;&#30452;&#25509;&#20889;&#20195;&#30721;)&#20107;&#21153;&#31649;&#29702;&#30340;&#25903;&#25345;.
</li></ul></div>

</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="transaction-motivation" href="#transaction-motivation"></a>11.2&nbsp;Spring Framework&#30340;&#20107;&#21153;&#25903;&#25345;&#27169;&#22411;&#30340;&#20248;&#28857;</h2></div></div></div>

<p>&#20256;&#32479;&#19978;, Java EE &#24320;&#21457;&#32773;&#22312;&#20107;&#21153;&#31649;&#29702;&#19978;&#26377;&#20004;&#20010;&#36873;&#25321;:<span class="emphasis"><em>&#20840;&#23616;</em></span> &#25110;&#32773; <span class="emphasis"><em>&#26412;&#22320;</em></span> &#20107;&#21153;, &#27599;&#19968;&#20010;&#37117;&#26377;&#20005;&#37325;&#30340;&#23616;&#38480;&#24615;.
&#20851;&#20110;&#20840;&#23616;&#21644;&#26412;&#22320;&#20107;&#21153;&#31649;&#29702;&#30340;&#20171;&#32461;&#23558;&#22312;&#25509;&#19979;&#26469;&#30340;&#20004;&#33410;&#32473;&#20986;, &#23601;&#22312;&#35752;&#35770;Spring Framework&#30340;&#20107;&#21153;&#31649;&#29702;&#25903;&#25345;&#26159;&#24590;&#26679;&#24357;&#34917;
&#36825;&#20123;&#38480;&#21046;&#20043;&#21518;.</p>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-global" href="#transaction-global"></a>11.2.1&nbsp;&#20840;&#23616;&#20107;&#21153;</h3></div></div></div>

<p>&#20840;&#23616;&#24615;&#20107;&#21153;&#21487;&#20197;&#35753;&#20320;&#28151;&#21512;&#20351;&#29992;&#20107;&#21153;&#36164;&#28304;,&#20256;&#32479;&#20851;&#31995;&#22411;&#25968;&#25454;&#24211;&#20197;&#21450;&#28040;&#24687;&#38431;&#21015;. &#24212;&#29992;&#26381;&#21153;&#22120;&#31649;&#29702;&#20107;&#21153;&#26159;&#36890;&#36807;JTA,&#20182;&#30340;API
&#29992;&#36215;&#26469;&#24456;&#31528;&#37325;(&#26469;&#28304;&#20110;&#20182;&#30340;&#24322;&#24120;&#22788;&#29702;&#27169;&#22411;). &#21478;&#22806;, &#19968;&#20010; JTA &#30340;<code class="literal">UserTransaction</code> &#36890;&#24120;&#38656;&#35201;&#30001;JNDI&#25552;&#20379;, &#24847;&#21619;&#30528;
&#20320;&#22312;&#20351;&#29992;JTA&#30340;&#21516;&#26102; <span class="emphasis"><em>&#20063;</em></span>&#38656;&#35201;&#20351;&#29992;JNDI. &#24456;&#26126;&#26174;,&#24403;JTA&#26159;&#24212;&#29992;&#26381;&#21153;&#22120;&#19978;&#21807;&#19968;&#21487;&#29992;&#30340;&#20840;&#23616;&#20107;&#21153;&#26102;,&#20351;&#29992;&#23427;&#20250;&#38480;&#21046;&#20320;
&#23545;&#24212;&#29992;&#20195;&#30721;&#30340;&#37325;&#29992;.</p>
<p>&#21407;&#20808;, &#36739;&#20026;&#25552;&#20513;&#30340;&#20351;&#29992;&#20840;&#23616;&#20107;&#21153;&#30340;&#26041;&#24335;&#26159;&#20351;&#29992;EJB &#30340;<span class="emphasis"><em>CMT</em></span>(<span class="emphasis"><em>&#23481;&#22120;&#31649;&#29702;&#20107;&#21153;,Container Managed Transaction</em></span>):
CMT &#26159;&#19968;&#31181; <span class="emphasis"><em>&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;</em></span> (&#21306;&#21035;&#20110;<span class="emphasis"><em>&#32534;&#31243;&#24335;&#20107;&#21153;&#31649;&#29702;</em></span>)&#30340;&#24418;&#24335;. EJB CMT &#31227;&#38500;&#20102;&#21644;&#20107;&#21153;&#30456;&#20851;&#30340;JNDI
&#21457;&#29616;, &#34429;&#28982;&#20351;&#29992;EJB&#26412;&#36523;&#23601;&#26159;&#38656;&#35201;JNDI&#30340;. &#20182;&#31227;&#38500;&#20102;&#22823;&#22810;&#25968;&#65292;&#20294;&#19981;&#26159;&#25152;&#26377;&#30340;&#38656;&#35201;&#32534;&#20889;Java&#20195;&#30721;&#26469;&#31649;&#29702;&#20107;&#21153;. CMT&#21644;
JTA&#20197;&#21450;&#26576;&#19968;&#31181;&#24212;&#29992;&#26381;&#21153;&#22120;&#29615;&#22659;&#30340;&#32465;&#23450;&#24050;&#32463;&#21576;&#29616;&#19979;&#38477;&#36235;&#21183;&#20102;. &#24403;&#28982;, &#36825;&#21482;&#26377;&#22312;&#20320;&#35745;&#21010;&#36890;&#36807;EJB&#26469;&#23454;&#29616;&#19994;&#21153;&#36923;&#36753;, &#25110;&#32773;
&#33267;&#23569;&#26159;&#36890;&#36807;EJB&#22788;&#29702;&#20107;&#21153;&#30340;&#26102;&#20505;&#26377;&#25928;. EJB&#25972;&#20307;&#30340;&#19981;&#36275;&#26159;&#37027;&#20040;&#26126;&#26174;&#65292;&#36825;&#26159;&#19968;&#20010;&#26080;&#20105;&#35758;&#30340;&#35805;&#39064;,&#23588;&#20854;&#26159;&#22312;&#38754;&#20020;&#30528;&#22768;&#26126;&#24335;
&#20107;&#21153;&#31649;&#29702;&#26377;&#20196;&#20154;&#20449;&#26381;&#30340;&#26367;&#20195;&#21697;&#30340;&#26102;&#20505;.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-local" href="#transaction-local"></a>11.2.2&nbsp;&#26412;&#22320;&#20107;&#21153;</h3></div></div></div>

<p>&#26412;&#22320;&#20107;&#21153;&#26159;&#38024;&#23545;&#29305;&#23450;&#36164;&#28304;&#30340;, &#20363;&#22914;&#19968;&#20010;&#21644;JDBC&#38142;&#25509;&#32465;&#23450;&#22312;&#19968;&#36215;&#30340;&#20107;&#21153;. &#26412;&#22320;&#20107;&#21153;&#26377;&#21487;&#33021;&#29992;&#36215;&#26469;&#26356;&#31616;&#21333;, &#20294;&#26159;&#26377;&#19968;&#20010;
&#26126;&#26174;&#30340;&#24330;&#31471;:&#20182;&#20204;&#19981;&#33021;&#36816;&#34892;&#22312;&#36328;&#22810;&#31181;&#36164;&#28304;&#30340;&#20107;&#21153;&#20013;. &#20030;&#19968;&#20010;&#20363;&#23376;, &#19968;&#20010;&#31649;&#29702;&#20351;&#29992;JDBC&#36830;&#25509;&#30340;&#20107;&#21153;&#30340;&#20195;&#30721;&#19981;&#33021;&#21644;&#20351;&#29992;
&#20840;&#23616;JTA&#20107;&#21153;&#19968;&#36215;&#36816;&#34892;. &#22240;&#20026;&#24212;&#29992;&#26381;&#21153;&#22120;&#24182;&#19981;&#19987;&#27880;&#20110;&#20107;&#21153;&#31649;&#29702;, &#25152;&#20197;&#23427;&#24182;&#19981;&#33021;&#26377;&#21161;&#20110;&#30830;&#20445;&#36328;&#22810;&#31181;&#36164;&#28304;&#20107;&#21153;&#30340;&#27491;&#30830;&#24615;.
(&#35760;&#20303;&#65292;&#26356;&#31967;&#30340;&#26159;&#22823;&#22810;&#25968;&#24212;&#29992;&#20351;&#29992;&#30340;&#26159;&#19968;&#20010;&#21333;&#19968;&#30340;&#20107;&#21153;&#28304;.) &#21478;&#22806;&#30340;&#19968;&#20010;&#19981;&#22909;&#20043;&#22788;&#26159;&#26412;&#22320;&#20107;&#21153;&#37117;&#26159;&#23545;&#32534;&#31243;&#27169;&#22411;&#26377;
&#20405;&#30053;&#24615;&#30340;.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-programming-model" href="#transaction-programming-model"></a>11.2.3&nbsp;Spring Framework&#30340;&#19968;&#33268;&#24615;&#32534;&#31243;&#27169;&#22411;</h3></div></div></div>

<p>Spring&#35299;&#20915;&#20102;&#20840;&#23616;&#21644;&#26412;&#22320;&#20107;&#21153;&#30340;&#24330;&#31471;. &#23427;&#20351;&#24471;&#24212;&#29992;&#24320;&#21457;&#20154;&#21592;<span class="emphasis"><em>&#22312;&#20219;&#20309;&#29615;&#22659;&#20013;</em></span>&#20351;&#29992;<span class="emphasis"><em>&#19968;&#33268;&#30340;</em></span>&#32534;&#31243;&#27169;&#22411;&#25104;&#20026;&#21487;&#33021;.
&#20320;&#21482;&#38656;&#35201;&#32534;&#20889;&#20195;&#30721;&#19968;&#27425;, &#28982;&#21518;&#20320;&#30340;&#20195;&#30721;&#23601;&#21487;&#20197;&#22312;&#19981;&#21516;&#30340;&#29615;&#22659;&#20013;&#36866;&#29992;&#20110;&#19981;&#21516;&#30340;&#20107;&#21153;&#31649;&#29702;. Spring Framework&#21516;&#26102;
&#25552;&#20379;&#20102;&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;&#21644;&#32534;&#31243;&#24335;&#20107;&#21153;&#31649;&#29702;.&#22823;&#22810;&#25968;&#24320;&#21457;&#20154;&#21592;&#26356;&#24895;&#24847;&#20351;&#29992;&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;, &#36825;&#20063;&#26159;&#25512;&#33616;&#30340;&#26041;&#24335;.</p>
<p>&#36890;&#36807;&#32534;&#31243;&#24335;&#20107;&#21153;&#31649;&#29702;, &#24320;&#21457;&#20154;&#21592;&#36890;&#36807;&#19982;Spring Framework&#30340;&#20107;&#21153;&#31649;&#29702;&#25277;&#35937;&#24037;&#20316;, &#23454;&#29616;&#21487;&#20197;&#36816;&#34892;&#20110;&#20219;&#20309;&#24213;&#23618;&#30340;
&#20107;&#21153;&#31649;&#29702;. &#36890;&#36807;&#24314;&#35758;&#30340;&#22768;&#26126;&#24335;&#27169;&#22411;, &#24320;&#21457;&#20154;&#21592;&#36890;&#24120;&#21482;&#20250;&#20889;&#23569;&#37327;&#25110;&#32773;&#19981;&#20889;&#21644;&#20107;&#21153;&#31649;&#29702;&#30456;&#20851;&#30340;&#20195;&#30721;, &#24182;&#19988;&#20174;&#27492;&#19981;&#20250;&#20381;&#36182;&#20110;
Spring Framework&#25110;&#32773;&#20854;&#20182;&#30340;&#20107;&#21153;API.</p>
<div class="sidebar"><div class="titlepage"><div><div><p class="title"><b>&#20320;&#38656;&#35201;&#24212;&#29992;&#26381;&#21153;&#22120;&#26469;&#36827;&#34892;&#20107;&#21153;&#31649;&#29702;&#21527;?</b></p></div></div></div>

<p>Spring Framework&#30340;&#20107;&#21153;&#31649;&#29702;&#25903;&#25345;&#26356;&#25913;&#20256;&#32479;&#30340;&#38480;&#21046;&#32422;&#26463;&#21363;&#20351;&#19968;&#20010;&#20225;&#19994;&#32423;&#30340;Java&#24212;&#29992;&#38656;&#35201;&#19968;&#20010;&#24212;&#29992;&#26381;&#21153;&#22120;.</p>
<p>&#24456;&#26126;&#26174;, &#20320;&#19981;&#38656;&#35201;&#20026;&#20102;&#31616;&#21333;&#30340;&#36890;&#36807;EJB&#26469;&#22768;&#26126;&#20107;&#21153;&#32780;&#38656;&#35201;&#24212;&#29992;&#26381;&#21153;&#22120;. &#20107;&#23454;&#19978;, &#23601;&#31639;&#20320;&#30340;&#24212;&#29992;&#26381;&#21153;&#22120;&#25317;&#26377;&#24378;&#21170;&#30340;JTA
&#33021;&#21147;, &#20320;&#20063;&#24212;&#35813;&#32771;&#34385;&#19979;Spring Framework&#37027;&#27604;EJB&#30340;CMT&#26356;&#21152;&#26377;&#21147;&#21644;&#20855;&#26377;&#29983;&#20135;&#21147;&#30340;&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;&#32534;&#31243;&#27169;&#22411;.</p>
<p>&#36890;&#24120;&#20320;&#21482;&#26377;&#22312;&#20320;&#30340;&#24212;&#29992;&#38656;&#35201;&#24212;&#29992;&#26381;&#21153;&#22120;&#30340;JTA&#33021;&#21147;&#26469;&#22788;&#29702;&#36328;&#36164;&#28304;&#30340;&#22797;&#26434;&#20107;&#21153;, &#32780;&#36825;&#24182;&#19981;&#26159;&#22823;&#22810;&#25968;&#24212;&#29992;&#30340;&#38656;&#27714;. &#35768;&#22810;
&#39640;&#32423;&#24212;&#29992;&#37117;&#26159;&#20351;&#29992;&#30340;&#21333;&#19968;&#30340;&#12289;&#39640;&#24230;&#21487;&#25193;&#23637;&#30340;&#25968;&#25454;&#24211;(&#22914;Oracle&#30340;RAC)&#26469;&#20195;&#26367;&#30340;. &#21333;&#29420;&#30340;&#20107;&#21153;&#31649;&#29702;&#65292;&#22914;
<a class="ulink" href="http://www.atomikos.com/" target="_top">Atomikos Transactions</a> &#21644; <a class="ulink" href="http://jotm.objectweb.org/" target="_top">JOTM</a>&#26159;&#20854;&#20182;&#30340;
&#36873;&#25321;. &#24403;&#28982;, &#20320;&#20063;&#21487;&#33021;&#38656;&#35201;&#20854;&#20182;&#30340;&#24212;&#29992;&#26381;&#21153;&#22120;&#30340;&#21151;&#33021;&#65292;&#22914;Java Message Service (JMS) &#21644;
 Java EE Connector Architecture (JCA).</p>
<p>Spring Framework <span class="emphasis"><em>&#32473;&#20102;&#20320;&#19968;&#20010;&#22312;&#21521;&#19968;&#20010;&#28385;&#36127;&#36733;&#30340;&#24212;&#29992;&#26381;&#21153;&#22120;&#19978;&#28155;&#21152;&#24212;&#29992;&#30340;&#26102;&#30340;&#36873;&#25321;</em></span>. &#20197;&#21069;&#65292;&#22914;&#26524;&#20320;&#19981;&#29992;EJB
&#30340;CMT&#25110;&#32773;JTA, &#37027;&#20040;&#23601;&#21482;&#26377;&#29992;&#36890;&#36807;&#22312;JDBC&#36830;&#25509;&#19978;&#20889;&#26412;&#22320;&#20107;&#29289;&#30340;&#26041;&#24335;&#26367;&#20195;&#65292;&#24182;&#19988;&#22914;&#26524;&#20320;&#27809;&#26377;&#20351;&#29992;&#20840;&#23616;&#30340;&#12289;&#23481;&#22120;&#31649;&#29702;&#30340;
&#20107;&#21153;&#26102;&#26159;&#19968;&#20010;&#24456;&#27785;&#37325;&#30340;&#24037;&#20316;&#65292;&#36825;&#26679;&#30340;&#26085;&#23376;&#29616;&#22312;&#19968;&#21435;&#19981;&#22797;&#36820;&#20102;. &#36890;&#36807;&#20351;&#29992;Spring Framework, &#20320;&#38656;&#35201;&#20462;&#25913;&#30340;&#23601;&#21482;&#26377;
&#37197;&#32622;&#25991;&#20214;&#20013;&#30340;bean&#23450;&#20041;&#65292;&#32780;&#19981;&#26159;&#20320;&#30340;&#20195;&#30721;.</p>
</div>

</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="transaction-strategies" href="#transaction-strategies"></a>11.3&nbsp;&#29702;&#35299; Spring Framework &#30340;&#20107;&#21153;&#25277;&#35937;</h2></div></div></div>

<p>Spring&#20107;&#29289;&#25277;&#35937;&#30340;&#20851;&#38190;&#23601;&#26159;<span class="emphasis"><em>&#20107;&#21153;&#31574;&#30053;</em></span>&#30340;&#27010;&#24565;. &#20107;&#21153;&#31574;&#30053;&#22312;&#25509;&#21475;
<code class="literal">org.springframework.transaction.PlatformTransactionManager</code>&#20013;&#23450;&#20041;:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> PlatformTransactionManager {

    TransactionStatus getTransaction(
            TransactionDefinition definition) <span class="hl-keyword">throws</span> TransactionException;

    <span class="hl-keyword">void</span> commit(TransactionStatus status) <span class="hl-keyword">throws</span> TransactionException;

    <span class="hl-keyword">void</span> rollback(TransactionStatus status) <span class="hl-keyword">throws</span> TransactionException;
}</pre>

<p>&#36825;&#26159;&#19968;&#20010;&#20027;&#35201;&#30340;&#30340;&#26381;&#21153;&#25552;&#20379;&#25509;&#21475;(service provider interface,SPI), &#23613;&#31649;&#23427;&#21487;&#20197;&#22312;&#20320;&#30340;&#24212;&#29992;&#20013;&#20197;
<a class="link" href="transaction.html#transaction-programmatic-ptm" title="11.6.2&nbsp;PlatformTransactionManager&#30340;&#20351;&#29992;">&#32534;&#31243;&#24335;</a>&#30340;&#26041;&#24335;&#20351;&#29992;. &#22240;&#20026;<code class="literal">PlatformTransactionManager</code>&#26159;&#19968;&#20010;
<span class="emphasis"><em>&#25509;&#21475;</em></span>, &#25152;&#20197;&#23427;&#23601;&#24456;&#23481;&#26131;&#22312;&#24517;&#35201;&#26102;&#34987;&#26356;&#25442;&#25110;&#32773;&#20462;&#25913;. &#23427;&#27809;&#26377;&#21644;&#20219;&#20309;&#19968;&#31181;&#21457;&#29616;&#31574;&#30053;&#32465;&#23450;&#65292;&#22914;JNDI.
<code class="literal">PlatformTransactionManager</code>&#30340;&#23454;&#29616;&#23450;&#20041;&#36215;&#26469;&#23601;&#21644;Spring Framework&#30340;&#25511;&#21046;&#21453;&#36716;(IoC)&#23481;&#22120;&#20013;&#20854;&#20182;&#30340;
object(&#25110;&#32773; bean)&#19968;&#26679;. &#36825;&#20010;&#29305;&#24615;&#20351;&#24471;Spring Framework&#30340;&#20107;&#21153;&#31649;&#29702;&#26159;&#19968;&#20010;&#24456;&#26377;&#29992;&#30340;&#25277;&#35937;&#21363;&#20351;&#26159;&#20320;&#29992;&#23427;&#26469;&#21644;
JTA&#19968;&#36215;&#20351;&#29992;&#30340;&#26102;&#20505;. &#26377;&#20851;&#20107;&#21153;&#30340;&#20195;&#30721;&#27979;&#35797;&#36215;&#26469;&#20063;&#27604;&#30452;&#25509;&#20351;&#29992;JTA&#26356;&#21152;&#31616;&#21333;.</p>
<p>&#21448;&#19968;&#39033;&#31526;&#21512;Spring&#21746;&#23398;&#30340;&#26159;, &#21487;&#20197;&#30001;<code class="literal">PlatformTransactionManager</code>&#25509;&#21475;&#30340;&#20219;&#20309;&#26041;&#27861;&#25243;&#20986;&#26469;&#30340;
<code class="literal">TransactionException</code>&#24322;&#24120;&#30340;&#31867;&#22411;&#26159;<span class="emphasis"><em>&#26410;&#26816;&#26597;&#30340;(unchecked)</em></span>(&#36825;&#26159;&#35828;, &#23427;&#32487;&#25215;&#33258;
<code class="literal">java.lang.RuntimeException</code>&#31867;&#30340;). &#20107;&#21153;&#31649;&#29702;&#24213;&#23618;&#30340;&#22833;&#36133;&#24448;&#24448;&#37117;&#26159;&#33268;&#21629;&#30340;. &#22312;&#19968;&#20123;&#32597;&#35265;&#30340;&#24773;&#20917;&#19979;,&#24212;&#29992;&#30340;&#20195;&#30721;
&#26159;&#24573;&#30053;&#20107;&#21153;&#30340;&#22833;&#36133;&#30340;, &#36825;&#26102;&#24212;&#29992;&#30340;&#24320;&#21457;&#20154;&#21592;&#20173;&#28982;&#21487;&#20197;&#26377;&#36873;&#25321;&#22320;&#25429;&#33719;&#24182;&#22788;&#29702;<code class="literal">TransactionException</code>. &#20851;&#38190;&#26159;
&#24320;&#21457;&#32773;&#27809;&#26377;&#34987;<span class="emphasis"><em>&#24378;&#36843;</em></span>&#37027;&#20040;&#20570;.</p>
<p>&#36820;&#22238;&#19968;&#20010;<code class="literal">TransactionStatus</code>&#23545;&#35937;&#30340;<code class="literal">getTransaction(..)</code>&#26041;&#27861;&#38656;<code class="literal">TransactionDefinition</code>&#21442;&#25968;. &#36820;&#22238;&#30340;
<code class="literal">TransactionStatus</code>&#21487;&#33021;&#20195;&#34920;&#20102;&#19968;&#20010;&#26032;&#30340;&#20107;&#21153;, &#20063;&#26377;&#21487;&#33021;&#26159;&#20195;&#34920;&#20102;&#19968;&#20010;&#24050;&#32463;&#23384;&#22312;&#30340;&#20107;&#21153;, &#22914;&#26524;&#22312;&#35843;&#29992;&#26632;&#20013;&#26377;
&#24050;&#32463;&#23384;&#22312;&#30340;&#20107;&#21153;&#30456;&#21305;&#37197;&#30340;&#35805;. &#21518;&#32773;&#30340;&#19968;&#31181;&#20363;&#23376;&#23601;&#26159;, &#22312;Java EE&#30340;&#20107;&#21153;&#19978;&#19979;&#25991;&#20013;&#26377;&#19968;&#20010;<code class="literal">TransactionStatus</code>&#21644;
&#25191;&#34892;<span class="emphasis"><em>&#32447;&#31243;</em></span>&#30456;&#20851;.</p>
<p>&#25509;&#21475;<code class="literal">TransactionDefinition</code>&#30340;&#23450;&#20041;:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<span class="emphasis"><em>&#29420;&#31435;&#24615;(Isolation)</em></span>: &#23450;&#20041;&#24403;&#21069;&#20107;&#21153;&#21644;&#20854;&#20182;&#24037;&#20316;&#30340;&#20107;&#21153;&#29420;&#31435;&#30340;&#31243;&#24230;. &#20363;&#22914;, &#24403;&#21069;&#20107;&#21153;&#33021;&#21542;&#24863;&#30693;&#21040;&#20854;&#20182;&#20107;&#21153;
&#26410;&#25552;&#20132;&#30340;&#20889;&#35831;&#27714;?
</li><li class="listitem">
<span class="emphasis"><em>&#20256;&#25773;&#24615;(Propagation)</em></span>: &#36890;&#24120;, &#22312;&#19968;&#20010;&#20107;&#21153;&#30340;&#33539;&#22260;&#20869;&#25191;&#34892;&#30340;&#20195;&#30721;&#20063;&#37117;&#22312;&#37027;&#20010;&#20107;&#21153;&#37324;&#38754;&#25191;&#34892;. &#28982;&#32780;, &#20320;&#21487;&#20197;
&#25317;&#26377;&#23450;&#20041;&#24403;&#19968;&#20010;&#20107;&#21153;&#30456;&#20851;&#30340;&#26041;&#27861;&#22312;&#19968;&#20010;&#20107;&#21153;&#19978;&#19979;&#25991;&#24050;&#32463;&#23384;&#22312;&#26102;&#30340;&#34892;&#20026;. &#20363;&#22914;, &#20195;&#30721;&#21487;&#20197;&#22312;&#24050;&#32463;&#23384;&#22312;&#30340;&#20107;&#21153;&#20013;&#32487;&#32493;
&#36816;&#34892;(&#36890;&#24120;&#24773;&#20917;&#37117;&#26159;); &#25110;&#32773;&#23558;&#37027;&#24050;&#32463;&#23384;&#22312;&#30340;&#20107;&#21153;&#25346;&#36215;&#28982;&#21518;&#26032;&#24314;&#19968;&#20010;&#20107;&#21153;. <span class="emphasis"><em>Spring&#25552;&#20379;&#25152;&#26377;&#21644;EJB CMT&#30456;&#20284;&#30340;
&#20107;&#21153;&#20256;&#25773;&#23646;&#24615;&#36873;&#39033;</em></span>. &#35201;&#20102;&#35299;&#21644;&#20107;&#21153;&#30456;&#20851;&#30340;&#20256;&#25773;&#23646;&#24615;&#30340;&#35821;&#20041;&#25551;&#36848;, &#35831;&#26597;&#30475;<a class="xref" href="transaction.html#tx-propagation" title="11.5.7&nbsp;&#20107;&#21153;&#20256;&#25773;&#24615;">Section&nbsp;11.5.7, &#8220;&#20107;&#21153;&#20256;&#25773;&#24615;&#8221;</a>.
</li><li class="listitem">
<span class="emphasis"><em>&#36229;&#26102;(Timeout)</em></span>: &#20107;&#21153;&#22810;&#38271;&#26102;&#38388;&#20250;&#35745;&#26102;&#24402;&#38646;&#24182;&#33258;&#21160;&#35843;&#29992;&#24213;&#23618;&#20107;&#21153;&#21333;&#20803;&#36827;&#34892;&#22238;&#28378;.
</li><li class="listitem">
<span class="emphasis"><em>&#21482;&#35835;&#29366;&#24577;(Read-only status)</em></span>: &#19968;&#20010;&#35774;&#32622;&#20102;&#21482;&#35835;&#30340;&#20107;&#21153;&#21487;&#20197;&#22312;&#20320;&#30340;&#20195;&#30721;&#38656;&#35201;&#35835;&#20294;&#26159;&#21364;&#19981;&#20250;&#20462;&#25913;&#25968;&#25454;&#30340;&#26102;&#20505;
&#20351;&#29992;. &#21482;&#35835;&#30340;&#20107;&#21153;&#22312;&#36827;&#34892;&#29992;&#20363;&#20248;&#21270;&#30340;&#26102;&#20505;&#24456;&#26377;&#29992;, &#20363;&#22914;&#24403;&#20320;&#20351;&#29992;Hibernate&#30340;&#26102;&#20505;.
</li></ul></div>

<p>&#36825;&#20123;&#35774;&#32622;&#37117;&#26159;&#21644;&#26631;&#20934;&#30340;&#20107;&#21153;&#30456;&#20851;&#30340;&#27010;&#24565;&#30456;&#20851;&#32852;&#30340;. &#22914;&#26377;&#24517;&#35201;, &#21442;&#32771;&#35752;&#35770;&#20107;&#21153;&#29420;&#31435;&#31561;&#32423;&#21644;&#20854;&#20182;&#30340;&#26377;&#20851;&#20107;&#21153;&#30340;&#27010;&#24565;&#30340;&#36164;&#28304;.
&#29702;&#35299;&#36825;&#20123;&#27010;&#24565;&#26159;&#20351;&#29992;Spring Framework&#25110;&#32773;&#20854;&#20182;&#20219;&#20309;&#20107;&#21153;&#31649;&#29702;&#35299;&#20915;&#26041;&#26696;&#30340;&#22522;&#30784;.</p>
<p>&#25509;&#21475;<code class="literal">TransactionStatus</code>&#25552;&#20379;&#20102;&#19968;&#20010;&#20107;&#21153;&#30456;&#20851;&#20195;&#30721;&#25805;&#25511;&#20107;&#21153;&#25191;&#34892;&#21644;&#26597;&#35810;&#20107;&#21153;&#29366;&#24577;&#30340;&#31616;&#21333;&#26041;&#27861;. &#23427;&#30340;&#23450;&#20041;&#20063;&#24456;&#29087;&#24713;,
&#23601;&#21644;&#20854;&#20182;&#25152;&#26377;&#30340;&#20107;&#21153;&#31649;&#29702;API&#19968;&#26679;:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> TransactionStatus <span class="hl-keyword">extends</span> SavepointManager {

    <span class="hl-keyword">boolean</span> isNewTransaction();

    <span class="hl-keyword">boolean</span> hasSavepoint();

    <span class="hl-keyword">void</span> setRollbackOnly();

    <span class="hl-keyword">boolean</span> isRollbackOnly();

    <span class="hl-keyword">void</span> flush();

    <span class="hl-keyword">boolean</span> isCompleted();

}</pre>

<p>&#19981;&#31649;&#20320;&#26159;&#22312;Spring&#20013;&#20351;&#29992;&#22768;&#26126;&#24335;&#36824;&#26159;&#32534;&#31243;&#24335;&#20107;&#21153;&#31649;&#29702;, &#23450;&#20041;&#27491;&#30830;&#30340;<code class="literal">PlatformTransactionManager</code>&#30340;&#23454;&#29616;&#37117;&#26159;
&#32477;&#23545;&#27491;&#30830;&#30340;. &#20320;&#36890;&#24120;&#20250;&#36890;&#36807;&#20381;&#36182;&#27880;&#20837;&#30340;&#26041;&#24335;&#23450;&#20041;&#23454;&#29616;.</p>
<p><code class="literal">PlatformTransactionManager</code>&#30340;&#23454;&#29616;&#36890;&#24120;&#38656;&#35201;&#30693;&#36947;&#20182;&#20204;&#25152;&#36816;&#34892;&#30340;&#29615;&#22659;&#26159;&#20160;&#20040;: JDBC, JTA, Hibernate, &#31561;&#31561;.
&#19979;&#38754;&#30340;&#20363;&#23376;&#21521;&#20320;&#23637;&#31034;&#20102;&#24590;&#26679;&#23450;&#20041;&#19968;&#20010;&#26412;&#22320;&#30340;<code class="literal">PlatformTransactionManager</code>&#23454;&#29616;. (&#36825;&#20010;&#20363;&#23376;&#36816;&#34892;&#22312;&#32431;JDBC
&#29615;&#22659;&#20013;.)</p>
<p>&#20320;&#21487;&#20197;&#36825;&#26679;&#23450;&#20041;&#19968;&#20010;&#20351;&#29992;JDBC&#30340;<code class="literal">DataSource</code></p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"dataSource"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.apache.commons.dbcp.BasicDataSource"</span> <span class="hl-attribute">destroy-method</span>=<span class="hl-value">"close"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"driverClassName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${jdbc.driverClassName}"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"url"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${jdbc.url}"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"username"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${jdbc.username}"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"password"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"${jdbc.password}"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>

<p>&#30456;&#20851;&#32852;&#30340;<code class="literal">PlatformTransactionManager</code>&#23454;&#20363;&#23450;&#20041;&#23558;&#20250;&#24341;&#29992;&#36825;&#20010;<code class="literal">DataSource</code>&#30340;&#23450;&#20041;. &#23427;&#30475;&#36215;&#26469;&#23558;&#20687;&#36825;&#26679;:</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"txManager"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"dataSource"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"dataSource"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>

<p>&#22914;&#26524;&#20320;&#23454;&#22312;&#19968;&#20010;Java EE&#30340;&#29615;&#22659;&#20013;&#20351;&#29992;JTA&#23558;&#20351;&#29992;&#23481;&#22120;&#20013;&#30340;<code class="literal">DataSource</code>, &#36890;&#36807;JNDI&#26469;&#33719;&#21462;, &#23558;&#21644;Spring&#30340;
<code class="literal">JtaTransactionManager</code>&#32467;&#21512;&#36215;&#26469;. &#36825;&#23601;&#26159;&#20026;&#20160;&#20040;&#20351;&#29992;JTA&#21644;JNDI&#30340;&#29256;&#26412;&#30475;&#36215;&#26469;&#20687;&#36825;&#26679;:</p>
<pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xmlns:jee</span>=<span class="hl-value">"http://www.springframework.org/schema/jee"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/jee
        http://www.springframework.org/schema/jee/spring-jee.xsd"</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;jee:jndi-lookup</span> <span class="hl-attribute">id</span>=<span class="hl-value">"dataSource"</span> <span class="hl-attribute">jndi-name</span>=<span class="hl-value">"jdbc/jpetstore"</span><span class="hl-tag">/&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"txManager"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.transaction.jta.JtaTransactionManager"</span><span class="hl-tag"> /&gt;</span>

    <span class="hl-comment">&lt;!-- other &lt;bean/&gt; definitions here --&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre>

<p><code class="literal">JtaTransactionManager</code>&#19981;&#38656;&#35201;&#30693;&#36947;<code class="literal">DataSource</code>&#25110;&#32773;&#20854;&#20182;&#30340;&#20851;&#20110;&#25968;&#25454;&#28304;&#30340;&#23450;&#20041;, &#22240;&#20026;&#23427;&#30452;&#25509;&#20351;&#29992;&#23481;&#22120;&#30340;
&#20840;&#23616;&#20107;&#21153;&#31649;&#29702;&#22522;&#30784;.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>&#19978;&#38754;&#30340;&#20851;&#20110;<code class="literal">dataSource</code>&#30340;&#23450;&#20041;&#20351;&#29992;&#20102;&#26469;&#33258;<code class="literal">jee</code>&#21629;&#21517;&#31354;&#38388;&#30340;<code class="literal">&lt;jndi-lookup/&gt;</code>&#26631;&#31614;. &#35201;&#20102;&#35299;&#26356;&#22810;&#30340;&#20851;&#20110;&#22522;&#20110;
schema&#30340;&#37197;&#32622;, &#35831;&#26597;&#30475;<a class="xref" href="xsd-config.html" title="33.&nbsp;XML Schema-based configuration">Chapter&nbsp;33, <i>XML Schema-based configuration</i></a>, &#22914;&#26524;&#35201;&#20102;&#35299;&#26356;&#22810;&#20851;&#20110;<code class="literal">&lt;jee/&gt;</code>&#30340;&#26631;&#31614;&#30340;&#20449;&#24687;&#35831;&#26597;&#30475;
<a class="xref" href="xsd-config.html#xsd-config-body-schemas-jee" title="33.2.3&nbsp;the jee schema">Section&nbsp;33.2.3, &#8220;the jee schema&#8221;</a>.</p>
</td></tr></table></div>

<p>&#20320;&#20063;&#21487;&#20197;&#24819;&#19979;&#38754;&#30340;&#20363;&#23376;&#19968;&#26679;&#38750;&#24120;&#26041;&#20415;&#22320;&#20351;&#29992;Hibernate&#30340;&#26412;&#22320;&#20107;&#21153;. &#22312;&#36825;&#31181;&#24773;&#20917;&#19979;, &#20320;&#38656;&#35201;&#23450;&#20041;&#19968;&#20010;Hibernate&#30340;
<code class="literal">LocalSessionFactoryBean</code>, &#20320;&#30340;&#31243;&#24207;&#20195;&#30721;&#23558;&#36890;&#36807;&#23427;&#26469;&#33719;&#21462;Hibernate&#30340;<code class="literal">Session</code>&#30340;&#23454;&#20363;.</p>
<p>&#20851;&#20110;<code class="literal">DataSource</code>&#30340;&#23450;&#20041;&#23601;&#21644;&#21069;&#38754;&#30340;&#20351;&#29992;&#26412;&#22320;JDBC&#30340;&#20363;&#23376;&#20013;&#30340;&#23450;&#20041;&#19968;&#26679;, &#36825;&#37324;&#20063;&#23601;&#19981;&#20877;&#21015;&#20030;&#20102;.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>&#22914;&#26524;&#34987;&#20219;&#20309;&#30340;&#26080;JTA&#20107;&#21153;&#31649;&#29702;&#20351;&#29992;&#30340;<code class="literal">DataSource</code>&#26159;&#36890;&#36807;JNDI&#21457;&#29616;&#24471;&#21040;&#24182;&#19988;&#21463;Java EE&#23481;&#22120;&#31649;&#29702;&#30340;, &#37027;&#20040;&#23427;&#24212;&#35813;
&#26159;&#19968;&#20010;&#26080;&#20107;&#21153;&#30340;, &#22240;&#20026;Spring Framework&#23558;&#31649;&#29702;&#20107;&#21153;, &#32780;&#19981;&#26159;Java EE&#23481;&#22120;.</p>
</td></tr></table></div>

<p>&#21517;&#31216;&#20026;<code class="literal">txManager</code>&#30340;bean&#22312;&#36825;&#31181;&#26102;&#20505;&#26159;<code class="literal">HibernateTransactionManager</code>&#31867;&#22411;&#30340;. &#23601;&#21644;&#21019;&#24314;
<code class="literal">DataSourceTransactionManager</code>&#23454;&#20363;&#38656;&#35201;<code class="literal">DataSource</code>&#23454;&#20363;&#30340;&#24341;&#29992;&#19968;&#26679;,&#21019;&#24314;
<code class="literal">HibernateTransactionManager</code>&#23454;&#20363;&#38656;&#35201;&#23545;<code class="literal">SessionFactory</code>&#23454;&#20363;&#30340;&#24341;&#29992;.</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"sessionFactory"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.orm.hibernate3.LocalSessionFactoryBean"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"dataSource"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"dataSource"</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"mappingResources"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;list&gt;</span>
            <span class="hl-tag">&lt;value&gt;</span>org/springframework/samples/petclinic/hibernate/petclinic.hbm.xml<span class="hl-tag">&lt;/value&gt;</span>
        <span class="hl-tag">&lt;/list&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"hibernateProperties"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;value&gt;</span>
            hibernate.dialect=${hibernate.dialect}
        <span class="hl-tag">&lt;/value&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"txManager"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.orm.hibernate3.HibernateTransactionManager"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"sessionFactory"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"sessionFactory"</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre>

<p>&#22914;&#26524;&#20320;&#26159;&#22312;&#20351;&#29992;Hibernate&#20197;&#21450;Java EE&#23481;&#22120;&#31649;&#29702;&#30340;JTA&#20107;&#21153;, &#37027;&#20040;&#20320;&#24212;&#35813;&#31616;&#21333;&#30340;&#20351;&#29992;&#20043;&#21069;JTA&#30340;JDBC&#31034;&#20363;&#20195;&#30721;
&#37324;&#38754;&#30340;<code class="literal">JtaTransactionManager</code>.</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"txManager"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.transaction.jta.JtaTransactionManager"</span><span class="hl-tag">/&gt;</span></pre>

<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>&#22914;&#26524;&#20320;&#20351;&#29992;JTA , &#37027;&#20320;&#30340;&#20107;&#21153;&#31649;&#29702;&#22768;&#26126;&#23601;&#20250;&#30475;&#36215;&#26469;&#21644;&#24213;&#23618;&#25968;&#25454;&#35775;&#38382;&#30340;&#25216;&#26415;&#26080;&#20851;&#65292;&#19981;&#31649;&#20182;&#20204;&#26159;JDBC, Hibernate JPA
&#25110;&#32773;&#20854;&#20182;&#30340;&#20309;&#31181;&#21463;&#25903;&#25345;&#30340;&#25216;&#26415;. &#36825;&#20854;&#23454;&#26159;&#22240;&#20026;JTA&#30340;&#20107;&#21153;&#26159;&#20840;&#23616;&#20107;&#21153;, &#23558;&#20250;&#36866;&#37197;&#25152;&#26377;&#30340;&#20107;&#21153;&#22411;&#36164;&#28304;.</p>
</td></tr></table></div>

<p>&#22312;&#36825;&#25152;&#26377;&#30340;&#20363;&#23376;&#20013;&#65292;&#24212;&#29992;&#30340;&#20195;&#30721;&#37117;&#19981;&#38656;&#35201;&#21464;&#21160;. &#20320;&#21487;&#20197;&#21482;&#36890;&#36807;&#26356;&#25913;&#20107;&#21153;&#37197;&#32622;&#26469;&#25913;&#21464;&#20107;&#21153;&#30340;&#31649;&#29702;, &#21363;&#20351;&#36825;&#31181;&#25913;&#21464;&#26159;
&#23545;&#24212;&#30528;&#20107;&#21153;&#20174;&#23616;&#37096;&#31227;&#21160;&#21040;&#20840;&#23616;&#25110;&#32773;&#21453;&#36807;&#26469;.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="tx-resource-synchronization" href="#tx-resource-synchronization"></a>11.4&nbsp;&#22312;&#20107;&#21153;&#20013;&#21516;&#27493;&#36164;&#28304;</h2></div></div></div>

<p>&#29616;&#22312;&#20320;&#24212;&#35813;&#24050;&#32463;&#30693;&#36947;&#24590;&#20040;&#21019;&#24314;&#19981;&#21516;&#30340;&#20107;&#21153;&#31649;&#29702;&#22120;&#20102;, &#24182;&#19988;&#24050;&#32463;&#30693;&#36947;&#20102;&#20182;&#20204;&#26159;&#24590;&#26679;&#23558;&#38656;&#35201;&#19982;&#20107;&#21153;&#21516;&#27493;&#30340;&#36164;&#28304;&#32852;&#31995;&#36215;&#26469;
&#30340;(&#20363;&#22914;<code class="literal">DataSourceTransactionManager</code>&#23545;&#24212;&#19968;&#20010;JDBC&#30340;<code class="literal">DataSource</code>, <code class="literal">HibernateTransactionManager</code>
&#23545;&#24212;&#19968;&#20010;Hibernate&#30340;<code class="literal">SessionFactory</code>, &#31561;&#31561;). &#26412;&#37096;&#20998;&#35762;&#35299;&#31243;&#24207;&#20195;&#30721;&#22914;&#20309;&#30452;&#25509;&#25110;&#32773;&#38388;&#25509;&#22320;&#20351;&#29992;&#25345;&#20037;&#21270;API,
&#22914;JDBC, Hibernate, &#25110;&#32773;JDO, &#24182;&#19988;&#30830;&#20445;&#25152;&#38656;&#35201;&#30340;&#36164;&#28304;&#37117;&#34987;&#27491;&#30830;&#30340;&#21019;&#24314;&#12289;&#37325;&#29992;&#12289;&#28165;&#29702;. &#26412;&#37096;&#20998;&#20063;&#20250;&#27888;&#20262;&#20107;&#21153;
&#21516;&#27493;&#26426;&#21046;&#20043;&#24590;&#26679;&#36890;&#36807;&#21644;<code class="literal">PlatformTransactionManager</code>&#30340;&#20851;&#32852;&#35302;&#21457;(&#21487;&#36873;&#30340;)&#30340;.</p>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="tx-resource-synchronization-high" href="#tx-resource-synchronization-high"></a>11.4.1&nbsp;&#39640;&#32423;&#21516;&#27493;&#26041;&#27861;</h3></div></div></div>

<p>&#39318;&#36873;&#30340;&#26041;&#27861;&#26159;&#20351;&#29992;&#22522;&#20110;Spring&#30340;&#21644;&#25345;&#20037;&#21270;&#38598;&#25104;&#30340;API&#39640;&#32423;&#27169;&#26495;,&#25110;&#32773;&#20351;&#29992;&#21407;&#29983;&#30340;ORM API, &#24212;&#29992;&#20110;&#20107;&#21153;&#25903;&#25345;&#22411;&#24037;&#21378;bean
&#25110;&#32773;&#31649;&#29702;&#21407;&#29983;&#36164;&#28304;&#30340;&#24037;&#21378;&#30340;&#20195;&#29702;. &#36825;&#20123;&#20107;&#21153;&#22411;&#35299;&#20915;&#26041;&#26696;&#20869;&#24314;&#23545;&#36164;&#28304;&#21019;&#24314;&#12289;&#37325;&#29992;&#12289;&#28165;&#29702;&#12289;&#36164;&#28304;&#30340;&#21487;&#36873;&#20107;&#21153;&#21516;&#27493;&#20197;&#21450;
&#24322;&#24120;&#30340;&#26144;&#23556;&#30340;&#25903;&#25345;. &#36825;&#26679;&#29992;&#25143;&#30340;&#25968;&#25454;&#35775;&#38382;&#20195;&#30721;&#23601;&#21487;&#20197;&#19981;&#20877;&#20851;&#24515;&#23450;&#20301;&#20219;&#21153;, &#19987;&#24515;&#20110;&#38750;&#26679;&#26495;&#21270;&#30340;&#25345;&#20037;&#21270;&#36923;&#36753;. &#36890;&#24120;,
&#20320;&#20351;&#29992;&#21407;&#29983;&#30340;ORM API&#25110;&#32773;&#20351;&#29992;<span class="emphasis"><em>&#26679;&#26495;&#21270;</em></span>&#30340;&#26041;&#27861;&#26469;&#36827;&#34892;JDBC&#35775;&#38382;&#30340;&#35805;, &#26159;&#20351;&#29992;<code class="literal">JdbcTemplate</code>. &#36825;&#20010;&#35299;&#20915;&#26041;&#24335;
&#36824;&#20250;&#22312;&#26412;&#21442;&#32771;&#25991;&#26723;&#30340;&#21518;&#32493;&#31456;&#33410;&#20013;&#35814;&#32454;&#20171;&#32461;.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="tx-resource-synchronization-low" href="#tx-resource-synchronization-low"></a>11.4.2&nbsp;&#20302;&#32423;&#30340;&#21516;&#27493;&#26041;&#27861;</h3></div></div></div>

<p>&#20687;<code class="literal">DataSourceUtils</code> (JDBC), <code class="literal">EntityManagerFactoryUtils</code> (JPA),<code class="literal">SessionFactoryUtils</code>(Hibernate),
<code class="literal">PersistenceManagerFactoryUtils</code> (JDO), &#31561;&#31561;&#36825;&#20123;&#31867;&#37117;&#26159;&#23646;&#20110;&#20302;&#32423;&#26041;&#27861;&#20013;&#30340;.&#24403;&#20320;&#30340;&#20195;&#30721;&#24819;&#35201;&#30452;&#25509;&#20351;&#29992;&#37027;
&#26377;&#20851;&#26412;&#22320;&#25345;&#20037;&#21270;&#20107;&#21153;API&#30340;&#26102;&#20505;, &#20320;&#38656;&#35201;&#35753;&#36825;&#20123;&#31867;&#26126;&#30830;Spring Framework&#26694;&#26550;&#31649;&#29702;&#30340;&#23454;&#20363;&#24050;&#32463;&#24471;&#21040;&#20102;&#65292;&#20107;&#21153;&#24050;&#32463;
&#21516;&#27493;&#22909;&#20102;&#65288;&#21487;&#36873;&#30340;&#65289;&#65292;&#24182;&#19988;&#24322;&#24120;&#36816;&#34892;&#20013;&#30340;&#24322;&#24120;&#20063;&#37117;&#20250;&#26144;&#23556;&#21040;&#19968;&#20010;&#19968;&#33268;&#30340;API.</p>
<p>&#20363;&#22914;, &#22312;JDBC&#30340;&#20363;&#23376;&#20013;, &#22312;<code class="literal">DataSource</code>&#20013;&#20195;&#26367;&#20256;&#32479;&#30340;JDBC&#20013;&#30340;<code class="literal">getConnection()</code>&#26041;&#27861;, &#36194;&#22238;&#24863;&#20852;&#36259;&#20351;&#29992;
Spring&#30340;<code class="literal">org.springframework.jdbc.datasource.DataSourceUtils</code>&#31867;&#65292;&#23601;&#20687;&#19979;&#38754;&#36825;&#26679;:</p>
<pre class="programlisting">Connection conn = DataSourceUtils.getConnection(dataSource);</pre>

<p>&#22914;&#26524;&#23384;&#22312;&#19968;&#20010;&#24050;&#32463;&#21644;&#20182;&#21516;&#27493;(&#24050;&#36830;&#25509;)&#30340;&#20107;&#21153;, &#37027;&#23601;&#36820;&#22238;&#23427;. &#21542;&#21017;, &#26041;&#27861;&#23601;&#20250;&#28608;&#21457;&#19968;&#20010;&#35302;&#21457;&#22120;&#21019;&#24314;&#19968;&#20010;&#26032;&#30340;&#36830;&#25509;,
&#24182;&#19988;&#26159;(&#21487;&#36873;&#30340;)&#19982;&#20219;&#20309;&#23384;&#22312;&#30340;&#20107;&#21153;&#21516;&#27493;&#30340;, &#24182;&#19988;&#24050;&#32463;&#20934;&#22791;&#22909;&#22312;&#25509;&#19979;&#26469;&#22312;&#30456;&#21516;&#30340;&#20107;&#21153;&#20013;&#37325;&#29992;. &#23601;&#20687;&#25552;&#21040;&#30340;&#37027;&#26679;, &#25152;&#26377;
&#30340;<code class="literal">SQLException</code>&#37117;&#20250;&#34987;&#21253;&#35013;&#25104;Spring Framework&#30340;<code class="literal">CannotGetJdbcConnectionException</code>, &#36825;&#26159;
Spring Framework&#30340;&#38750;&#26816;&#26597;&#22411;&#25968;&#25454;&#35775;&#38382;&#24322;&#24120;(DataAccessExceptions)&#30340;&#19968;&#31181;&#23618;&#27425;. &#36825;&#20010;&#26041;&#27861;&#32473;&#20320;&#30340;&#20449;&#24687;&#27604;
<code class="literal">SQLException</code>&#32473;&#20320;&#30340;&#20449;&#24687;&#22810;, &#24182;&#19988;&#30830;&#20445;&#36328;&#25968;&#25454;&#24211;, &#21363;&#20351;&#26159;&#19981;&#21516;&#30340;&#25345;&#20037;&#21270;&#25216;&#26415;&#30340;&#21487;&#31227;&#26893;&#24615;.</p>
<p>&#35813;&#26041;&#27861;&#21516;&#26679;&#21487;&#20197;&#29420;&#31435;&#20110;Spring&#20107;&#21153;&#31649;&#29702;&#24037;&#20316;(&#20107;&#21153;&#21516;&#27493;&#26159;&#21487;&#36873;&#30340;), &#25152;&#20197;&#20320;&#21487;&#20197;&#20351;&#29992;&#23427;&#19981;&#31649;&#20320;&#26159;&#20351;&#29992;&#25110;&#32773;&#19981;&#20351;&#29992;
Spring&#30340;&#20107;&#21153;&#31649;&#29702;.</p>
<p>&#24403;&#28982;, &#24403;&#20320;&#20351;&#29992;&#20102;Spring&#30340;JDBC&#25903;&#25345;, JPA&#25903;&#25345;&#25110;&#32773;Hibernate&#25903;&#25345;,&#20320;&#36890;&#24120;&#20250;&#21916;&#27426;&#19981;&#20351;&#29992;<code class="literal">DataSourceUtils</code>
&#25110;&#32773;&#20854;&#20182;&#30340;&#24110;&#21161;&#31867;, &#22240;&#20026;&#20320;&#20250;&#38750;&#24120;&#24841;&#24555;&#30340;&#20351;&#29992;Spring&#30452;&#25509;&#22522;&#20110;&#30456;&#20851;API&#30340;&#25277;&#35937;. &#20363;&#22914;, &#22914;&#26524;&#20320;&#20351;&#29992;Spring&#30340;
<code class="literal">JdbcTemplate</code>&#25110;&#32773;<code class="literal">jdbc.object</code>&#21253;&#26469;&#31616;&#21270;&#20320;&#20351;&#29992;JDBC&#30340;&#20195;&#30721;, &#30495;&#27491;&#30340;&#36830;&#25509;&#37117;&#26159;&#21457;&#29983;&#22312;&#24149;&#21518;&#30340;, &#20320;&#19981;&#38656;&#35201;
&#20146;&#33258;&#20889;&#20195;&#30721;.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="tx-resource-synchronization-tadsp" href="#tx-resource-synchronization-tadsp"></a>11.4.3&nbsp;&#20107;&#21153;&#21457;&#29616;&#25968;&#25454;&#28304;&#20195;&#29702;(TransactionAwareDataSourceProxy)</h3></div></div></div>

<p>&#22312;&#38750;&#24120;&#24213;&#23618;&#23384;&#22312;<code class="literal">TransactionAwareDataSourceProxy</code>&#31867;. &#36825;&#26159;&#19968;&#20010;&#38024;&#23545;<code class="literal">DataSource</code>&#30340;&#20195;&#29702;, &#23427;&#21253;&#35013;&#30446;&#26631;&#30340;
&#25968;&#25454;&#28304;&#26469;&#28155;&#21152;Spring&#30340;&#20107;&#21153;&#31649;&#29702;&#25903;&#25345;. &#22312;&#36825;&#26041;&#38754;, &#20182;&#23601;&#21644;&#24212;&#29992;&#26381;&#21153;&#22120;&#25552;&#20379;&#30340;&#20107;&#21153;&#22411;&#30340;JNDI <code class="literal">DataSource</code>&#26159;&#30456;&#20284;&#30340;.</p>
<p>&#23427;&#24212;&#35813;&#26159;&#20174;&#26469;&#27809;&#24517;&#35201;&#25110;&#19981;&#38656;&#35201;&#20351;&#29992;&#30340;&#31867;, &#38500;&#38750;&#23384;&#22312;&#20195;&#30721;&#24517;&#39035;&#35201;&#36890;&#36807;&#36825;&#31181;&#26041;&#24335;&#35843;&#29992;&#26631;&#20934;&#30340;JDBC&#30340;<code class="literal">DataSource</code>&#25509;&#21475;
&#30340;&#23454;&#29616;. &#37027;&#26679;&#30340;&#35805;, &#36825;&#20010;&#20195;&#30721;&#21487;&#20197;&#24037;&#20316;, &#20294;&#21516;&#26679;&#20351;&#29992;Spring&#31649;&#29702;&#30340;&#20107;&#21153;. &#25512;&#33616;&#20320;&#29992;&#19978;&#38754;&#25552;&#21040;&#30340;&#26356;&#39640;&#23618;&#27425;&#30340;&#25277;&#35937;&#26469;
&#20889;&#26032;&#30340;&#20195;&#30721;.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="transaction-declarative" href="#transaction-declarative"></a>11.5&nbsp;&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;</h2></div></div></div>

<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>&#22823;&#22810;&#25968;Spring Framework&#30340;&#29992;&#25143;&#36873;&#25321;&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;. &#36825;&#31181;&#26041;&#24335;&#23545;&#24212;&#29992;&#20195;&#30721;&#30340;&#24433;&#21709;&#26368;&#23567;, &#24182;&#19988;&#26368;&#31526;&#21512;&#19968;&#20010;<span class="emphasis"><em>&#38750;
&#20405;&#20837;&#22411;</em></span>&#36731;&#37327;&#32423;&#23481;&#22120;&#30340;&#29702;&#24819;.</p>
</td></tr></table></div>

<p>Spring Framework&#30340;&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;&#26159;&#24314;&#31435;&#22312;Spring&#30340;&#38754;&#21521;&#20999;&#38754;&#32534;&#31243;(aspect-oriented programming, AOP)
&#19978;&#30340;, &#23613;&#31649;&#22914;&#27492;, &#20316;&#20026;Spring Framework&#21457;&#34892;&#21253;&#20195;&#30721;&#30340;&#19968;&#37096;&#20998;&#24182;&#19988;&#36824;&#21487;&#20197;&#22312;&#24456;&#22810;&#22320;&#26041;&#20351;&#29992;, AOP&#30340;&#27010;&#24565;&#21364;&#19981;&#38656;&#35201;
&#22312;&#36825;&#37324;&#20351;&#29992;&#20195;&#30721;&#30340;&#26102;&#20505;&#21435;&#29702;&#35299;.</p>
<p>Spring Framework&#30340;&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;&#22312;&#25351;&#23450;&#20107;&#21153;&#34892;&#20026;(&#25110;&#32773;&#32570;&#23569;&#23427;)&#19979;&#38477;&#33267;&#21333;&#20010;&#20195;&#30721;&#23618;&#27425;&#30340;&#26041;&#38754;&#21644;EJB&#30340;CMT&#24456;&#20687;.
&#23427;&#33021;&#22312;&#24517;&#35201;&#30340;&#26102;&#20505;&#20351;&#24471;&#19968;&#20010;<code class="literal">setRollbackOnly()</code>&#35843;&#29992;&#33021;&#22815;&#22312;&#19968;&#20010;&#20107;&#21153;&#19978;&#19979;&#25991;&#20013;&#36827;&#34892;. &#36825;&#20004;&#31181;&#20107;&#21153;&#31649;&#29702;&#19981;&#21516;&#30340;&#22320;&#26041;
&#22312;&#20110;:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
&#19981;&#20687;EJB&#30340;CMT&#35797;&#22270;&#20351;&#29992;JTA, Spring Framework&#30340;&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;&#24037;&#20316;&#22312;&#20219;&#20309;&#29615;&#22659;&#20013;. &#23427;&#33021;&#36890;&#36807;&#31616;&#21333;&#30340;&#37197;&#32622;
&#25991;&#20214;&#35774;&#32622;&#23601;&#20351;&#29992;JTA    &#25110;&#32773;&#26412;&#22320;&#30340;&#20107;&#21153;&#31649;&#29702;&#22914;JDBC, JPA, Hibernate&#25110;&#32773;JDO.
</li><li class="listitem">
&#20320;&#21487;&#20197;&#23558;Spring Framework&#30340;&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;&#24212;&#29992;&#20110;&#20219;&#20309;&#30340;&#31867;, &#32780;&#19981;&#26159;&#29305;&#23450;&#30340;&#31867;, &#22914;EJBs.
</li><li class="listitem">
Spring Framework&#25552;&#20379;&#20102;&#22768;&#26126;&#24335;&#30340;<a class="link" href="transaction.html#transaction-declarative-rolling-back" title="11.5.3&nbsp;&#22238;&#28378;&#19968;&#20010;&#22768;&#26126;&#24335;&#20107;&#21153;"><span class="emphasis"><em>&#22238;&#28378;&#35268;&#21017;</em></span></a>, &#36825;&#26159;
EJB&#25152;&#27809;&#26377;&#30340;. &#21253;&#25324;&#32534;&#31243;&#24335;&#21644;&#22768;&#26126;&#24335;&#30340;&#22238;&#28378;&#35268;&#21017;&#37117;&#26159;&#25552;&#20379;&#20102;&#30340;.
</li><li class="listitem">
Spring Framework&#36890;&#36807;&#20351;&#29992;AOP&#20801;&#35768;&#20320;&#33258;&#23450;&#20041;&#20107;&#21153;&#30340;&#34892;&#20026;.&#20363;&#22914;, &#20320;&#21487;&#20197;&#22312;&#20107;&#21153;&#22238;&#28378;&#30340;&#20013;&#38388;&#25554;&#20837;&#33258;&#23450;&#20041;&#30340;&#34892;&#20026;.
&#20320;&#21487;&#20197;&#38543;&#30528;&#20107;&#21153;&#35268;&#21017;(You transactional advice)&#28155;&#21152;&#20219;&#24847;&#30340;&#35268;&#21017;. &#20351;&#29992;EJB&#30340;CMT, &#38500;&#20102;&#20351;&#29992;
<code class="literal">setRollbackOnly()</code>, &#20320;&#19981;&#33021;&#24433;&#21709;&#23481;&#22120;&#30340;&#20107;&#21153;&#31649;&#29702;.
</li><li class="listitem">
Spring Framework&#19981;&#25903;&#25345;&#39640;&#31471;&#24212;&#29992;&#26381;&#21153;&#22120;&#25317;&#26377;&#30340;&#36328;&#36828;&#31243;&#35843;&#29992;&#30340;&#20107;&#21153;&#19978;&#19979;&#25991;&#20256;&#25773;. &#22914;&#26524;&#20320;&#38656;&#35201;&#36825;&#20010;&#21151;&#33021;, &#25105;&#20204;
&#25512;&#33616;&#20320;&#20351;&#29992;EJB. &#28982;&#32780;, &#22312;&#20351;&#29992;&#36825;&#20010;&#21151;&#33021;&#21069;&#35831;&#20180;&#32454;&#32771;&#34385;, &#22240;&#20026;&#22312;&#36890;&#24120;&#24773;&#20917;&#19979;, &#25105;&#20204;&#37117;&#19981;&#24076;&#26395;&#26377;&#36328;&#36828;&#31243;&#35843;&#29992;&#30340;
&#20107;&#21153;.
</li></ul></div>

<div class="sidebar"><div class="titlepage"><div><div><p class="title"><b>TransactionProxyFactoryBean&#22312;&#21738;&#37324;?</b></p></div></div></div>

<p>&#22312;Spring 2.0&#21644;&#26356;&#39640;&#29256;&#26412;&#20013;&#23545;&#22768;&#26126;&#24335;&#20107;&#21153;&#30340;&#37197;&#32622;&#21644;&#20197;&#21069;&#30340;&#29256;&#26412;&#26377;&#24456;&#22823;&#30340;&#19981;&#21516;. &#26368;&#22823;&#30340;&#19981;&#21516;&#23601;&#26159;&#20877;&#20063;&#19981;&#38656;&#35201;&#37197;&#32622;
<code class="literal">TransactionProxyFactoryBean</code>&#30340;&#23454;&#20363;&#20102;.</p>
<p>&#20351;&#29992;&#22312;Spring 2.0&#20043;&#21069;&#30340;&#37197;&#32622;&#36824;&#26159;&#26377;&#25928;&#30340;; &#32771;&#34385;&#20351;&#29992;&#26032;&#30340;<code class="literal">&lt;tx:tags/&gt;</code>&#37197;&#32622;&#26469;&#23450;&#20041;<code class="literal">TransactionProxyFactoryBean</code>
&#23454;&#20363;.</p>
</div>

<p>&#22238;&#28378;&#35268;&#21017;&#30340;&#27010;&#24565;&#26159;&#37325;&#35201;&#30340;: &#20182;&#20204;&#35753;&#20320;&#21487;&#20197;&#25351;&#23450;&#21738;&#20123;&#24322;&#24120;(&#25110;&#32773;Throwable)&#24212;&#35813;&#35302;&#21457;&#33258;&#21160;&#30340;&#22238;&#28378;. &#20320;&#25351;&#23450;&#36825;&#20123;&#36890;&#36807;&#22312;
&#37197;&#32622;&#25991;&#20214;&#20013;&#22768;&#26126;&#30340;&#26041;&#24335;, &#19981;&#26159;&#22312;Java&#20195;&#30721;&#20013;. &#25152;&#20197;, &#34429;&#28982;&#20320;&#20173;&#28982;&#21487;&#20197;&#22312;<code class="literal">TransactionStatus</code>&#23545;&#35937;&#19978;&#35843;&#29992;
<code class="literal">setRollbackOnly()</code>&#26469;&#35753;&#24403;&#21069;&#20107;&#21153;&#22238;&#28378;, &#20294;&#26159;&#20320;&#22823;&#22810;&#25968;&#26102;&#20505;&#20250;&#25351;&#23450;&#19968;&#26465;&#35268;&#21017;&#35753;<code class="literal">MyApplicationException</code>&#24517;&#39035;
&#22238;&#28378;. &#36825;&#26679;&#20570;&#30340;&#26174;&#33879;&#20248;&#28857;&#26159;&#19994;&#21153;&#23545;&#35937;&#19981;&#20250;&#20381;&#36182;&#20110;&#20107;&#21153;&#30340;&#24213;&#23618;&#32452;&#25104;. &#20363;&#22914;, &#20182;&#20204;&#36890;&#24120;&#19981;&#20250;&#24341;&#20837;Spring&#20107;&#21153;&#30340;API&#25110;&#32773;
&#20854;&#20182;Spring&#30340;API.</p>
<p>&#23613;&#31649;EJB&#23481;&#22120;&#22312;&#36935;&#21040;<span class="emphasis"><em>&#31995;&#32479;&#24322;&#24120;(system exception)</em></span> (&#36890;&#24120;&#26159;&#36816;&#34892;&#26102;&#24322;&#24120;)&#30340;&#26102;&#20505;&#40664;&#35748;&#34892;&#20026;&#37117;&#26159;&#22238;&#28378;&#20107;&#21153;, &#20294;&#26159;
EJB&#30340;CMT&#22312;&#36935;&#21040;<span class="emphasis"><em>&#24212;&#29992;&#24322;&#24120;(application exception)</em></span> (&#20182;&#26159;&#19968;&#20010;&#19981;&#21516;&#20110;<code class="literal">java.rmi.RemoteException</code>
&#30340;&#26816;&#26597;&#22411;&#24322;&#24120;)&#30340;&#26102;&#20505;&#26159;&#19981;&#20250;&#33258;&#21160;&#22238;&#28378;&#20107;&#21153;&#30340;. &#34429;&#28982;Spring&#22312;&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;&#30340;&#40664;&#35748;&#34892;&#20026;&#26159;&#25353;&#29031;EJB&#30340;&#32422;&#23450;(&#33258;&#21160;&#22238;&#28378;
&#21482;&#22312;&#19981;&#26816;&#26597;&#22411;&#24322;&#24120;&#29983;&#25928;)&#26469;&#30340;, &#20294;&#26159;&#33258;&#24049;&#23450;&#20041;&#34892;&#20026;&#36824;&#26159;&#24456;&#26377;&#29992;&#30340;.</p>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="tx-decl-explained" href="#tx-decl-explained"></a>11.5.1&nbsp;&#29702;&#35299;Spring Framework&#30340;&#22768;&#26126;&#24335;&#20107;&#21153;&#23454;&#29616;</h3></div></div></div>

<p>&#36825;&#26159;&#35201;&#21578;&#35785;&#20320;&#31616;&#21333;&#30340;&#20026;&#20320;&#30340;&#31867;&#27880;&#37322;&#19978;<code class="literal">@Transactional</code>&#30340;&#27880;&#37322;, &#20026;&#37197;&#32622;&#21152;&#19978;<code class="literal">@EnableTransactionManagement</code>
&#26159;&#19981;&#22815;&#20805;&#20998;&#30340;, &#38500;&#38750;&#20320;&#29702;&#35299;&#20102;&#20182;&#20204;&#20840;&#37096;&#26159;&#22914;&#20309;&#24037;&#20316;&#30340;. &#26412;&#31456;&#23558;&#21521;&#20320;&#35762;&#35299;Spring Framework&#20869;&#37096;&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;&#30340;
&#32452;&#20214;&#22312;&#20107;&#21153;&#30456;&#20851;&#38382;&#39064;&#20986;&#29616;&#26102;&#30340;&#24037;&#20316;&#26426;&#21046;.</p>
<p>&#25484;&#25569;Spring Framework&#22768;&#26126;&#24335;&#20107;&#21153;&#25903;&#25345;&#30340;&#20851;&#38190;&#26159;&#36825;&#20010;&#25903;&#25345;&#26159;<a class="link" href="aop.html#aop-understanding-aop-proxies" title="9.6.1&nbsp;Understanding AOP proxies"><span class="emphasis"><em>&#36890;&#36807;AOP
&#20195;&#29702;</em></span></a>&#36215;&#20316;&#29992;&#30340;, &#20197;&#21450;&#20107;&#21153;&#22768;&#26126;&#26159;&#30001;<span class="emphasis"><em>&#20803;&#25968;&#25454;(metadata)</em></span> (&#29616;&#22312;&#26159;XML&#37197;&#32622;&#25110;&#32773;&#22522;&#20110;&#27880;&#35299;&#30340;)&#39537;&#21160;&#30340;. AOP&#21644;
&#20107;&#21153;&#22411;&#30340;&#20803;&#25968;&#25454;&#32452;&#21512;&#35753;&#27493;&#20110;&#20351;&#29992;AOP&#20195;&#29702;&#30340;<code class="literal">TransactionInterceptor</code>&#30340;<code class="literal">PlatformTransactionManager</code>&#23454;&#29616;
&#26469;&#39537;&#21160;<span class="emphasis"><em>&#26041;&#27861;&#32423;&#21709;&#24212;</em></span>.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>Spring AOP&#22312;<a class="xref" href="aop.html" title="9.&nbsp;Aspect Oriented Programming with Spring">Chapter&nbsp;9, <i>Aspect Oriented Programming with Spring</i></a>&#20013;&#20171;&#32461;.</p>
</td></tr></table></div>

<p>&#20174;&#27010;&#24565;&#19978;&#26469;&#35762;, &#22312;&#20107;&#21153;&#22411;&#20195;&#29702;&#19978;&#35843;&#29992;&#19968;&#20010;&#26041;&#27861;&#30475;&#36215;&#26469;&#20687;&#36825;&#26679;&#8230;</p>
<div class="figure"><a name="d5e10849" href="#d5e10849"></a><p class="title"><b>Figure&nbsp;11.1.&nbsp;</b></p><div class="figure-contents">
  <div class="mediaobject"><img src="images/tx.png" alt="tx"></div>
</div></div><br class="figure-break">

</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-declarative-first-example" href="#transaction-declarative-first-example"></a>11.5.2&nbsp;&#22768;&#26126;&#24335;&#20107;&#21153;&#23454;&#29616;&#30340;&#20363;&#23376;</h3></div></div></div>

<p>&#35831;&#21442;&#32771;&#19979;&#38754;&#30340;&#25509;&#21475;&#20197;&#21450;&#20182;&#20204;&#30456;&#20851;&#30340;&#23454;&#29616;. &#36825;&#20010;&#20363;&#23376;&#20351;&#29992;<code class="literal">Foo</code>&#21644;<code class="literal">Bar</code>&#31867;&#26469;&#34920;&#31034;&#21344;&#20301;&#31526;, &#25152;&#20197;&#20320;&#21487;&#20197;&#19987;&#24515;&#20110;&#20107;&#21153;&#30340;
&#20351;&#29992;&#26041;&#27861;&#32780;&#19981;&#24517;&#20851;&#24515;&#29305;&#27530;&#30340;&#22495;&#27169;&#22411;. &#36825;&#20010;&#20363;&#23376;&#30340;&#30446;&#30340;&#26159;&#35828;&#26126;&#22312;<code class="literal">DefaultFooService</code>&#31867;&#30340;&#23454;&#29616;&#30340;&#27599;&#19968;&#20010;&#26041;&#27861;&#20013;
&#25243;&#20986;<code class="literal">UnsupportedOperationException</code>&#24322;&#24120;&#30340;&#23454;&#20363;&#26159;&#24456;&#22909;&#30340;; &#23427;&#20801;&#35768;&#20320;&#35266;&#23519;&#20107;&#21153;&#21019;&#24314;&#20197;&#21450;&#22238;&#28378;&#26469;&#21709;&#24212;
<code class="literal">UnsupportedOperationException</code>&#24322;&#24120;&#30340;&#23454;&#20363;.</p>
<pre class="programlisting"><span class="hl-comment">//&#25105;&#20204;&#24819;&#20351;&#20043;&#25903;&#25345;&#20107;&#21153;&#30340;&#26381;&#21153;&#23618;&#25509;&#21475;</span>

<span class="hl-keyword">package</span> x.y.service;

<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> FooService {

    Foo getFoo(String fooName);

    Foo getFoo(String fooName, String barName);

    <span class="hl-keyword">void</span> insertFoo(Foo foo);

    <span class="hl-keyword">void</span> updateFoo(Foo foo);

}</pre>

<pre class="programlisting"><span class="hl-comment">//&#19978;&#38754;&#25509;&#21475;&#30340;&#19968;&#20010;&#23454;&#29616;</span>

<span class="hl-keyword">package</span> x.y.service;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> DefaultFooService <span class="hl-keyword">implements</span> FooService {

    <span class="hl-keyword">public</span> Foo getFoo(String fooName) {
        <span class="hl-keyword">throw</span> <span class="hl-keyword">new</span> UnsupportedOperationException();
    }

    <span class="hl-keyword">public</span> Foo getFoo(String fooName, String barName) {
        <span class="hl-keyword">throw</span> <span class="hl-keyword">new</span> UnsupportedOperationException();
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> insertFoo(Foo foo) {
        <span class="hl-keyword">throw</span> <span class="hl-keyword">new</span> UnsupportedOperationException();
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> updateFoo(Foo foo) {
        <span class="hl-keyword">throw</span> <span class="hl-keyword">new</span> UnsupportedOperationException();
    }

}</pre>

<p>&#26469;&#35753;&#25105;&#20204;&#20551;&#35774;, <code class="literal">FooService</code>&#25509;&#21475;&#30340;&#21069;&#20004;&#20010;&#26041;&#27861;<code class="literal">getFoo(String)</code>&#21644;<code class="literal">getFoo(String, String)</code>&#24517;&#39035;&#22312;&#21482;&#35835;
&#31867;&#22411;&#35821;&#20041;&#30340;&#20107;&#21153;&#19978;&#19979;&#25991;&#20013;&#25191;&#34892;, &#24182;&#19988;&#20854;&#20182;&#30340;&#26041;&#27861;<code class="literal">insertFoo(Foo)</code>&#21644;<code class="literal">updateFoo(Foo)</code>&#24517;&#39035;&#22312;&#21487;&#35835;&#21487;&#20889;&#31867;&#22411;
&#35821;&#20041;&#30340;&#20107;&#21153;&#19978;&#19979;&#25991;&#29615;&#22659;&#20013;&#25191;&#34892;. &#19979;&#38754;&#30340;&#37197;&#32622;&#30340;&#35814;&#32454;&#35299;&#37322;&#23558;&#22312;&#25509;&#19979;&#26469;&#30340;&#27573;&#33853;&#20013;&#36827;&#34892;.</p>
<pre class="programlisting"><span class="hl-comment">&lt;!-- &#26469;&#33258;&#25991;&#20214; 'context.xml' --&gt;</span>
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xmlns:aop</span>=<span class="hl-value">"http://www.springframework.org/schema/aop"</span>
    <span class="hl-attribute">xmlns:tx</span>=<span class="hl-value">"http://www.springframework.org/schema/tx"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/tx
        http://www.springframework.org/schema/tx/spring-tx.xsd
        http://www.springframework.org/schema/aop
        http://www.springframework.org/schema/aop/spring-aop.xsd"</span><span class="hl-tag">&gt;</span>

    <span class="hl-comment">&lt;!-- &#36825;&#26159;&#25105;&#20204;&#24076;&#26395;&#20351;&#20043;&#25903;&#25345;&#20107;&#21153;&#30340;&#26381;&#21153;&#23618;&#23545;&#35937; --&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"fooService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.service.DefaultFooService"</span><span class="hl-tag">/&gt;</span>

    <span class="hl-comment">&lt;!-- &#20107;&#21153;&#21270;&#37197;&#32622;(&#35831;&#30475;&#19979;&#38754;&#30340;&lt;aop:advisor/&gt;) --&gt;</span>
    <span class="hl-tag">&lt;tx:advice</span> <span class="hl-attribute">id</span>=<span class="hl-value">"txAdvice"</span> <span class="hl-attribute">transaction-manager</span>=<span class="hl-value">"txManager"</span><span class="hl-tag">&gt;</span>
        <span class="hl-comment">&lt;!-- &#20107;&#21153;&#35821;&#20041;... --&gt;</span>
        <span class="hl-tag">&lt;tx:attributes&gt;</span>
            <span class="hl-comment">&lt;!-- &#25152;&#26377;&#29992;'get'&#24320;&#22836;&#30340;&#26041;&#27861;&#37117;&#26159;&#21482;&#35835;&#30340; --&gt;</span>
            <span class="hl-tag">&lt;tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"get*"</span> <span class="hl-attribute">read-only</span>=<span class="hl-value">"true"</span><span class="hl-tag">/&gt;</span>
            <span class="hl-comment">&lt;!-- &#20854;&#20182;&#30340;&#26041;&#27861;&#20351;&#29992;&#40664;&#35748;&#30340;&#20107;&#21153;&#37197;&#32622;(&#30475;&#19979;&#38754;) --&gt;</span>
            <span class="hl-tag">&lt;tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"*"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/tx:attributes&gt;</span>
    <span class="hl-tag">&lt;/tx:advice&gt;</span>

    <span class="hl-comment">&lt;!-- &#20351;&#24471;&#19978;&#38754;&#30340;&#20107;&#21153;&#37197;&#32622;&#23545;FooService&#25509;&#21475;&#30340;&#25152;&#26377;&#25805;&#20316;&#26377;&#25928; --&gt;</span>
    <span class="hl-tag">&lt;aop:config&gt;</span>
        <span class="hl-tag">&lt;aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">"fooServiceOperation"</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"execution(* x.y.service.FooService.*(..))"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;aop:advisor</span> <span class="hl-attribute">advice-ref</span>=<span class="hl-value">"txAdvice"</span> <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">"fooServiceOperation"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/aop:config&gt;</span>

    <span class="hl-comment">&lt;!-- &#19981;&#35201;&#24536;&#20102;DataSource --&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"dataSource"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.apache.commons.dbcp.BasicDataSource"</span> <span class="hl-attribute">destroy-method</span>=<span class="hl-value">"close"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"driverClassName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"oracle.jdbc.driver.OracleDriver"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"url"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"jdbc:oracle:thin:@rj-t42:1521:elvis"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"username"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"scott"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"password"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"tiger"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-comment">&lt;!-- &#21516;&#26679;&#30340;, &#20063;&#19981;&#35201;&#24536;&#20102;PlatformTransactionManager --&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"txManager"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"dataSource"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"dataSource"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-comment">&lt;!-- &#20851;&#20110;&#20854;&#20182;&#30340;&lt;bean/&gt;&#30340;&#23450;&#20041; --&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre>

<p>&#26816;&#26597;&#21069;&#38754;&#30340;&#37197;&#32622;. &#20320;&#24819;&#35753;&#19968;&#20010;&#26381;&#21153;&#23618;&#23545;&#35937;, &#23601;&#26159;<code class="literal">fooService</code>&#36825;&#20010;bean, &#25903;&#25345;&#20107;&#21153;. &#24212;&#29992;&#30340;&#20851;&#20110;&#20107;&#21153;&#35821;&#20041;&#30340;&#23553;&#35013;
&#26159;&#23450;&#20041;&#22312;<code class="literal">&lt;tx:advice/&gt;</code>&#30340;. &#37027;<code class="literal">&lt;tx:advice/&gt;</code>&#30340;&#23450;&#20041;&#30340;&#24847;&#24605;&#23601;&#26159;"<span class="emphasis"><em>&#8230; &#25152;&#26377;&#20197;<code class="literal">'get'</code>&#24320;&#22836;&#30340;&#26041;&#27861;&#37117;&#36816;&#34892;
&#22312;&#21482;&#35835;&#30340;&#20107;&#21153;&#35821;&#20041;&#20013;, &#24182;&#19988;&#20854;&#20182;&#30340;&#25152;&#26377;&#26041;&#27861;&#37117;&#36816;&#34892;&#22312;&#40664;&#35748;&#30340;&#20107;&#21153;&#35821;&#20041;&#20013;</em></span>". <code class="literal">&lt;tx:advice/&gt;</code>&#26631;&#31614;&#30340;
<code class="literal">transaction-manager</code>&#23646;&#24615;&#23601;&#26159;&#29992;&#26469;&#35774;&#32622;&#29992;&#26469;&#39537;&#21160;&#20107;&#21153;&#30340;bean`PlatformTransactionManager`&#30340;&#21517;&#31216;,
&#22312;&#36825;&#37324;&#23601;&#26159;<code class="literal">txManager</code>&#36825;&#20010;bean.</p>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">
<p>&#22914;&#26524;&#20320;&#25171;&#31639;&#22635;&#20889;&#22312;&#20107;&#21153;&#37197;&#32622;(<code class="literal">&lt;tx:advice/&gt;</code>)&#30340;<code class="literal">transaction-manager</code>&#23646;&#24615;&#30340;<code class="literal">PlatformTransactionManager</code>
bean&#30340;&#21517;&#31216;&#26159;<code class="literal">transactionManager</code>, &#20320;&#21487;&#20197;&#24573;&#30053;&#25481;. &#22914;&#26524;&#20320;&#24819;&#20889;&#30340;<code class="literal">PlatformTransactionManager`bean&#26159;
&#20854;&#20182;&#30340;&#21517;&#31216;, &#20320;&#23601;&#24517;&#39035;&#35201;&#20351;&#29992;`transaction-manager</code>&#23646;&#24615;&#26469;&#25351;&#26126;, &#23601;&#20687;&#19978;&#38754;&#30340;&#20363;&#23376;.</p>
</td></tr></table></div>

<p><code class="literal">&lt;aop:config/&gt;</code>&#30340;&#23450;&#20041;&#30830;&#20445;&#20102;&#30001;<code class="literal">txAdvice</code>&#36825;&#20010;bean&#23450;&#20041;&#30340;&#20107;&#21153;&#37197;&#32622;&#22312;&#31243;&#24207;&#21512;&#36866;&#30340;&#20999;&#20837;&#28857;&#36816;&#34892;. &#39318;&#20808;&#38656;&#35201;&#23450;&#20041;
&#19968;&#20010;&#20999;&#20837;&#28857;&#26469;&#21305;&#37197;<code class="literal">FooService</code>( <code class="literal">fooServiceOperation</code>)&#36825;&#20010;&#25509;&#21475;&#23450;&#20041;&#30340;&#20219;&#20309;&#25805;&#20316;. &#28982;&#21518;&#29992;&#19968;&#20010;&#39038;&#38382;(advisor)
&#23558;&#20999;&#20837;&#28857;&#19982;<code class="literal">txAdvice</code>&#20851;&#32852;&#36215;&#26469;. &#36825;&#26679;&#20570;&#30340;&#32467;&#26524;&#23601;&#26159;&#20351;&#29992;<code class="literal">txAdvice</code>&#23450;&#20041;&#30340;&#37197;&#32622;&#20250;&#22312;<code class="literal">fooServiceOperation</code>
&#19978;&#38754;&#24037;&#20316;&#36215;&#26469;.</p>
<p>&#22312;&#20803;&#32032;<code class="literal">&lt;aop:pointcut/&gt;</code>&#20013;&#20351;&#29992;&#30340;&#34920;&#36798;&#24335;&#26159;&#19968;&#20010;AspectJ&#30340;&#20999;&#20837;&#28857;&#34920;&#36798;&#24335;; &#26597;&#30475; <a class="xref" href="aop.html" title="9.&nbsp;Aspect Oriented Programming with Spring">Chapter&nbsp;9, <i>Aspect Oriented Programming with Spring</i></a>&#20102;&#35299;&#26356;&#22810;&#20851;&#20110;Spring
&#20999;&#20837;&#28857;&#34920;&#36798;&#24335;&#30340;&#35814;&#32454;&#20869;&#23481;.</p>
<p>&#35753;&#25972;&#20010;&#26381;&#21153;&#23618;&#37117;&#26159;&#20107;&#21153;&#22411;&#30340;&#26159;&#19968;&#20010;&#36890;&#24120;&#30340;&#38656;&#27714;. &#35201;&#36825;&#20040;&#20570;&#30340;&#26368;&#22909;&#26041;&#24335;&#23601;&#26159;&#31616;&#21333;&#30340;&#20462;&#25913;&#20999;&#20837;&#28857;&#34920;&#36798;&#24335;, &#20351;&#20043;&#33021;&#22815;&#21305;&#37197;
&#26381;&#21153;&#23618;&#25152;&#26377;&#30340;&#25805;&#20316;. &#23601;&#20687;&#19979;&#38754;&#36825;&#26679;:</p>
<pre class="programlisting"><span class="hl-tag">&lt;aop:config&gt;</span>
    <span class="hl-tag">&lt;aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">"fooServiceMethods"</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"execution(* x.y.service.*.*(..))"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;aop:advisor</span> <span class="hl-attribute">advice-ref</span>=<span class="hl-value">"txAdvice"</span> <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">"fooServiceMethods"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/aop:config&gt;</span></pre>

<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p><span class="emphasis"><em>&#22312;&#36825;&#20010;&#20363;&#23376;&#20013;, &#25105;&#20204;&#20551;&#35774;&#20102;&#20320;&#25152;&#26377;&#30340;&#26381;&#21153;&#23618;&#25509;&#21475;&#37117;&#26159;&#23450;&#20041;&#22312;<code class="literal">x.y.service</code>&#21253;&#20013;; &#26597;&#30475; <a class="xref" href="aop.html" title="9.&nbsp;Aspect Oriented Programming with Spring">Chapter&nbsp;9, <i>Aspect Oriented Programming with Spring</i></a>&#20102;&#35299;&#26356;&#22810;.</em></span></p>
</td></tr></table></div>

<p>&#29616;&#22312;&#25105;&#20204;&#24050;&#32463;&#20998;&#26512;&#20102;&#37197;&#32622;, &#20320;&#21487;&#33021;&#23601;&#35201;&#38382;&#33258;&#24049;&#20102;, "<span class="emphasis"><em>&#22909;&#21543;&#8230; &#20294;&#26159;&#36825;&#20123;&#37197;&#32622;&#21040;&#24213;&#20570;&#20102;&#20123;&#20160;&#20040;&#21602;?</em></span>".</p>
<p>&#19978;&#38754;&#30340;&#37197;&#32622;&#23558;&#20250;&#22312;&#30001;<code class="literal">fooService</code>&#36825;&#20010;bean&#30340;&#23450;&#20041;&#21019;&#24314;&#30340;&#23545;&#35937;&#20043;&#19978;&#21019;&#24314;&#19968;&#20010;&#20107;&#21153;&#22411;&#30340;&#20195;&#29702;. &#36825;&#20010;&#20195;&#29702;&#23558;&#20250;&#20351;&#29992;
&#20107;&#21153;&#37197;&#32622;&#36341;&#34892;&#37197;&#32622;, &#25152;&#20197;&#24403;&#21512;&#36866;&#30340;&#26041;&#27861;<span class="emphasis"><em>&#22312;&#36825;&#20010;&#20195;&#29702;&#19978;</em></span>&#34987;&#35843;&#29992;&#30340;&#26102;&#20505;, &#19968;&#20010;&#20107;&#21153;&#26159;&#34987;&#24320;&#21551;&#12289;&#24748;&#31354;&#12289;&#26631;&#35760;&#20026;&#21482;&#35835;
&#36824;&#26159;&#24590;&#20040;&#26679;, &#36825;&#24471;&#21462;&#20915;&#20110;&#36825;&#20010;&#26041;&#27861;&#30340;&#20107;&#21153;&#37197;&#32622;&#35821;&#20041;.&#35831;&#21442;&#30475;&#19979;&#38754;&#36825;&#20010;&#27979;&#35797;&#25191;&#34892;&#19978;&#38754;&#37197;&#32622;&#30340;&#20363;&#23376;:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">final</span> <span class="hl-keyword">class</span> Boot {

    <span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(<span class="hl-keyword">final</span> String[] args) <span class="hl-keyword">throws</span> Exception {
        ApplicationContext ctx = <span class="hl-keyword">new</span> ClassPathXmlApplicationContext(<span class="hl-string">"context.xml"</span>, Boot.<span class="hl-keyword">class</span>);
        FooService fooService = (FooService) ctx.getBean(<span class="hl-string">"fooService"</span>);
        fooService.insertFoo (<span class="hl-keyword">new</span> Foo());
    }
}</pre>

<p>&#19978;&#38754;&#30340;&#31243;&#24207;&#25191;&#34892;&#36215;&#26469;&#30340;&#36755;&#20986;&#30475;&#36215;&#26469;&#20687;&#36825;&#26679;. (&#20026;&#20102;&#30475;&#36215;&#26469;&#26356;&#30452;&#35266;, &#24050;&#32463;&#23558;Log4J&#30340;&#36755;&#20986;&#21644;&#30001;DefaultFooService
&#31867;&#30340;insertFoo(..)&#26041;&#27861;&#25243;&#20986;&#30340;UnsupportedOperationException&#22534;&#26632;&#36827;&#34892;&#20102;&#25688;&#38500;&#22788;&#29702;.)</p>
<pre class="programlisting"><span class="hl-comment">&lt;!-- Spring&#23481;&#22120;&#27491;&#22312;&#21551;&#21160;... --&gt;</span>
[AspectJInvocationContextExposingAdvisorAutoProxyCreator] - Creating implicit proxy for bean <span class="emphasis"><em>fooService</em></span> with 0 common interceptors and 1 specific interceptors

<span class="hl-comment">&lt;!-- DefaultFooService&#26159;&#30495;&#30340;&#34987;&#20195;&#29702;&#20102; --&gt;</span>
[JdkDynamicAopProxy] - Creating JDK dynamic proxy for [x.y.service.DefaultFooService]

<span class="hl-comment">&lt;!-- ... insertFoo(..)&#26041;&#27861;&#29616;&#22312;&#26159;&#34987;&#20195;&#29702;&#35843;&#29992;&#30340; --&gt;</span>
[TransactionInterceptor] - Getting transaction for x.y.service.FooService.insertFoo

<span class="hl-comment">&lt;!-- &#20107;&#21153;&#37197;&#32622;&#20999;&#20837;&#22312;&#36825;&#37324;... --&gt;</span>
[DataSourceTransactionManager] - Creating new transaction with name [x.y.service.FooService.insertFoo]
[DataSourceTransactionManager] - Acquired Connection [org.apache.commons.dbcp.PoolableConnection@a53de4] for JDBC transaction

<span class="hl-comment">&lt;!-- DefaultFooService&#30340;insertFoo(..)&#25243;&#20986;&#20102;&#19968;&#20010;&#24322;&#24120;... --&gt;</span>
[RuleBasedTransactionAttribute] - Applying rules to determine whether transaction should rollback on java.lang.UnsupportedOperationException
[TransactionInterceptor] - Invoking rollback for transaction on x.y.service.FooService.insertFoo due to throwable [java.lang.UnsupportedOperationException]

<span class="hl-comment">&lt;!-- &#28982;&#21518;&#20107;&#21153;&#23601;&#22238;&#28378;&#20102; (&#40664;&#35748;&#24773;&#20917;&#19979;, RuntimeException&#20250;&#23548;&#33268;&#22238;&#28378;) --&gt;</span>
[DataSourceTransactionManager] - Rolling back JDBC transaction on Connection [org.apache.commons.dbcp.PoolableConnection@a53de4]
[DataSourceTransactionManager] - Releasing JDBC Connection after transaction
[DataSourceUtils] - Returning JDBC Connection to DataSource

Exception in thread "main" java.lang.UnsupportedOperationException at x.y.service.DefaultFooService.insertFoo(DefaultFooService.java:14)
<span class="hl-comment">&lt;!-- &#20026;&#20102;&#30452;&#35266;, AOP&#32452;&#20214;&#30340;&#22534;&#26632;&#24050;&#32463;&#31227;&#38500;&#20102;--&gt;</span>
at $Proxy0.insertFoo(Unknown Source)
at Boot.main(Boot.java:11)</pre>

</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-declarative-rolling-back" href="#transaction-declarative-rolling-back"></a>11.5.3&nbsp;&#22238;&#28378;&#19968;&#20010;&#22768;&#26126;&#24335;&#20107;&#21153;</h3></div></div></div>

<p>&#21069;&#38754;&#30340;&#31456;&#33410;&#24050;&#32463;&#22823;&#33268;&#20171;&#32461;&#20102;&#24590;&#20040;&#32473;&#31867;&#25351;&#26126;&#20107;&#21153;&#37197;&#32622;, &#36825;&#20123;&#31867;&#22312;&#20320;&#30340;&#24212;&#29992;&#37324;&#38754;&#36890;&#24120;&#26159;&#26381;&#21153;&#23618;&#30340;&#31867;. &#36825;&#20010;&#31456;&#33410;&#23558;&#20250;&#25551;&#36848;
&#20320;&#24590;&#20040;&#22312;&#19968;&#20010;&#31616;&#21333;&#30340;&#22330;&#26223;&#37324;&#38754;&#22238;&#28378;&#20107;&#21153;.</p>
<p>&#35753;Spring Framework&#20107;&#21153;&#30340;&#22522;&#30784;&#26500;&#20214;&#30693;&#36947;&#20107;&#21153;&#38656;&#35201;&#36827;&#34892;&#22238;&#28378;&#30340;&#25512;&#33616;&#20570;&#27861;&#26159;&#22312;&#27491;&#22312;&#25191;&#34892;&#30340;&#20195;&#30721;&#30340;&#24403;&#21069;&#19978;&#19979;&#25991;&#20013;&#25243;&#20986;
<code class="literal">Exception</code>. Spring Framework&#20107;&#21153;&#30340;&#22522;&#30784;&#26500;&#20214;&#23558;&#20250;&#22312;&#35843;&#29992;&#26632;&#20013;&#20986;&#29616;&#26410;&#22788;&#29702;&#30340;<code class="literal">Exception</code>&#30340;&#26102;&#20505;&#23558;&#20854;&#20840;&#37096;
&#25429;&#33719;, &#28982;&#21518;&#20250;&#36827;&#34892;&#27979;&#23450;&#26159;&#21542;&#38656;&#35201;&#23558;&#20107;&#21153;&#36827;&#34892;&#22238;&#28378;.</p>
<p>&#22312;&#40664;&#35748;&#37197;&#32622;&#20013;, Spring Framework&#30340;&#20107;&#21153;&#22522;&#30784;&#26500;&#20214;<span class="emphasis"><em>&#21482;&#20250;</em></span>&#22312;&#36816;&#34892;&#26399;&#12289;&#26410;&#26816;&#26597;&#30340;&#24322;&#24120;&#26102;&#25165;&#20250;&#26631;&#35760;&#20107;&#21153;&#22238;&#28378;;&#20063;&#23601;
&#26159;&#35828;, &#24403;&#25243;&#20986;&#30340;&#24322;&#24120;&#26159;<code class="literal">RuntimeException</code>&#25110;&#32773;&#20854;&#23376;&#31867;&#30340;&#23454;&#20363;&#26102;(<code class="literal">Error</code>&#20063;&#21516;&#26679;)&#40664;&#35748;&#37117;&#26159;&#26631;&#35760;&#20026;&#22238;&#28378;.
&#20107;&#21153;&#30340;&#26041;&#27861;&#20013;&#25243;&#20986;&#26816;&#26597;&#30340;&#24322;&#24120;&#26102;&#22312;&#40664;&#35748;&#24773;&#20917;&#19979;<span class="emphasis"><em>&#19981;&#20250;</em></span>&#26631;&#35760;&#20026;&#22238;&#28378;.</p>
<p>&#20320;&#21487;&#20197;&#33258;&#24049;&#37197;&#32622;&#21738;&#20123;<code class="literal">Exception</code>&#30340;&#31867;&#22411;&#26159;&#38656;&#35201;&#26631;&#35760;&#20026;&#22238;&#28378;&#30340;, &#36825;&#21253;&#25324;&#20102;&#26816;&#26597;&#30340;&#24322;&#24120;. &#19979;&#38754;&#30340;XML&#20195;&#30721;&#29255;&#27573;&#23637;&#31034;&#20102;
&#20320;&#38656;&#35201;&#24590;&#26679;&#37197;&#32622;&#26631;&#35760;&#26816;&#26597;&#30340;&#12289;&#31243;&#24207;&#33258;&#23450;&#20041;&#30340;<code class="literal">Exception</code>&#20026;&#38656;&#35201;&#22238;&#28378;&#24322;&#24120;.</p>
<pre class="programlisting"><span class="hl-tag">&lt;tx:advice</span> <span class="hl-attribute">id</span>=<span class="hl-value">"txAdvice"</span> <span class="hl-attribute">transaction-manager</span>=<span class="hl-value">"txManager"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;tx:attributes&gt;</span>
    <span class="hl-tag">&lt;tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"get*"</span> <span class="hl-attribute">read-only</span>=<span class="hl-value">"true"</span> <span class="hl-attribute">rollback-for</span>=<span class="hl-value">"NoProductInStockException"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"*"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/tx:attributes&gt;</span>
<span class="hl-tag">&lt;/tx:advice&gt;</span></pre>

<p>&#22914;&#26524;&#20320;&#38656;&#35201;&#22312;&#26576;&#19968;&#20123;&#24322;&#24120;&#25243;&#20986;&#30340;&#26102;&#20505;<span class="emphasis"><em>&#19981;&#36827;&#34892;</em></span>&#22238;&#28378;, &#20320;&#19968;&#26679;&#21487;&#20197;&#37197;&#32622;<span class="emphasis"><em>&#19981;&#22238;&#28378;&#35268;&#21017;</em></span>. &#19979;&#38754;&#30340;&#20363;&#23376;&#23601;&#21578;&#35785;
Spring Framework&#30340;&#20107;&#21153;&#22522;&#30784;&#26500;&#20214;&#25552;&#20132;&#25152;&#36827;&#34892;&#30340;&#20107;&#21153;&#21363;&#20351;&#20986;&#29616;&#20102;&#26410;&#22788;&#29702;&#30340;<code class="literal">InstrumentNotFoundException</code>.</p>
<pre class="programlisting"><span class="hl-tag">&lt;tx:advice</span> <span class="hl-attribute">id</span>=<span class="hl-value">"txAdvice"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;tx:attributes&gt;</span>
    <span class="hl-tag">&lt;tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"updateStock"</span> <span class="hl-attribute">no-rollback-for</span>=<span class="hl-value">"InstrumentNotFoundException"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"*"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/tx:attributes&gt;</span>
<span class="hl-tag">&lt;/tx:advice&gt;</span></pre>

<p>&#24403;Spring Framework&#30340;&#20107;&#21153;&#22522;&#30784;&#26500;&#20214;&#25429;&#33719;&#20102;&#19968;&#26465;&#34987;&#22810;&#20010;&#21442;&#32771;&#37197;&#32622;&#30830;&#23450;&#26159;&#21542;&#38656;&#35201;&#22238;&#28378;&#30340;&#24322;&#24120;&#26102;, &#37027;&#19968;&#26465;<span class="emphasis"><em>&#26368;&#31934;&#30830;</em></span>
&#30340;&#23558;&#29983;&#25928;.&#25152;&#20197;&#22312;&#19979;&#38754;&#30340;&#37197;&#32622;&#20013;, &#38500;&#20102;<code class="literal">InstrumentNotFoundException</code>&#30340;&#25152;&#26377;&#24322;&#24120;&#37117;&#23558;&#34987;&#26631;&#35760;&#20026;&#22238;&#28378;.</p>
<pre class="programlisting"><span class="hl-tag">&lt;tx:advice</span> <span class="hl-attribute">id</span>=<span class="hl-value">"txAdvice"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;tx:attributes&gt;</span>
    <span class="hl-tag">&lt;tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"*"</span> <span class="hl-attribute">rollback-for</span>=<span class="hl-value">"Throwable"</span> <span class="hl-attribute">no-rollback-for</span>=<span class="hl-value">"InstrumentNotFoundException"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/tx:attributes&gt;</span>
<span class="hl-tag">&lt;/tx:advice&gt;</span></pre>

<p>&#20320;&#20063;&#21487;&#20197;<span class="emphasis"><em>&#20197;&#32534;&#31243;&#30340;&#26041;&#24335;</em></span>&#26631;&#26126;&#19968;&#20010;&#38656;&#35201;&#22238;&#28378;&#30340;&#22320;&#26041;. &#23613;&#31649;&#26159;&#24456;&#31616;&#21333;&#30340;, &#20294;&#26159;&#20063;&#24456;&#20855;&#26377;&#20405;&#20837;&#24615;, &#24182;&#19988;&#23558;&#20320;&#30340;&#20195;&#30721;&#21516;
Spring Framework&#30340;&#20107;&#21153;&#22522;&#30784;&#26500;&#20214;&#32039;&#32806;&#21512;&#22312;&#20102;&#19968;&#36215;:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">void</span> resolvePosition() {
    <span class="hl-keyword">try</span> {
        <span class="hl-comment">// &#19994;&#21153;&#36923;&#36753;...</span>
    } <span class="hl-keyword">catch</span> (NoProductInStockException ex) {
        <span class="hl-comment">// &#32534;&#31243;&#24335;&#35302;&#21457;&#22238;&#28378;</span>
        TransactionAspectSupport.currentTransactionStatus().setRollbackOnly();
    }
}</pre>

<p>&#24378;&#28872;&#24314;&#35758;&#20320;&#22312;&#25152;&#26377;&#21487;&#33021;&#30340;&#24773;&#20917;&#19979;&#37117;&#20351;&#29992;&#22768;&#26126;&#24335;&#30340;&#26041;&#27861;&#35753;&#20107;&#21153;&#22238;&#28378;. &#32534;&#31243;&#24335;&#30340;&#20107;&#21153;&#22238;&#28378;&#22312;&#20320;&#36843;&#19981;&#24471;&#24050;&#30340;&#26102;&#20505;&#20063;&#26159;&#21487;&#34892;&#30340;,
&#20294;&#20182;&#30340;&#29992;&#20363;&#36816;&#34892;&#22312;&#22312;&#23454;&#29616;&#19968;&#20010;&#22522;&#20110;POJO&#30340;&#26550;&#26500;&#20013;.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-declarative-diff-tx" href="#transaction-declarative-diff-tx"></a>11.5.4&nbsp;&#20026;&#19981;&#21516;&#30340;bean&#37197;&#32622;&#19981;&#21516;&#30340;&#20107;&#21153;</h3></div></div></div>

<p>&#32771;&#34385;&#36825;&#26679;&#19968;&#20010;&#22330;&#26223;, &#20320;&#22312;&#26381;&#21153;&#23618;&#26377;&#22823;&#37327;&#30340;&#23545;&#35937;, &#24182;&#19988;&#20320;&#24819;&#23545;&#23427;&#20204;&#27599;&#19968;&#20010;&#37117;&#24212;&#29992;<span class="emphasis"><em>&#23436;&#20840;&#19981;&#21516;&#30340;</em></span>&#20107;&#21153;&#37197;&#32622;. &#20320;&#23436;&#25104;
&#36825;&#20010;&#20107;&#24773;&#26159;&#20351;&#29992;&#20102;&#19981;&#21516;&#30340;<code class="literal">pointcut</code>&#21644;<code class="literal">advice-ref</code>&#23646;&#24615;&#30340;&#20540;&#26469;&#23450;&#20041;&#20102;&#19981;&#21516;&#30340;<code class="literal">&lt;aop:advisor/&gt;</code>&#20803;&#32032;.</p>
<p>&#20316;&#20026;&#19968;&#20010;&#20986;&#21457;&#28857;, &#39318;&#20808;&#20551;&#35774;&#20320;&#26381;&#21153;&#23618;&#25152;&#26377;&#30340;&#31867;&#37117;&#23450;&#20041;&#22312;&#26681;&#21253;<code class="literal">x.y.service</code>&#20013;. &#20026;&#20102;&#35753;&#22312;&#36825;&#20010;&#21253;(&#25110;&#32773;&#20182;&#30340;&#23376;&#21253;)
&#20013;&#23450;&#20041;&#30340;&#25152;&#26377;&#20197;<code class="literal">Service</code>&#32467;&#23614;&#30340;&#31867;&#30340;&#25152;&#26377;&#23454;&#20363;&#37117;&#20855;&#26377;&#40664;&#35748;&#20107;&#21153;&#37197;&#32622;, &#20320;&#23558;&#20250;&#36827;&#34892;&#22914;&#19979;&#37197;&#32622;:</p>
<pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xmlns:aop</span>=<span class="hl-value">"http://www.springframework.org/schema/aop"</span>
    <span class="hl-attribute">xmlns:tx</span>=<span class="hl-value">"http://www.springframework.org/schema/tx"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/tx
        http://www.springframework.org/schema/tx/spring-tx.xsd
        http://www.springframework.org/schema/aop
        http://www.springframework.org/schema/aop/spring-aop.xsd"</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;aop:config&gt;</span>

        <span class="hl-tag">&lt;aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">"serviceOperation"</span>
                <span class="hl-attribute">expression</span>=<span class="hl-value">"execution(* x.y.service..*Service.*(..))"</span><span class="hl-tag">/&gt;</span>

        <span class="hl-tag">&lt;aop:advisor</span> <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">"serviceOperation"</span> <span class="hl-attribute">advice-ref</span>=<span class="hl-value">"txAdvice"</span><span class="hl-tag">/&gt;</span>

    <span class="hl-tag">&lt;/aop:config&gt;</span>

    <span class="hl-comment">&lt;!-- &#36825;&#20004;&#20010;bean&#23558;&#25903;&#25345;&#20107;&#21153;... --&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"fooService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.service.DefaultFooService"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"barService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.service.extras.SimpleBarService"</span><span class="hl-tag">/&gt;</span>

    <span class="hl-comment">&lt;!-- ... &#32780;&#36825;&#20004;&#20010;bean&#23558;&#19981;&#25903;&#25345; --&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"anotherService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.xyz.SomeService"</span><span class="hl-tag">/&gt;</span> <span class="hl-comment">&lt;!-- (not in the right package) --&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"barManager"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.service.SimpleBarManager"</span><span class="hl-tag">/&gt;</span> <span class="hl-comment">&lt;!-- (doesn't end in 'Service') --&gt;</span>

    <span class="hl-tag">&lt;tx:advice</span> <span class="hl-attribute">id</span>=<span class="hl-value">"txAdvice"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;tx:attributes&gt;</span>
            <span class="hl-tag">&lt;tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"get*"</span> <span class="hl-attribute">read-only</span>=<span class="hl-value">"true"</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"*"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/tx:attributes&gt;</span>
    <span class="hl-tag">&lt;/tx:advice&gt;</span>

    <span class="hl-comment">&lt;!-- &#30465;&#30053;&#20854;&#20182;&#22914;PlatformTransactionManager&#30340;&#20107;&#21153;&#22522;&#30784;&#26500;&#20214;&#30340;&#37197;&#32622;... --&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre>

<p>&#19979;&#38754;&#30340;&#20363;&#23376;&#23637;&#31034;&#20102;&#24590;&#26679;&#37197;&#32622;&#20004;&#20010;&#19981;&#19968;&#26679;&#30340;bean&#20351;&#29992;&#20004;&#20010;&#23436;&#20840;&#19981;&#21516;&#30340;&#20107;&#21153;&#37197;&#32622;.</p>
<pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xmlns:aop</span>=<span class="hl-value">"http://www.springframework.org/schema/aop"</span>
    <span class="hl-attribute">xmlns:tx</span>=<span class="hl-value">"http://www.springframework.org/schema/tx"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/tx
        http://www.springframework.org/schema/tx/spring-tx.xsd
        http://www.springframework.org/schema/aop
        http://www.springframework.org/schema/aop/spring-aop.xsd"</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;aop:config&gt;</span>

        <span class="hl-tag">&lt;aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">"defaultServiceOperation"</span>
                <span class="hl-attribute">expression</span>=<span class="hl-value">"execution(* x.y.service.*Service.*(..))"</span><span class="hl-tag">/&gt;</span>

        <span class="hl-tag">&lt;aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">"noTxServiceOperation"</span>
                <span class="hl-attribute">expression</span>=<span class="hl-value">"execution(* x.y.service.ddl.DefaultDdlManager.*(..))"</span><span class="hl-tag">/&gt;</span>

        <span class="hl-tag">&lt;aop:advisor</span> <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">"defaultServiceOperation"</span> <span class="hl-attribute">advice-ref</span>=<span class="hl-value">"defaultTxAdvice"</span><span class="hl-tag">/&gt;</span>

        <span class="hl-tag">&lt;aop:advisor</span> <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">"noTxServiceOperation"</span> <span class="hl-attribute">advice-ref</span>=<span class="hl-value">"noTxAdvice"</span><span class="hl-tag">/&gt;</span>

    <span class="hl-tag">&lt;/aop:config&gt;</span>

    <span class="hl-comment">&lt;!-- &#36825;&#20010;bean&#26159;&#20107;&#21153;&#22411;&#30340;(&#26597;&#30475;'defaultServiceOperation'&#20999;&#20837;&#28857;) --&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"fooService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.service.DefaultFooService"</span><span class="hl-tag">/&gt;</span>

    <span class="hl-comment">&lt;!-- &#36825;&#20010;bean&#20063;&#26159;&#20107;&#21153;&#22411;&#30340;, &#20294;&#26159;&#23427;&#25317;&#26377;&#23436;&#20840;&#19981;&#19968;&#26679;&#30340;&#20107;&#21153;&#37197;&#32622; --&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"anotherFooService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.service.ddl.DefaultDdlManager"</span><span class="hl-tag">/&gt;</span>

    <span class="hl-tag">&lt;tx:advice</span> <span class="hl-attribute">id</span>=<span class="hl-value">"defaultTxAdvice"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;tx:attributes&gt;</span>
            <span class="hl-tag">&lt;tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"get*"</span> <span class="hl-attribute">read-only</span>=<span class="hl-value">"true"</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"*"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/tx:attributes&gt;</span>
    <span class="hl-tag">&lt;/tx:advice&gt;</span>

    <span class="hl-tag">&lt;tx:advice</span> <span class="hl-attribute">id</span>=<span class="hl-value">"noTxAdvice"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;tx:attributes&gt;</span>
            <span class="hl-tag">&lt;tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"*"</span> <span class="hl-attribute">propagation</span>=<span class="hl-value">"NEVER"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/tx:attributes&gt;</span>
    <span class="hl-tag">&lt;/tx:advice&gt;</span>

    <span class="hl-comment">&lt;!-- &#30465;&#30053;&#20854;&#20182;&#22914;PlatformTransactionManager&#30340;&#20107;&#21153;&#22522;&#30784;&#26500;&#20214;&#30340;&#37197;&#32622;... --&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre>

</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-declarative-txadvice-settings" href="#transaction-declarative-txadvice-settings"></a>11.5.5&nbsp;&lt;tx:advice/&gt; &#35774;&#32622;</h3></div></div></div>

<p>&#26412;&#31456;&#24635;&#32467;&#25972;&#29702;&#21487;&#20197;&#20351;&#29992;<code class="literal">&lt;tx:advice/&gt;</code>&#26631;&#31614;&#25351;&#23450;&#30340;&#21508;&#31181;&#35774;&#32622;. <code class="literal">&lt;tx:advice/&gt;</code>&#26631;&#31614;&#40664;&#35748;&#30340;&#35774;&#32622;&#26159;:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<a class="link" href="transaction.html#tx-propagation" title="11.5.7&nbsp;&#20107;&#21153;&#20256;&#25773;&#24615;">&#20256;&#25773;&#34892;&#20026;&#35774;&#32622;</a>&#26159;<code class="literal">REQUIRED.</code>
</li><li class="listitem">
&#38548;&#31163;&#31561;&#32423;&#26159;<code class="literal">DEFAULT.</code>
</li><li class="listitem">
&#20107;&#21153;&#26159;&#21487;&#35835;&#21487;&#20889;.
</li><li class="listitem">
&#20107;&#21153;&#36229;&#26102;&#26159;&#20351;&#29992;&#31995;&#32479;&#24213;&#23618;&#32452;&#20214;&#30340;&#40664;&#35748;&#20540;, &#22312;&#19981;&#25903;&#25345;&#36229;&#26102;&#30340;&#26102;&#20505;&#27809;&#26377;&#36229;&#26102;.
</li><li class="listitem">
&#20219;&#20309;&#30340;<code class="literal">RuntimeException</code>&#22343;&#35302;&#21457;&#22238;&#28378;, &#24182;&#19988;&#26816;&#26597;&#30340;<code class="literal">Exception</code>&#19981;&#20250;.
</li></ul></div>

<p>&#20320;&#21487;&#20197;&#20462;&#25913;&#40664;&#35748;&#30340;&#35774;&#32622;; <code class="literal">&lt;tx:advice/&gt;</code>&#21644;<code class="literal">&lt;tx:attributes/&gt;</code>&#26631;&#31614;&#25152;&#38656;&#35201;&#30340;<code class="literal">&lt;tx:method/&gt;</code>&#26631;&#31614;&#30340;&#23646;&#24615;&#37117;
&#25972;&#29702;&#22312;&#19979;&#38754;&#20102;:</p>
<div class="table"><a name="tx-method-settings" href="#tx-method-settings"></a><p class="title"><b>Table&nbsp;11.1.&nbsp;&lt;tx:method/&gt;&#35774;&#32622;</b></p><div class="table-contents">

  <table summary="<tx:method/&gt;&#35774;&#32622;" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="col_1"><col class="col_2"><col class="col_3"><col class="col_4"></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">&#23646;&#24615;</th><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">&#26159;&#21542;&#24517;&#39035;</th><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">&#40664;&#35748;&#20540;</th><th style="border-bottom: 0.5pt solid ; " align="left" valign="top">&#25551;&#36848;</th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">name</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>&#26159;</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">&nbsp;</td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>&#20107;&#21153;&#23646;&#24615;&#25152;&#20851;&#32852;&#30340;&#26041;&#27861;&#21517;&#31216;(&#21487;&#33021;&#19981;&#21807;&#19968;). &#36890;&#37197;&#31526;(*)&#21487;&#20197;&#29992;&#20110;&#34920;&#31034;&#19968;&#32452;&#30456;&#21516;&#30340;&#26041;&#27861;; &#20363;&#22914;, <code class="literal">get*</code>, <code class="literal">handle*</code>,
	<code class="literal">on*Event</code>, &#31561;&#31561;.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">propagation</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>&#19981;&#26159;</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>REQUIRED</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>&#20107;&#21153;&#20256;&#25773;&#34892;&#20026;.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">isolation</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>&#19981;&#26159;</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>DEFAULT</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>&#20107;&#21153;&#38548;&#31163;&#31561;&#32423;.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">timeout</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>&#19981;&#26159;</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>-1</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>&#20107;&#21153;&#36229;&#26102;&#30340;&#20540;(&#20197;&#31186;&#20026;&#21333;&#20301;).</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">read-only</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>&#19981;&#26159;</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>false</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>&#20107;&#21153;&#26159;&#19981;&#26159;&#21482;&#35835;&#30340;?</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">rollback-for</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>&#19981;&#26159;</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">&nbsp;</td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>&#20250;&#35302;&#21457;&#22238;&#28378;&#30340;<code class="literal">Exception(&#21487;&#33021;&#19981;&#21807;&#19968;)</code>; &#20351;&#29992;&#36887;&#21495;&#20998;&#38548;. &#20363;&#22914;, <code class="literal">com.foo.MyBusinessException,ServletException.</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">no-rollback-for</code></p></td><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>&#19981;&#26159;</p></td><td style="border-right: 0.5pt solid ; " align="left" valign="top">&nbsp;</td><td style="" align="left" valign="top"><p><span class="emphasis"><em>&#19981;&#20250;</em></span>&#35302;&#21457;&#22238;&#28378;&#30340;<code class="literal">Exception(&#21487;&#33021;&#19981;&#21807;&#19968;)</code>; &#20351;&#29992;&#36887;&#21495;&#20998;&#38548;. &#20363;&#22914;, <code class="literal">com.foo.MyBusinessException,ServletException.</code></p></td></tr></tbody></table>
</div></div><br class="table-break">

</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-declarative-annotations" href="#transaction-declarative-annotations"></a>11.5.6&nbsp;@Transactional &#30340;&#20351;&#29992;</h3></div></div></div>

<p>&#20316;&#20026;&#20351;&#29992;&#22522;&#20110;XML&#37197;&#32622;&#22768;&#26126;&#24335;&#20107;&#21153;&#37197;&#32622;&#26041;&#27861;&#30340;&#34917;&#20805;, &#20320;&#21487;&#20197;&#20351;&#29992;&#19968;&#31181;&#22522;&#20110;&#27880;&#35299;&#30340;&#26041;&#27861;. &#30452;&#25509;&#22312;Java&#20195;&#30721;&#20013;&#22768;&#26126;&#20107;&#21153;
&#35821;&#20041;&#22768;&#26126;&#20351;&#24471;&#22768;&#26126;&#26356;&#21152;&#38752;&#36817;&#29983;&#25928;&#30340;&#20195;&#30721;. &#36825;&#19981;&#23384;&#22312;&#36807;&#24230;&#21361;&#38505;&#30340;&#32806;&#21512;, &#22240;&#20026;&#19981;&#31649;&#24590;&#20040;&#35828;&#24320;&#21457;&#20195;&#30721;&#30340;&#23601;&#24847;&#21619;&#30528;&#36825;&#26679;
&#34987;&#20107;&#21153;&#21270;&#22320;&#20351;&#29992;.</p>
<p><code class="literal">@Transactional</code>&#27880;&#35299;&#25152;&#25552;&#20379;&#30340;&#26131;&#29992;&#24615;&#23558;&#20351;&#29992;&#21518;&#38754;&#25991;&#26412;&#20013;&#30340;&#20363;&#23376;&#36827;&#34892;&#35828;&#26126;. &#21442;&#32771;&#19979;&#38754;&#22768;&#26126;&#30340;&#31867;:</p>
<pre class="programlisting"><span class="hl-comment">// &#25105;&#20204;&#24819;&#35201;&#25903;&#25345;&#20107;&#21153;&#30340;&#26381;&#21153;&#31867;</span>
<span class="strong"><strong>@Transactional</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> DefaultFooService <span class="hl-keyword">implements</span> FooService {

    Foo getFoo(String fooName);

    Foo getFoo(String fooName, String barName);

    <span class="hl-keyword">void</span> insertFoo(Foo foo);

    <span class="hl-keyword">void</span> updateFoo(Foo foo);
}</pre>

<p>&#24403;&#22312;Spring IoC&#23481;&#22120;&#20013;&#23450;&#20041;&#19978;&#38754;&#30340;POJO&#26102;, &#36825;&#20010;bean&#30340;&#23454;&#20363;&#23601;&#20165;&#20165;&#38656;&#35201;&#22312;XML&#37197;&#32622;&#28155;&#21152;<span class="emphasis"><em>&#19968;</em></span>&#34892;&#23601;&#21487;&#20197;&#28155;&#21152;
&#20107;&#21153;&#20102;:</p>
<pre class="programlisting"><span class="hl-comment">&lt;!-- &#26469;&#33258;&#25991;&#20214;</span><span class="emphasis"><em>context.xml</em></span> --&gt;
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xmlns:aop</span>=<span class="hl-value">"http://www.springframework.org/schema/aop"</span>
    <span class="hl-attribute">xmlns:tx</span>=<span class="hl-value">"http://www.springframework.org/schema/tx"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/tx
        http://www.springframework.org/schema/tx/spring-tx.xsd
        http://www.springframework.org/schema/aop
        http://www.springframework.org/schema/aop/spring-aop.xsd"</span><span class="hl-tag">&gt;</span>

    <span class="hl-comment">&lt;!-- &#36825;&#23601;&#26159;&#25105;&#20204;&#24819;&#35201;&#20351;&#20043;&#25903;&#25345;&#20107;&#21153;&#30340;&#23545;&#35937; --&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"fooService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.service.DefaultFooService"</span><span class="hl-tag">/&gt;</span>

    <span class="hl-comment">&lt;!-- &#20351;&#20351;&#29992;&#27880;&#35299;&#37197;&#32622;&#30340;&#20107;&#21153;&#34892;&#20026;&#29983;&#25928; --&gt;</span>
    <span class="emphasis"><em>&lt;tx:annotation-driven transaction-manager="txManager"/&gt;</em></span><span class="hl-comment">&lt;!-- &#20173;&#28982;&#38656;&#35201;&#19968;&#20010;PlatformTransactionManager --&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"txManager"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span><span class="hl-tag">&gt;</span>
        <span class="hl-comment">&lt;!-- (&#36825;&#20010;&#38656;&#35201;&#30340;&#23545;&#35937;&#26159;&#22312;&#20854;&#20182;&#22320;&#26041;&#23450;&#20041;&#30340;) --&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"dataSource"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"dataSource"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-comment">&lt;!-- &#20854;&#20182;&lt;bean/&gt;&#30340;&#23450;&#20041; --&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre>

<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">
<p>&#22914;&#26524;&#20320;&#24819;&#22312;<code class="literal">&lt;tx:annotation-driven/&gt;</code>&#26631;&#31614;&#37324;&#38754;&#30340;<code class="literal">transaction-manager</code>&#23646;&#24615;&#20540;&#20889;&#30340;
<code class="literal">PlatformTransactionManager</code>&#23545;&#35937;&#30340;bean&#21517;&#23383;&#26159;<code class="literal">transactionManager</code>&#30340;&#35805;&#21487;&#20197;&#24573;&#30053;. &#22914;&#26524;&#20320;&#38656;&#35201;
&#20381;&#36182;&#27880;&#20837;&#30340;<code class="literal">PlatformTransactionManager`bean&#30340;&#21517;&#23383;&#26159;&#21478;&#22806;&#30340;, &#20320;&#38656;&#35201;&#24819;&#21069;&#38754;&#20363;&#23376;&#20013;&#30340;&#37027;&#26679;&#20351;&#29992;
`transaction-manager</code>&#23646;&#24615;&#26469;&#25351;&#23450;.</p>
</td></tr></table></div>

<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>&#22914;&#26524;&#20320;&#26159;&#20351;&#29992;&#22522;&#20110;Java&#30340;&#37197;&#32622;&#30340;&#35805;&#37027;&#20040;<code class="literal">@EnableTransactionManagement</code>&#27880;&#35299;&#25552;&#20379;&#20102;&#31561;&#25928;&#30340;&#25903;&#25345;. &#21482;&#38656;&#35201;&#31616;&#21333;&#30340;
&#22312;&#31867;&#19978;&#28155;&#21152;<code class="literal">@Configuration</code>.&#22312;API&#25991;&#26723;&#20013;&#26597;&#30475;&#35814;&#32454;&#20449;&#24687;.</p>
</td></tr></table></div>

<div class="sidebar"><div class="titlepage"><div><div><p class="title"><b>&#26041;&#27861;&#21487;&#35265;&#24615;&#21644;@Transactional</b></p></div></div></div>

<p>&#24403;&#20351;&#29992;&#20195;&#29702;&#26102;, &#20320;&#24212;&#35813;&#21482;&#32473;<span class="emphasis"><em>public</em></span>&#21487;&#35265;&#24615;&#30340;&#26041;&#27861;&#28155;&#21152;<code class="literal">@Transactional</code>&#27880;&#35299;. &#22914;&#26524;&#20320;&#32473;protected,
private&#25110;&#32773;&#21253;&#35775;&#38382;&#30340;&#26041;&#27861;&#28155;&#21152;&#20102;<code class="literal">@Transactional</code>&#27880;&#35299;, &#19981;&#20250;&#20135;&#29983;&#38169;&#35823;, &#20294;&#26159;&#28155;&#21152;&#20102;&#27880;&#35299;&#30340;&#26041;&#27861;&#24182;&#27809;&#26377;&#30495;&#27491;&#30340;
&#37197;&#32622;&#20102;&#20107;&#21153;. &#22914;&#26524;&#20320;&#38656;&#35201;&#32473;&#38750;&#20844;&#24320;&#30340;&#26041;&#27861;&#28155;&#21152;&#27880;&#35299;&#21487;&#20197;&#21442;&#32771;AspectJ (&#21442;&#30475;&#21518;&#38754;).</p>
</div>

<p>&#20320;&#21487;&#20197;&#25226;<code class="literal">@Transactional</code>&#27880;&#35299;&#28155;&#21152;&#22312;&#25509;&#21475;&#23450;&#20041;&#12289;&#25509;&#21475;&#20013;&#30340;&#26041;&#27861;&#23450;&#20041;&#12289;&#31867;&#23450;&#20041;&#12289;&#25110;&#32773;&#19968;&#20010;&#31867;&#20013;<span class="emphasis"><em>public</em></span>&#26041;&#27861;&#30340;
&#21069;&#38754;. &#28982;&#32780;, &#20165;&#20165;&#26377;<code class="literal">@Transactional</code>&#27880;&#35299;&#30340;&#23384;&#22312;&#36824;&#19981;&#36275;&#20197;&#20351;&#20107;&#21153;&#30340;&#34892;&#20026;&#29983;&#25928;. <code class="literal">@Transactional</code>&#27880;&#35299;&#20165;&#20165;&#26159;
&#19968;&#20010;&#29992;&#26469;&#35753;&#26576;&#20123;&#36816;&#34892;&#26399;<code class="literal">@Transactional</code>-&#21457;&#29616;&#30340;&#22522;&#30784;&#26500;&#20214;&#26469;&#21457;&#29616;&#30340;&#20803;&#25968;&#25454;, &#24182;&#19988;&#36825;&#20123;&#21457;&#29616;&#36824;&#20250;&#20351;&#29992;&#36825;&#20010;&#20803;&#25968;&#25454;
&#26469;&#37197;&#32622;bean&#30340;&#20107;&#21153;&#34892;&#20026;. &#22312;&#21069;&#38754;&#30340;&#20363;&#23376;&#20013;, &#20803;&#32032;`&lt;tx:annotation-driven/&gt;`<span class="emphasis"><em>&#24320;&#21551;&#20102;</em></span>&#20107;&#21153;&#34892;&#20026;.</p>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/tip.png"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">
<p>Spring&#24314;&#35758;&#20320;&#21482;&#20026;&#20855;&#20307;&#31867;(&#20197;&#21450;&#20855;&#20307;&#31867;&#30340;&#26041;&#27861;)&#28155;&#21152;<code class="literal">@Transactional</code>&#27880;&#35299;, &#32780;&#19981;&#35201;&#32473;&#25509;&#21475;&#28155;&#21152;&#27880;&#35299;. &#20320;&#24403;&#28982;
&#20063;&#21487;&#20197;&#32473;&#25509;&#21475;(&#25110;&#32773;&#25509;&#21475;&#20013;&#30340;&#26041;&#27861;)&#28155;&#21152;&#27880;&#35299;, &#20294;&#26159;&#36825;&#21482;&#20250;&#22312;&#20320;&#26399;&#26395;&#30340;&#20351;&#29992;&#30340;&#20195;&#29702;&#26102;&#22522;&#20110;&#25509;&#21475;&#30340;&#26102;&#20505;&#24037;&#20316;. Java&#20013;&#30340;
&#27880;&#35299;<span class="emphasis"><em>&#19981;&#20250;&#20174;&#25509;&#21475;&#32487;&#25215;</em></span>&#30340;&#20107;&#23454;&#24847;&#21619;&#30528;&#22914;&#26524;&#20320;&#26159;&#20351;&#29992;&#30340;&#22522;&#20110;&#31867;&#30340;&#20195;&#29702;( <code class="literal">proxy-target-class="true"</code>)&#25110;&#32773;&#22522;&#20110;
&#32534;&#32455;&#30340;&#26041;&#38754;( <code class="literal">mode="aspectj"</code>), &#37027;&#20040;&#20851;&#20110;&#20107;&#21153;&#30340;&#35774;&#32622;&#19981;&#20250;&#34987;&#20195;&#29702;&#25110;&#32773;&#32534;&#32455;&#30340;&#22522;&#30784;&#35774;&#26045;&#27880;&#20876;, &#24182;&#19988;&#23545;&#35937;&#23601;&#19981;&#20250;
&#34987;&#20107;&#21153;&#22411;&#30340;&#20195;&#29702;&#21253;&#35013;, &#32780;&#36825;&#24403;&#28982;&#26159;<span class="emphasis"><em>&#19981;&#22909;</em></span>&#30340;.</p>
</td></tr></table></div>

<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>&#22312;&#20195;&#29702;&#27169;&#24335;&#19979;(&#40664;&#35748;&#20540;), &#21482;&#26377;&#26469;&#33258;&#22806;&#37096;&#26041;&#27861;&#30340;&#35843;&#29992;&#25165;&#20250;&#34987;&#20195;&#29702;&#25318;&#25130;. &#36825;&#24847;&#21619;&#30528;&#33258;&#25105;&#35843;&#29992;, &#22312;&#25928;&#26524;&#19978;&#26159;, &#30446;&#26631;&#23545;&#35937;&#30340;
&#19968;&#20010;&#26041;&#27861;&#35843;&#29992;&#20102;&#30446;&#26631;&#23545;&#35937;&#30340;&#21478;&#19968;&#20010;&#26041;&#27861;, &#19981;&#20250;&#23548;&#33268;&#20135;&#29983;&#36816;&#34892;&#26399;&#30340;&#20107;&#21153;, &#21363;&#20351;&#34987;&#35843;&#29992;&#30340;&#26041;&#27861;&#34987;<code class="literal">@Transactional</code>
&#26631;&#35760;&#20102;.</p>
</td></tr></table></div>

<p>&#22914;&#26524;&#20320;&#24819;&#35201;&#33258;&#25105;&#35843;&#29992;&#20063;&#21516;&#26679;&#34987;&#20107;&#21153;&#21253;&#35013;&#30340;&#35805;, &#21442;&#32771;AspectJ&#27169;&#24335;&#30340;&#20351;&#29992;(&#26597;&#30475;&#19979;&#38754;&#34920;&#26684;&#20013;&#30340;&#27169;&#24335;&#23646;&#24615;). &#22312;&#36825;&#31181;&#24773;&#20917;
&#19979;, &#39318;&#20808;&#23558;&#19981;&#20877;&#20250;&#26377;&#20195;&#29702;; &#21462;&#32780;&#20195;&#20043;, &#30446;&#26631;&#31867;&#23558;&#20250;&#34987;&#32534;&#32455;(&#20063;&#23601;&#26159;&#35828;, &#23427;&#30340;&#23383;&#33410;&#30721;&#20250;&#34987;&#20462;&#25913;)&#26469;&#20351;&#24471;
<code class="literal">@Transactional</code>&#25104;&#20026;&#20219;&#20309;&#26041;&#27861;&#22312;&#36816;&#34892;&#26399;&#30340;&#34892;&#20026;.</p>
<div class="table"><a name="tx-annotation-driven-settings" href="#tx-annotation-driven-settings"></a><p class="title"><b>Table&nbsp;11.2.&nbsp;&#22522;&#20110;&#27880;&#35299;&#30340;&#20107;&#21153;&#35774;&#32622;</b></p><div class="table-contents">

  <table summary="&#22522;&#20110;&#27880;&#35299;&#30340;&#20107;&#21153;&#35774;&#32622;" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="col_1"><col class="col_2"><col class="col_3"><col class="col_4"></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">XML&#23646;&#24615;</th><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">&#27880;&#35299;&#23646;&#24615;</th><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">&#40664;&#35748;&#20540;</th><th style="border-bottom: 0.5pt solid ; " align="left" valign="top">&#25551;&#36848;</th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">transaction-manager</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>N/A (&#26597;&#30475;<code class="literal">TransactionManagementConfigurer</code> &#30340;API&#25991;&#26723;)</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>transactionManager</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>&#35201;&#20351;&#29992;&#30340;&#20107;&#21153;&#31649;&#29702;&#30340;&#21517;&#23383;. &#21482;&#26377;&#22312;&#20107;&#21153;&#31649;&#29702;&#30340;&#21517;&#23383;&#19981;&#26159;<code class="literal">transactionManager</code>&#30340;&#26102;&#20505;&#26159;&#24517;&#39035;&#30340;, &#23601;&#20687;&#19978;&#38754;&#30340;
	&#20363;&#23376;&#19968;&#26679;.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">mode</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">mode</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>proxy</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>&#40664;&#35748;&#20540;"proxy"&#20351;&#24471;&#27880;&#35299;&#20102;&#30340;bean&#20351;&#29992;Spring&#30340;AOP&#26694;&#26550;&#26469;&#20195;&#29702;(&#20381;&#29031;&#20195;&#29702;&#30340;&#35821;&#20041;, &#23601;&#20687;&#19978;&#38754;&#35752;&#35770;&#30340;, &#21482;&#26377;&#22312;
	&#36890;&#36807;&#20195;&#29702;&#30340;&#26041;&#27861;&#35843;&#29992;&#26102;&#29983;&#25928;). &#20505;&#36873;&#30340;"aspectj"&#27169;&#24335;&#20351;&#29992;&#20102;Spring&#30340;AspectJ&#30340;&#20107;&#21153;&#26041;&#38754;&#26469;&#32534;&#32455;&#20102;&#30340;&#31867;&#26469;
	&#26367;&#25442;&#32534;&#32455;, &#20462;&#25913;&#30446;&#26631;&#31867;&#30340;&#23383;&#33410;&#30721;&#26469;&#23545;&#20219;&#20309;&#26041;&#27861;&#35843;&#29992;&#37117;&#20250;&#24212;&#29992;. AspectJ&#32534;&#32455;&#38656;&#35201;spring-aspects.jar&#23384;&#22312;&#20110;
	classpath&#20013;&#22914;&#26524;&#21152;&#36733;&#26102;&#32534;&#32455;(&#25110;&#32773;&#32534;&#35793;&#26102;&#32534;&#32455;)&#24320;&#21551;&#20102;.(&#26597;&#30475;<a class="xref" href="aop.html#aop-aj-ltw-spring" title="Spring configuration">the section called &#8220;Spring configuration&#8221;</a>&#20102;&#35299;&#20851;&#20110;&#22914;&#20309;&#35774;&#32622;
	&#21152;&#36733;&#26102;&#32534;&#32455;&#30340;&#35814;&#32454;&#20449;&#24687;.)</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">proxy-target-class</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">proxyTargetClass</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>false</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>&#21482;&#22312;&#20195;&#29702;&#27169;&#24335;&#29983;&#25928;. &#25511;&#21046;&#20351;&#29992;<code class="literal">@Transactional</code>&#27880;&#35299;&#30340;&#31867;&#23558;&#20250;&#21019;&#24314;&#20160;&#20040;&#31867;&#22411;&#30340;&#20107;&#21153;&#22411;&#20195;&#29702;. &#22914;&#26524;<code class="literal">proxy-target-class</code>
	&#23646;&#24615;&#35774;&#32622;&#20026;<code class="literal">true</code>, &#37027;&#20040;&#23558;&#20250;&#21019;&#24314;&#22522;&#20110;&#31867;&#30340;&#20195;&#29702;. &#22914;&#26524;<code class="literal">proxy-target-class</code>&#35774;&#32622;&#20026;<code class="literal">false</code>&#25110;&#32773;&#36825;&#20010;&#23646;&#24615;
	&#34987;&#24573;&#30053;&#20102;, &#37027;&#20040;&#23558;&#20250;&#21019;&#24314;&#26631;&#20934;&#30340;JDK&#30340;&#22522;&#20110;&#25509;&#21475;&#30340;&#20195;&#29702;. (&#26597;&#30475;<a class="xref" href="aop.html#aop-proxying" title="9.6&nbsp;Proxying mechanisms">Section&nbsp;9.6, &#8220;Proxying mechanisms&#8221;</a>&#20102;&#35299;&#19981;&#21516;&#20195;&#29702;&#31867;&#22411;&#30340;&#35814;&#32454;
	&#20449;&#24687;.)</p></td></tr><tr><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">order</code></p></td><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">order</code></p></td><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>Ordered.LOWEST_PRECEDENCE</p></td><td style="" align="left" valign="top"><p>&#23450;&#20041;&#24212;&#29992;&#22312;&#28155;&#21152;&#20102;<code class="literal">@Transactional</code>&#27880;&#35299;&#30340;bean&#19978;&#30340;&#20107;&#21153;&#36890;&#30693;&#30340;&#39034;&#24207;. (&#26356;&#22810;&#20851;&#20110;AOP&#36890;&#30693;&#30340;&#39034;&#24207;&#30340;&#20449;&#24687;, &#35831;
	&#26597;&#30475;<a class="xref" href="aop.html#aop-ataspectj-advice-ordering" title="Advice ordering">the section called &#8220;Advice ordering&#8221;</a>.) &#19981;&#25351;&#23450;&#39034;&#24207;&#24847;&#21619;&#30528;&#30001;AOP&#24213;&#23618;&#31995;&#32479;&#20915;&#23450;&#36890;&#30693;&#30340;&#39034;&#24207;.</p></td></tr></tbody></table>
</div></div><br class="table-break">

<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p><code class="literal">proxy-target-class</code>&#23646;&#24615;&#25511;&#21046;&#30528;&#20351;&#29992;<code class="literal">@Transactional</code>&#27880;&#35299;&#30340;&#31867;&#23558;&#20250;&#21019;&#24314;&#20160;&#20040;&#31867;&#22411;&#30340;&#20107;&#21153;&#22411;&#20195;&#29702;. &#22914;&#26524;
<code class="literal">proxy-target-class</code>&#34987;&#35774;&#32622;&#20026;<code class="literal">true</code>, &#23601;&#20250;&#21019;&#24314;&#22522;&#20110;&#31867;&#30340;&#20195;&#29702;. &#22914;&#26524;<code class="literal">proxy-target-class</code>&#35774;&#32622;&#20026;<code class="literal">false</code>
&#25110;&#32773;&#36825;&#20010;&#23646;&#24615;&#34987;&#24573;&#30053;&#20102;, &#23558;&#20250;&#21019;&#24314;&#26631;&#20934;&#30340;JDK&#30340;&#22522;&#20110;&#25509;&#21475;&#30340;&#20195;&#29702;&#20195;&#29702;. (&#26597;&#30475;<a class="xref" href="aop.html#aop-proxying" title="9.6&nbsp;Proxying mechanisms">Section&nbsp;9.6, &#8220;Proxying mechanisms&#8221;</a>&#20102;&#35299;&#20851;&#20110;&#19981;&#21516;
&#20195;&#29702;&#31867;&#22411;&#30340;&#35752;&#35770;.)</p>
</td></tr></table></div>

<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p><code class="literal">@EnableTransactionManagement</code>&#21644;<code class="literal">&lt;tx:annotation-driven/&gt;</code>&#21482;&#20250;&#26597;&#25214;&#22312;&#21516;&#19968;&#20010;&#24212;&#29992;&#19978;&#19979;&#25991;&#20013;&#23450;&#20041;&#30340;
bean&#30340;<code class="literal">@Transactional</code>&#27880;&#35299;. &#36825;&#24847;&#21619;&#30528;, &#22914;&#26524;&#20320;&#22312;&#19968;&#20010;<code class="literal">DispatcherServlet</code>&#30340;<code class="literal">WebApplicationContext</code>
&#20013;&#28155;&#21152;&#20102;&#27880;&#35299;&#39537;&#21160;&#30340;&#37197;&#32622;, &#37027;&#20040;&#21482;&#20250;&#22312;&#25511;&#21046;&#22120;&#20013;&#26597;&#25214;`@Transactional`bean, &#32780;&#19981;&#20250;&#26597;&#25214;&#26381;&#21153;&#23618;. &#26597;&#30475;
<a class="xref" href="mvc.html#mvc-servlet" title="16.2&nbsp;The DispatcherServlet">Section&nbsp;16.2, &#8220;The DispatcherServlet&#8221;</a>&#20102;&#35299;&#26356;&#22810;.</p>
</td></tr></table></div>

<p>&#22312;&#20915;&#23450;&#26041;&#27861;&#30340;&#20107;&#21153;&#35774;&#32622;&#26102;, &#26368;&#31934;&#30830;&#30340;&#37197;&#32622;&#20248;&#20808;. &#22312;&#19979;&#38754;&#30340;&#20363;&#23376;&#20013;, <code class="literal">DefaultFooService</code>&#26159;&#19968;&#20010;&#22312;&#31867;&#32423;&#21035;&#20351;&#29992;&#21482;&#35835;
&#20107;&#21153;&#35774;&#32622;&#30340;&#31867;, &#20294;&#26159;&#22312;&#21516;&#19968;&#20010;&#31867;&#30340;<code class="literal">updateFoo(Foo)</code>&#26041;&#27861;&#19978;&#30340;<code class="literal">@Transactional</code>&#27880;&#35299;&#20248;&#20808;&#20110;&#22312;&#31867;&#32423;&#21035;&#30340;&#20107;&#21153;&#35774;&#32622;.</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Transactional(readOnly = true)</span></em>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> DefaultFooService <span class="hl-keyword">implements</span> FooService {

    <span class="hl-keyword">public</span> Foo getFoo(String fooName) {
        <span class="hl-comment">// do something</span>
    }

    <span class="hl-comment">// &#35813;&#26041;&#27861;&#30340;&#35774;&#32622;&#26356;&#20248;&#20808;</span>
    <em><span class="hl-annotation" style="color: gray">@Transactional(readOnly = false, propagation = Propagation.REQUIRES_NEW)</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> updateFoo(Foo foo) {
        <span class="hl-comment">// do something</span>
    }
}</pre>

<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="transaction-declarative-attransactional-settings" href="#transaction-declarative-attransactional-settings"></a>@Transactional &#35774;&#32622;</h4></div></div></div>

<p><code class="literal">@Transactional</code>&#27880;&#35299;&#26159;&#19968;&#20010;&#29992;&#26469;&#23450;&#20041;&#19968;&#20010;&#25509;&#21475;&#12289;&#31867;&#25110;&#32773;&#26041;&#27861;&#24517;&#39035;&#20855;&#22791;&#20107;&#21153;&#21270;&#35821;&#20041;&#30340;&#20803;&#25968;&#25454;; &#20363;&#22914;, "<span class="emphasis"><em>&#22312;&#35843;&#29992;
&#35813;&#26041;&#27861;&#26102;&#25346;&#36215;&#25152;&#26377;&#24050;&#32463;&#23384;&#22312;&#30340;&#20107;&#21153;,&#24320;&#22987;&#19968;&#20010;&#26032;&#30340;&#21482;&#35835;&#20107;&#21153;</em></span>". &#19979;&#38754;&#26159;<code class="literal">@Transactional</code>&#27880;&#35299;&#30340;&#40664;&#35748;&#35774;&#32622;:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
&#20256;&#25773;&#35774;&#32622;&#26159;<code class="literal">PROPAGATION_REQUIRED.</code>
</li><li class="listitem">
&#38548;&#31163;&#31561;&#32423;&#26159;<code class="literal">ISOLATION_DEFAULT.</code>
</li><li class="listitem">
&#20107;&#21153;&#26159;&#21487;&#35835;&#21487;&#20889;&#30340;.
</li><li class="listitem">
&#20107;&#21153;&#36229;&#26102;&#26159;&#20351;&#29992;&#24213;&#23618;&#20107;&#21153;&#31995;&#32479;&#30340;&#40664;&#35748;&#20540;, &#25110;&#32773;&#22312;&#19981;&#25903;&#25345;&#26102;&#27809;&#26377;.
</li><li class="listitem">
&#20219;&#20309;&#30340;<code class="literal">RuntimeException</code>&#35302;&#21457;&#22238;&#28378;, &#24182;&#19988;&#25152;&#26377;&#30340;&#26816;&#26597;&#30340;<code class="literal">Exception</code>&#19981;&#35302;&#21457;.
</li></ul></div>

<p>&#36825;&#20123;&#40664;&#35748;&#35774;&#32622;&#37117;&#26159;&#21487;&#20197;&#20462;&#25913;&#30340;; <code class="literal">@Transactional</code>&#27880;&#35299;&#30340;&#21508;&#31181;&#23646;&#24615;&#37117;&#25972;&#29702;&#22312;&#19979;&#38754;&#30340;&#34920;&#26684;&#20013;&#20102;:</p>
<div class="table"><a name="tx-attransactional-properties" href="#tx-attransactional-properties"></a><p class="title"><b>Table&nbsp;11.3.&nbsp;@Transactional</b></p><div class="table-contents">

  <table summary="@Transactional" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="col_1"><col class="col_2"><col class="col_3"></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">&#23646;&#24615;</th><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">&#31867;&#22411;</th><th style="border-bottom: 0.5pt solid ; " align="left" valign="top">&#25551;&#36848;</th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="link" href="transaction.html#tx-multiple-tx-mgrs-with-attransactional" title="@Transactional &#20351;&#29992;&#22810;&#20010;&#20107;&#21153;&#31649;&#29702;&#22120;">value</a></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>String</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>&#25351;&#23450;&#20107;&#21153;&#31649;&#29702;&#22120;&#20351;&#29992;&#30340;&#21487;&#36873;&#38480;&#23450;&#31526;.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="link" href="transaction.html#tx-propagation" title="11.5.7&nbsp;&#20107;&#21153;&#20256;&#25773;&#24615;">propagation</a></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>enum: <code class="literal">Propagation</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>&#25351;&#23450;&#20256;&#25773;&#23646;&#24615;&#35774;&#32622;.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">isolation</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>enum: <code class="literal">Isolation</code></p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>&#25351;&#23450;&#38548;&#31163;&#31561;&#32423;.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">readOnly</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>boolean</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>&#35774;&#32622;&#20107;&#21153;&#26159;&#21487;&#35835;&#21487;&#20889;&#36824;&#26159;&#21482;&#35835;</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">timeout</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>int (&#29992;&#31186;&#20316;&#20026;&#31890;&#24230;)</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>&#20107;&#21153;&#36229;&#26102;.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">rollbackFor</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">Class</code>&#23545;&#35937;&#25968;&#32452;, &#24517;&#39035;&#26159;&#32487;&#25215;&#33258;<code class="literal">Throwable.</code>&#30340;</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>&#25351;&#23450; <span class="emphasis"><em>&#24517;&#23450;&#20250;</em></span>&#35302;&#21457;&#22238;&#28378;&#30340;&#31867;&#30340;&#25968;&#32452;.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">rollbackForClassName</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>&#31867;&#21517;&#30340;&#25968;&#32452;. &#31867;&#24517;&#39035;&#26159;&#32487;&#25215;&#33258;<code class="literal">Throwable.</code>&#30340;</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>&#25351;&#23450; <span class="emphasis"><em>&#24517;&#23450;&#20250;</em></span>&#35302;&#21457;&#22238;&#28378;&#30340;&#24322;&#24120;&#31867;&#30340;&#25968;&#32452;.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">noRollbackFor</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">Class</code>&#23545;&#35937;&#30340;&#25968;&#32452;, &#36825;&#20123;&#31867;&#24517;&#39035;&#26159;&#32487;&#25215;&#33258;<code class="literal">Throwable.</code>&#30340;</p></td><td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>&#25351;&#23450; <span class="emphasis"><em>&#24517;&#23450;&#19981;&#20250;</em></span>&#35302;&#21457;&#22238;&#28378;&#30340;&#31867;&#30340;&#25968;&#32452;.</p></td></tr><tr><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">noRollbackForClassName</code></p></td><td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>&#31867;&#30340;&#23383;&#31526;&#20018;&#25968;&#32452;, &#36825;&#20123;&#31867;&#37117;&#24517;&#39035;&#32487;&#25215;&#33258;<code class="literal">Throwable.</code></p></td><td style="" align="left" valign="top"><p>&#25351;&#23450; <span class="emphasis"><em>&#24517;&#23450;&#19981;&#20250;</em></span>&#35302;&#21457;&#22238;&#28378;&#30340;&#24322;&#24120;&#31867;&#30340;&#25968;&#32452;.</p></td></tr></tbody></table>
</div></div><br class="table-break">

<p>&#24403;&#21069;&#20320;&#36824;&#19981;&#21487;&#33021;&#26126;&#30830;&#25317;&#26377;&#36890;&#36807;&#21517;&#31216;&#23545;&#20107;&#21153;&#30340;&#25511;&#21046;&#21147;, &#22914;&#26524;&#21487;&#20197;&#30340;&#35805;(&#20363;&#22914;, WebLogic&#30340;&#20107;&#21153;&#35760;&#24405;&#22120;), &#36825;&#20010;<span class="emphasis"><em>&#21517;&#31216;</em></span>
&#25351;&#30340;&#26159;&#22312;&#20107;&#21153;&#35760;&#24405;&#22120;&#20013;&#26174;&#31034;&#30340;&#20107;&#21153;&#21517;&#31216;, &#20063;&#26159;&#22312;&#26085;&#24535;&#36755;&#20986;&#20013;. &#23545;&#20110;&#22768;&#26126;&#24335;&#20107;&#21153;, &#20107;&#29289;&#30340;&#21517;&#31216;&#24635;&#26159;&#31867;&#30340;&#23436;&#25972;&#38480;&#23450;&#21517;+
"."+&#20107;&#21153;&#21270;&#36890;&#30693;&#37197;&#32622;&#30340;&#26041;&#27861;&#21517;. &#20363;&#22914;, &#22914;&#26524;<code class="literal">BusinessService</code>&#31867;&#30340;<code class="literal">handlePayment(..)</code>&#26041;&#27861;&#25171;&#24320;&#20102;&#19968;&#20010;
&#20107;&#21153;, &#37027;&#20040;&#21517;&#23383;&#23601;&#20250;&#26159;: <code class="literal">com.foo.BusinessService.handlePayment</code>.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="tx-multiple-tx-mgrs-with-attransactional" href="#tx-multiple-tx-mgrs-with-attransactional"></a>@Transactional &#20351;&#29992;&#22810;&#20010;&#20107;&#21153;&#31649;&#29702;&#22120;</h4></div></div></div>

<p>&#22823;&#22810;&#25968;&#30340;Spring&#24212;&#29992;&#37117;&#21482;&#38656;&#35201;&#19968;&#20010;&#20107;&#21153;&#31649;&#29702;&#22120;, &#20294;&#20063;&#23384;&#22312;&#20320;&#38656;&#35201;&#22312;&#19968;&#20010;&#21333;&#19968;&#24212;&#29992;&#20013;&#20351;&#29992;&#22810;&#20010;&#19981;&#21516;&#30340;&#20107;&#21153;&#31649;&#29702;&#22120;&#30340;&#24773;&#20917;.
<code class="literal">@Transactional</code>&#27880;&#35299;&#30340;value&#23646;&#24615;&#21487;&#20197;&#29992;&#26469;&#25351;&#23450;&#35201;&#20351;&#29992;&#30340;&#19981;&#21516;&#30340;<code class="literal">PlatformTransactionManager</code>. &#36825;&#21487;&#20197;&#26159;
bean&#30340;&#21517;&#31216;&#25110;&#32773;&#26159;&#20107;&#21153;&#31649;&#29702;&#22120;bean&#30340;&#20462;&#39280;&#20540;. &#20363;&#22914;, &#35201;&#20351;&#29992;&#20462;&#39280;&#31526;&#21495;, &#19979;&#38754;&#30340;Java&#20195;&#30721;</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> TransactionalService {

    <em><span class="hl-annotation" style="color: gray">@Transactional("order")</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setSomething(String name) { ... }

    <em><span class="hl-annotation" style="color: gray">@Transactional("account")</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> doSomething() { ... }
}</pre>

<p>&#21487;&#20197;&#21644;&#19979;&#38754;&#22312;&#24212;&#29992;&#19978;&#19979;&#25991;&#22768;&#26126;&#30340;&#20107;&#21153;&#31649;&#29702;&#22120;&#30340;bean&#36827;&#34892;&#32465;&#23450;.</p>
<pre class="programlisting"><span class="hl-tag">&lt;tx:annotation-driven/&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"transactionManager1"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span><span class="hl-tag">&gt;</span>
        ...
        <span class="hl-tag">&lt;qualifier</span> <span class="hl-attribute">value</span>=<span class="hl-value">"order"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"transactionManager2"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span><span class="hl-tag">&gt;</span>
        ...
        <span class="hl-tag">&lt;qualifier</span> <span class="hl-attribute">value</span>=<span class="hl-value">"account"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span></pre>

<p>&#22312;&#36825;&#31181;&#24773;&#20917;&#19979;, <code class="literal">TransactionalService</code>&#20013;&#30340;&#20004;&#20010;&#26041;&#27861;&#23558;&#20250;&#20998;&#21035;&#36816;&#34892;&#22312;&#29420;&#31435;&#30340;&#20107;&#21153;&#31649;&#29702;&#22120;&#20013;, &#36890;&#36807;"order"&#21644;
"account"&#30340;&#20462;&#39280;&#31526;&#26469;&#21306;&#20998;. &#40664;&#35748;&#30340;<code class="literal">&lt;tx:annotation-driven&gt;</code>&#30340;&#30446;&#26631;bean&#30340;&#21517;&#31216;<code class="literal">transactionManager</code>
&#20173;&#28982;&#23558;&#20250;&#22312;&#25351;&#23450;&#30340;<code class="literal">PlatformTransactionManager</code>&#30340;bean&#30340;&#20462;&#39280;&#31526;&#21495;&#27809;&#26377;&#34987;&#25214;&#21040;&#30340;&#26102;&#20505;&#20351;&#29992;.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="tx-custom-attributes" href="#tx-custom-attributes"></a>&#33258;&#23450;&#20041;&#24555;&#25463;&#27880;&#35299;</h4></div></div></div>

<p>&#22914;&#26524;&#20320;&#21457;&#29616;&#20320;&#21453;&#22797;&#22312;&#35768;&#22810;&#19981;&#21516;&#30340;&#26041;&#27861;&#19978;&#20351;&#29992;<code class="literal">@Transactional</code>&#27880;&#35299;&#30456;&#21516;&#30340;&#23646;&#24615;, &#37027;&#20040;
<a class="link" href="beans.html#beans-meta-annotations" title="5.10.2&nbsp;Meta-annotations">Spring&#30340;&#22522;&#30784;&#27880;&#35299;&#25903;&#25345;</a>&#23558;&#20801;&#35768;&#20320;&#38024;&#23545;&#20320;&#30340;&#29305;&#23450;&#20351;&#29992;&#22330;&#26223;&#33258;&#23450;&#20041;&#24555;&#25463;&#27880;&#35299;.
&#20363;&#22914;,&#23450;&#20041;&#22914;&#19979;&#30340;&#27880;&#35299;</p>
<pre class="programlisting"><em><span class="hl-annotation" style="color: gray">@Target({ElementType.METHOD, ElementType.TYPE})</span></em>
<em><span class="hl-annotation" style="color: gray">@Retention(RetentionPolicy.RUNTIME)</span></em>
<em><span class="hl-annotation" style="color: gray">@Transactional("order")</span></em>
<span class="hl-keyword">public</span> <em><span class="hl-annotation" style="color: gray">@interface</span></em> OrderTx {
}

<em><span class="hl-annotation" style="color: gray">@Target({ElementType.METHOD, ElementType.TYPE})</span></em>
<em><span class="hl-annotation" style="color: gray">@Retention(RetentionPolicy.RUNTIME)</span></em>
<em><span class="hl-annotation" style="color: gray">@Transactional("account")</span></em>
<span class="hl-keyword">public</span> <em><span class="hl-annotation" style="color: gray">@interface</span></em> AccountTx {
}</pre>

<p>&#23558;&#20801;&#35768;&#25105;&#20204;&#23558;&#21069;&#38754;&#31456;&#33410;&#30340;&#20363;&#23376;&#25913;&#20889;&#20026;</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> TransactionalService {

    <em><span class="hl-annotation" style="color: gray">@OrderTx</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setSomething(String name) { ... }

    <em><span class="hl-annotation" style="color: gray">@AccountTx</span></em>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> doSomething() { ... }
}</pre>

<p>&#36825;&#37324;&#25105;&#20204;&#20351;&#29992;&#20102;&#23450;&#20041;&#20107;&#21153;&#31649;&#29702;&#22120;&#30340;&#35821;&#27861;&#65292;&#20294;&#26159;&#25105;&#20204;&#23436;&#20840;&#21487;&#20197;&#21253;&#21547;&#36827;&#20256;&#25773;&#24615;&#34892;&#20026;&#12289;&#22238;&#28378;&#35268;&#21017;&#12289;&#36229;&#26102;&#31561;&#31561;.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="tx-propagation" href="#tx-propagation"></a>11.5.7&nbsp;&#20107;&#21153;&#20256;&#25773;&#24615;</h3></div></div></div>

<p>&#26412;&#37096;&#20998;&#35762;&#35299;&#19968;&#20123;&#20851;&#20110;Spring&#20107;&#21153;&#20256;&#25773;&#24615;&#34892;&#20026;&#30340;&#35821;&#20041;. &#35831;&#35760;&#20303;&#26412;&#37096;&#20998;&#24182;&#19981;&#26159;&#20171;&#32461;&#20107;&#21153;&#30340;&#20256;&#25773;&#24615;&#26412;&#36523;; &#23613;&#31649;&#23427;&#27604;Spring
&#20013;&#30340;&#20107;&#21153;&#20256;&#25773;&#24615;&#26356;&#21152;&#35814;&#32454;.</p>
<p>&#22312;Spring&#30340;&#21463;&#31649;&#20107;&#21153;&#20013;, &#23384;&#22312;<span class="emphasis"><em>&#29289;&#29702;</em></span>&#21644;<span class="emphasis"><em>&#36923;&#36753;</em></span>&#20107;&#21153;&#30340;&#24046;&#21035;, &#20197;&#21450;&#36824;&#26377;&#20256;&#25773;&#24615;&#30340;&#35774;&#32622;&#26159;&#24590;&#26679;&#22312;&#36825;&#31181;&#24046;&#21035;&#19978;&#29983;&#25928;&#30340;.</p>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="tx-propagation-required" href="#tx-propagation-required"></a>&#38656;&#35201; Required</h4></div></div></div>

<div class="figure"><a name="d5e11362" href="#d5e11362"></a><p class="title"><b>Figure&nbsp;11.2.&nbsp;</b></p><div class="figure-contents">
  <div class="mediaobject"><img src="images/tx_prop_required.png" alt="tx prop required"></div>
</div></div><br class="figure-break">

<p>PROPAGATION_REQUIRED</p>
<p>&#24403;&#20256;&#25773;&#23646;&#24615;&#35774;&#32622;&#20026;<code class="literal">PROPAGATION_REQUIRED</code>&#26102;, &#23558;&#20250;&#20026;&#35774;&#32622;&#24212;&#29992;&#21040;&#30340;&#27599;&#19968;&#20010;&#26041;&#27861;&#21019;&#24314;&#19968;&#20010;<span class="emphasis"><em>&#36923;&#36753;&#19978;&#30340;</em></span>&#20107;&#21153;
&#20316;&#29992;&#22495;. &#36825;&#27599;&#19968;&#20010;&#21333;&#29420;&#30340;&#36923;&#36753;&#20107;&#21153;&#20316;&#29992;&#22495;&#21487;&#20197;&#21333;&#29420;&#30340;&#30830;&#23450;&#22238;&#28378;&#29366;&#24577;, &#22312;&#36923;&#36753;&#19978;&#29420;&#31435;&#20110;&#20107;&#21153;&#33539;&#22260;&#30340;&#22806;&#37096;&#20107;&#21153;&#33539;&#22260;.
&#24403;&#28982;, &#32771;&#34385;&#21040;&#26631;&#20934;&#30340;<code class="literal">PROPAGATION_REQUIRED</code>&#30340;&#34892;&#20026;, &#25152;&#26377;&#30340;&#36825;&#20123;&#20316;&#29992;&#22495;&#37117;&#23558;&#20250;&#26144;&#23556;&#21040;&#30456;&#21516;&#30340;&#29289;&#29702;&#20107;&#21153;&#19978;.
&#22240;&#27492;, &#22312;&#20869;&#37096;&#20107;&#21153;&#20316;&#29992;&#22495;&#20013;&#20316;&#30340;&#20107;&#21153;&#22238;&#28378;&#26631;&#35760;&#30830;&#23454;&#20250;&#24433;&#21709;&#21040;&#22806;&#37096;&#20107;&#29289;&#23454;&#38469;&#19978;&#25552;&#20132;&#30340;&#21487;&#33021;&#24615;(&#36825;&#21644;&#20320;&#25152;&#26399;&#24453;&#30340;&#19968;&#26679;).</p>
<p>&#28982;&#32780;, &#22312;&#20869;&#37096;&#20107;&#21153;&#20316;&#29992;&#22495;&#20013;&#26631;&#35760;&#20102;&#22238;&#28378;, &#22806;&#37096;&#20107;&#29289;&#20915;&#23450;&#23427;&#33258;&#24049;&#19981;&#22238;&#28378;&#30340;&#24773;&#20917;&#19979;, &#36825;&#26679;&#30340;&#22238;&#28378;(&#30001;&#20869;&#37096;&#20107;&#21153;&#20316;&#29992;&#22495;
&#38745;&#40664;&#35302;&#21457;)&#23601;&#19981;&#26159;&#26399;&#24453;&#30340;&#20102;. &#19968;&#20010;&#23545;&#24212;&#30340;<code class="literal">UnexpectedRollbackException</code>&#23558;&#20250;&#22312;&#22312;&#37027;&#37324;&#25243;&#20986;. &#36825;&#26159;&#19968;&#20010;<span class="emphasis"><em>&#24322;&#24120;
&#34892;&#20026;</em></span>, &#25152;&#20197;&#20107;&#21153;&#30340;&#35843;&#29992;&#32773;&#23558;&#19981;&#21487;&#33021;&#20250;&#22312;&#20107;&#21153;&#20854;&#23454;&#27809;&#26377;&#25552;&#20132;&#30340;&#26102;&#20505;&#34987;&#35823;&#23548;&#20026;&#20551;&#35774;&#25552;&#20132;&#20102;. &#25152;&#20197;&#23545;&#20110;&#20869;&#37096;&#20107;&#21153;&#20316;&#29992;&#22495;
(&#22312;&#22806;&#37096;&#35843;&#29992;&#32773;&#27809;&#26377;&#21457;&#35273;&#26102;)&#38745;&#40664;&#30340;&#26631;&#35760;&#20102;&#22238;&#28378;&#30340;&#24773;&#20917;&#19979;, &#22806;&#37096;&#35843;&#29992;&#32773;&#35843;&#29992;&#20102;&#25552;&#20132;. &#37027;&#20040;&#22806;&#37096;&#35843;&#29992;&#32773;&#38656;&#35201;&#25910;&#21040;&#19968;&#20010;
<code class="literal">UnexpectedRollbackException</code>&#26469;&#28165;&#26970;&#30340;&#30693;&#36947;&#38656;&#35201;&#29992;&#19968;&#20010;&#22238;&#28378;&#26469;&#21462;&#32780;&#20195;&#20043;(&#25552;&#20132;).</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="tx-propagation-requires_new" href="#tx-propagation-requires_new"></a>&#38656;&#35201;&#26032;&#30340; RequiresNew</h4></div></div></div>

<div class="figure"><a name="d5e11379" href="#d5e11379"></a><p class="title"><b>Figure&nbsp;11.3.&nbsp;</b></p><div class="figure-contents">
  <div class="mediaobject"><img src="images/tx_prop_requires_new.png" alt="tx prop requires new"></div>
</div></div><br class="figure-break">

<p>PROPAGATION_REQUIRES_NEW</p>
<p>&#30456;&#27604;&#36739;&#20110;<code class="literal">PROPAGATION_REQUIRED</code>, <code class="literal">PROPAGATION_REQUIRES_NEW</code>&#23545;&#27599;&#19968;&#20010;&#21463;&#24433;&#21709;&#30340;&#20107;&#21153;&#20316;&#29992;&#22495;&#37117;&#20351;&#29992;<span class="emphasis"><em>&#23436;&#20840;</em></span>
&#29420;&#31435;&#30340;&#20107;&#21153;. &#36825;&#26679;, &#29289;&#29702;&#19978;&#30340;&#20107;&#21153;&#23601;&#19981;&#21516;&#20102;&#24182;&#19988;&#21487;&#20197;&#29420;&#31435;&#30340;&#25552;&#20132;&#25110;&#32773;&#22238;&#28378;, &#22806;&#37096;&#20107;&#29289;&#19981;&#20250;&#24433;&#21709;&#21040;&#20869;&#37096;&#20107;&#21153;&#30340;&#22238;&#28378;
&#29366;&#24577;.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="tx-propagation-nested" href="#tx-propagation-nested"></a>&#23884;&#22871; Nested</h4></div></div></div>

<p><code class="literal">PROPAGATION_NESTED</code>&#23545;&#22810;&#20010;&#21487;&#20197;&#22238;&#28378;&#21040;&#30340;&#20445;&#23384;&#28857;&#20351;&#29992;&#20102;&#19968;&#20010;<span class="emphasis"><em>&#21333;&#29420;&#30340;</em></span>&#24213;&#23618;&#20107;&#21153;. &#36825;&#31181;&#23616;&#37096;&#21270;&#30340;&#22238;&#28378;&#20801;&#35768;&#19968;&#20010;
&#20869;&#37096;&#20107;&#21153;&#35302;&#21457;&#19968;&#20010;<span class="emphasis"><em>&#38024;&#23545;&#23427;&#30340;&#20316;&#29992;&#22495;</em></span>&#30340;&#22238;&#28378;, &#23613;&#31649;&#19968;&#20123;&#25805;&#20316;&#24050;&#32463;&#22238;&#28378;&#20102;, &#20294;&#22806;&#37096;&#20107;&#29289;&#36824;&#26159;&#21487;&#20197;&#32487;&#32493;&#29289;&#29702;&#19978;&#30340;&#20107;&#21153;.
&#36825;&#20010;&#35774;&#32622;&#36890;&#24120;&#37117;&#21644;JDBC&#30340;&#20445;&#23384;&#28857;&#23545;&#24212;, &#25152;&#20197;&#21482;&#20250;&#22312;JDBC&#30340;&#36164;&#28304;&#30340;&#20107;&#21153;&#19978;&#26377;&#20316;&#29992;. &#35831;&#26597;&#30475;Spring&#30340;
<code class="literal">DataSourceTransactionManager</code>.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-declarative-applying-more-than-just-tx-advice" href="#transaction-declarative-applying-more-than-just-tx-advice"></a>11.5.8&nbsp;&#36890;&#30693;&#20107;&#21153;&#25805;&#20316;</h3></div></div></div>

<p>&#20551;&#35774;&#20320;&#24819;&#35201;<span class="emphasis"><em>&#21516;&#26102;</em></span>&#25191;&#34892;&#20107;&#21153;&#22411;&#30340;<span class="emphasis"><em>&#21644;</em></span>&#19968;&#20123;&#22522;&#26412;&#30340;&#20998;&#26512;&#36890;&#30693;. &#20320;&#24590;&#26679;&#22312;<code class="literal">&lt;tx:annotation-driven/&gt;</code>&#30340;&#19978;&#19979;&#25991;
&#20013;&#20307;&#29616;?</p>
<p>&#24403;&#20320;&#25191;&#34892;<code class="literal">updateFoo(Foo)</code>&#26041;&#27861;&#26102;, &#20320;&#26399;&#26395;&#30475;&#21040;&#19979;&#38754;&#30340;&#21160;&#20316;:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
&#37197;&#32622;&#20102;&#20998;&#26512;&#36890;&#30693;&#30340;&#20999;&#38754;&#21551;&#21160;.
</li><li class="listitem">
&#20107;&#21153;&#36890;&#30693;&#25191;&#34892;.
</li><li class="listitem">
&#34987;&#28155;&#21152;&#20102;&#36890;&#30693;&#30340;&#23545;&#35937;&#30340;&#26041;&#27861;&#25191;&#34892;.
</li><li class="listitem">
&#25552;&#20132;&#20107;&#21153;.
</li><li class="listitem">
&#20998;&#26512;&#20999;&#38754;&#25253;&#21578;&#25972;&#20010;&#20107;&#21153;&#26041;&#27861;&#25191;&#34892;&#30340;&#20934;&#30830;&#26102;&#38388;.
</li></ul></div>

<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>&#26412;&#31456;&#33410;&#19981;&#20250;&#35814;&#32454;&#38416;&#36848;AOP(&#38500;&#20102;&#36866;&#29992;&#20110;&#20107;&#21153;). &#26597;&#30475;<a class="xref" href="aop.html" title="9.&nbsp;Aspect Oriented Programming with Spring">Chapter&nbsp;9, <i>Aspect Oriented Programming with Spring</i></a>&#20102;&#35299;&#19979;&#38754;&#26377;&#20851;AOP&#37197;&#32622;&#30340;&#35814;&#32454;&#20449;&#24687;&#20197;&#21450;AOP&#30340;&#20854;&#20182;&#20449;&#24687;.</p>
</td></tr></table></div>

<p>&#36825;&#37324;&#26159;&#19978;&#38754;&#35752;&#35770;&#30340;&#31616;&#21333;&#20998;&#26512;&#20999;&#38754;&#30340;&#20195;&#30721;. &#36890;&#30693;&#30340;&#25490;&#24207;&#30001;<code class="literal">Ordered</code>&#25509;&#21475;&#25511;&#21046;. &#23436;&#25972;&#30340;&#36890;&#30693;&#25490;&#24207;&#30340;&#20449;&#24687;&#35831;&#26597;&#30475;
<a class="xref" href="aop.html#aop-ataspectj-advice-ordering" title="Advice ordering">the section called &#8220;Advice ordering&#8221;</a>.</p>
<pre class="programlisting"><span class="hl-keyword">package</span> x.y;

<span class="hl-keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;
<span class="hl-keyword">import</span> org.springframework.util.StopWatch;
<span class="hl-keyword">import</span> org.springframework.core.Ordered;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleProfiler <span class="hl-keyword">implements</span> Ordered {

    <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> order;

    <span class="hl-comment">// &#20801;&#35768;&#25105;&#20204;&#23545;&#36890;&#30693;&#25490;&#24207;</span>
    <span class="hl-keyword">public</span> <span class="hl-keyword">int</span> getOrder() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.order;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setOrder(<span class="hl-keyword">int</span> order) {
        <span class="hl-keyword">this</span>.order = order;
    }

    <span class="hl-comment">// &#36825;&#20010;&#26041;&#27861;</span><span class="strong"><strong>&#26159;</strong></span>&#20851;&#20110;&#36890;&#30693;
    <span class="hl-keyword">public</span> Object profile(ProceedingJoinPoint call) <span class="hl-keyword">throws</span> Throwable {
        Object returnValue;
        StopWatch clock = <span class="hl-keyword">new</span> StopWatch(getClass().getName());
        <span class="hl-keyword">try</span> {
            clock.start(call.toShortString());
            returnValue = call.proceed();
        } <span class="hl-keyword">finally</span> {
            clock.stop();
            System.out.println(clock.prettyPrint());
        }
        <span class="hl-keyword">return</span> returnValue;
    }
}</pre>

<pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xmlns:aop</span>=<span class="hl-value">"http://www.springframework.org/schema/aop"</span>
    <span class="hl-attribute">xmlns:tx</span>=<span class="hl-value">"http://www.springframework.org/schema/tx"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/tx
        http://www.springframework.org/schema/tx/spring-tx.xsd
        http://www.springframework.org/schema/aop
        http://www.springframework.org/schema/aop/spring-aop.xsd"</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"fooService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.service.DefaultFooService"</span><span class="hl-tag">/&gt;</span>

    <span class="hl-comment">&lt;!-- &#36825;&#26159;&#20999;&#38754; --&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"profiler"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.SimpleProfiler"</span><span class="hl-tag">&gt;</span>
        <span class="hl-comment">&lt;!-- &#22312;&#20107;&#21153;&#36890;&#30693;&#20043;&#21069;&#25191;&#34892;(&#26356;&#20302;&#30340;&#25490;&#24207;) --&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"order"</span> <span class="hl-attribute">__value</span>=<span class="hl-value">"1"</span><span class="hl-attribute">__/&gt;</span>
    <span class="hl-attribute">&lt;/bean&gt;</span>

    <span class="hl-attribute">&lt;tx:annotation-driven</span> <span class="hl-attribute">transaction-manager</span>=<span class="hl-value">"txManager"</span> <span class="hl-attribute">__order</span>=<span class="hl-value">"200"</span><span class="hl-attribute">__/&gt;</span>

    <span class="hl-attribute">&lt;aop:config&gt;</span>
            <span class="hl-attribute">&lt;!--</span> <span class="hl-attribute">&#36825;&#20010;&#36890;&#30693;&#23558;&#20250;&#22312;&#20107;&#21153;&#36890;&#30693;&#25191;&#34892;&#26102;&#25191;&#34892;</span> <span class="hl-attribute">--&gt;</span>
            <span class="hl-attribute">&lt;aop:aspect</span> <span class="hl-attribute">id</span>=<span class="hl-value">"profilingAspect"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"profiler"</span><span class="hl-tag">&gt;</span>
                <span class="hl-tag">&lt;aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">"serviceMethodWithReturnValue"</span>
                        <span class="hl-attribute">expression</span>=<span class="hl-value">"execution(!void x.y..*Service.*(..))"</span><span class="hl-tag">/&gt;</span>
                <span class="hl-tag">&lt;aop:around</span> <span class="hl-attribute">method</span>=<span class="hl-value">"profile"</span> <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">"serviceMethodWithReturnValue"</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;/aop:aspect&gt;</span>
    <span class="hl-tag">&lt;/aop:config&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"dataSource"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.apache.commons.dbcp.BasicDataSource"</span> <span class="hl-attribute">destroy-method</span>=<span class="hl-value">"close"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"driverClassName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"oracle.jdbc.driver.OracleDriver"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"url"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"jdbc:oracle:thin:@rj-t42:1521:elvis"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"username"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"scott"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"password"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"tiger"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"txManager"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"dataSource"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"dataSource"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre>

<p>&#19978;&#38754;&#37197;&#32622;&#30340;&#32467;&#26524;&#23601;&#26159;&#23545;&#19968;&#20010;&#21483;&#20570;<code class="literal">fooService</code>&#30340;bean&#36827;&#34892;&#20998;&#26512;&#24182;&#19988;&#20063;<span class="emphasis"><em>&#22312;&#21512;&#36866;&#30340;&#39034;&#24207;</em></span>&#24212;&#29992;&#20102;&#20107;&#21153;&#20999;&#38754;. &#20320;&#20063;
&#21487;&#20197;&#20351;&#29992;&#30456;&#20284;&#30340;&#26041;&#27861;&#37197;&#32622;&#20219;&#20309;&#25968;&#23383;&#30340;&#34917;&#20805;&#20999;&#38754;.</p>
<p>&#19979;&#38754;&#30340;&#20363;&#23376;&#21644;&#19978;&#38754;&#30340;&#26377;&#19968;&#26679;&#30340;&#20316;&#29992;, &#20294;&#26159;&#20351;&#29992;&#20102;&#32431;&#31929;&#30340;XML&#22768;&#26126;&#26041;&#24335;.</p>
<pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="hl-attribute">xmlns:aop</span>=<span class="hl-value">"http://www.springframework.org/schema/aop"</span>
    <span class="hl-attribute">xmlns:tx</span>=<span class="hl-value">"http://www.springframework.org/schema/tx"</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/tx
        http://www.springframework.org/schema/tx/spring-tx.xsd
        http://www.springframework.org/schema/aop
        http://www.springframework.org/schema/aop/spring-aop.xsd"</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"fooService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.service.DefaultFooService"</span><span class="hl-tag">/&gt;</span>

    <span class="hl-comment">&lt;!-- &#20998;&#26512;&#36890;&#30693; --&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"profiler"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"x.y.SimpleProfiler"</span><span class="hl-tag">&gt;</span>
        <span class="hl-comment">&lt;!-- &#22312;&#20107;&#21153;&#36890;&#30693;&#20043;&#21069;&#25191;&#34892;(&#26356;&#20302;&#30340;&#25490;&#24207;&#25968;&#23383;) --&gt;</span>
        __<span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"order"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"1__"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;aop:config&gt;</span>
        <span class="hl-tag">&lt;aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">"entryPointMethod"</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"execution(* x.y..*Service.*(..))"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-comment">&lt;!-- &#23558;&#22312;&#20998;&#26512;&#30340;&#36890;&#30693;&#25191;&#34892;&#20043;&#21518;&#25191;&#34892;(&#27880;&#24847;order&#23646;&#24615;) --&gt;</span>

        <span class="hl-tag">&lt;aop:advisor</span> <span class="hl-attribute">advice-ref</span>=<span class="hl-value">"txAdvice"</span> <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">"entryPointMethod"</span> <span class="hl-attribute">__order</span>=<span class="hl-value">"2__"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-comment">&lt;!-- order&#30340;&#20540;&#27604;&#20998;&#26512;&#20999;&#38754;&#30340;&#39640; --&gt;</span>

        <span class="hl-tag">&lt;aop:aspect</span> <span class="hl-attribute">id</span>=<span class="hl-value">"profilingAspect"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"profiler"</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">"serviceMethodWithReturnValue"</span>
                    <span class="hl-attribute">expression</span>=<span class="hl-value">"execution(!void x.y..*Service.*(..))"</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;aop:around</span> <span class="hl-attribute">method</span>=<span class="hl-value">"profile"</span> <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">"serviceMethodWithReturnValue"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/aop:aspect&gt;</span>

    <span class="hl-tag">&lt;/aop:config&gt;</span>

    <span class="hl-tag">&lt;tx:advice</span> <span class="hl-attribute">id</span>=<span class="hl-value">"txAdvice"</span> <span class="hl-attribute">transaction-manager</span>=<span class="hl-value">"txManager"</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;tx:attributes&gt;</span>
            <span class="hl-tag">&lt;tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"get*"</span> <span class="hl-attribute">read-only</span>=<span class="hl-value">"true"</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">"*"</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/tx:attributes&gt;</span>
    <span class="hl-tag">&lt;/tx:advice&gt;</span>

    <span class="hl-comment">&lt;!-- &#20854;&#20182;&#30340;&lt;bean/&gt;&#30340;&#23450;&#20041;, &#22914;DataSource&#21644;PlatformTransactionManager --&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre>

<p>&#19978;&#38754;&#37197;&#32622;&#30340;&#32467;&#26524;&#23601;&#26159;&#20998;&#26512;&#19968;&#20010;&#21483;&#20570;<code class="literal">fooService</code>&#30340;bean&#24182;&#19988;&#22312;&#20182;&#20043;&#19978;&#24212;&#29992;&#20102;<span class="emphasis"><em>&#25351;&#23450;&#30340;</em></span>&#20107;&#21153;&#20999;&#38754;. &#22914;&#26524;&#20320;&#24819;&#35753;
&#20320;&#30340;&#20998;&#26512;&#36890;&#30693;&#22312;&#36827;&#20837;&#30340;&#26102;&#20505;&#22312;&#20107;&#21153;&#36890;&#30693;<span class="emphasis"><em>&#20043;&#21518;</em></span>&#25191;&#34892;, &#24182;&#19988;&#22312;&#20986;&#21435;&#30340;&#26102;&#20505;&#22312;&#20107;&#21153;&#36890;&#30693;<span class="emphasis"><em>&#20043;&#21069;</em></span>&#25191;&#34892;, &#20320;&#21482;&#38656;&#35201;
&#31616;&#21333;&#30340;&#20132;&#25442;&#20998;&#26512;&#20999;&#38754;bean&#30340;<code class="literal">order</code>&#23646;&#24615;&#30340;&#20540;, &#20351;&#24471;&#23427;&#27604;&#20107;&#21153;&#36890;&#30693;&#30340;&#25490;&#24207;&#20540;&#26356;&#39640;&#23601;&#34892;.</p>
<p>&#20320;&#37197;&#32622;&#20854;&#20182;&#20999;&#38754;&#20063;&#20351;&#29992;&#31867;&#20284;&#30340;&#26041;&#24335;.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-declarative-aspectj" href="#transaction-declarative-aspectj"></a>11.5.9&nbsp;&#19982;AspectJ&#19968;&#36215;&#20351;&#29992;@Transactional</h3></div></div></div>

<p>&#20351;&#29992;Spring Framework&#30340;<code class="literal">@Transactional</code>&#26469;&#25903;&#25345;Spring&#23481;&#22120;&#22806;&#30001;AspectJ&#20999;&#38754;&#25152;&#23450;&#20041;&#30340;&#20107;&#21153;&#20063;&#26159;&#21487;&#20197;&#30340;.
&#35201;&#36825;&#26679;&#20570;, &#20320;&#39318;&#20808;&#38656;&#35201;&#22312;&#20320;&#30340;&#31867;(&#25110;&#32773;&#38024;&#23545;&#21487;&#36873;&#30340;&#31867;&#30340;&#26041;&#27861;)&#19978;&#20351;&#29992;<code class="literal">@Transactional</code>&#27880;&#35299;&#36827;&#34892;&#27880;&#35299;, &#28982;&#21518;&#20351;&#29992;
<code class="literal">spring-aspects.jar</code>&#25991;&#20214;&#37324;&#38754;&#23450;&#20041;&#30340;
<code class="literal">org.springframework.transaction.aspectj.AnnotationTransactionAspect</code>&#23545;&#24212;&#29992;&#36827;&#34892;&#38142;&#25509;(&#32534;&#32455;).
&#25351;&#23450;&#30340;&#20999;&#38754;&#20063;&#24517;&#39035;&#20351;&#29992;&#20107;&#21153;&#31649;&#29702;&#22120;&#36827;&#34892;&#37197;&#32622;. &#20320;&#24403;&#28982;&#21487;&#20197;&#20351;&#29992;Spring Framework&#30340;IoC&#23481;&#22120;&#26469;&#36127;&#36131;&#36827;&#34892;&#20999;&#38754;&#30340;
&#20381;&#36182;&#27880;&#20837;.&#37197;&#32622;&#20107;&#21153;&#31649;&#29702;&#22120;&#20999;&#38754;&#30340;&#26368;&#31616;&#21333;&#26041;&#27861;&#26159;&#20351;&#29992;<code class="literal">&lt;tx:annotation-driven/&gt;</code>&#20803;&#32032;&#24182;&#19988;&#23545;&#23646;&#24615;<code class="literal">mode</code>&#20351;&#29992;
<a class="xref" href="transaction.html#transaction-declarative-annotations" title="11.5.6&nbsp;@Transactional &#30340;&#20351;&#29992;">Section&nbsp;11.5.6, &#8220;@Transactional &#30340;&#20351;&#29992;&#8221;</a>&#37324;&#38754;&#25551;&#36848;&#30340;<code class="literal">aspectj</code>. &#22240;&#20026;&#25105;&#20204;&#36825;&#37324;&#20851;&#27880;&#30340;&#26159;&#31243;&#24207;&#36816;&#34892;&#22312;
Spring&#23481;&#22120;&#22806;&#37096;, &#25152;&#20197;&#25105;&#20204;&#23558;&#21521;&#20320;&#23637;&#31034;&#32534;&#31243;&#24335;&#30340;&#26041;&#27861;.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>&#22312;&#24320;&#22987;&#20043;&#21069;, &#20320;&#21487;&#33021;&#38656;&#35201;&#20808;&#21435;&#38405;&#35835;<a class="xref" href="transaction.html#transaction-declarative-annotations" title="11.5.6&nbsp;@Transactional &#30340;&#20351;&#29992;">Section&nbsp;11.5.6, &#8220;@Transactional &#30340;&#20351;&#29992;&#8221;</a>&#21644;<a class="xref" href="aop.html" title="9.&nbsp;Aspect Oriented Programming with Spring">Chapter&nbsp;9, <i>Aspect Oriented Programming with Spring</i></a>.</p>
</td></tr></table></div>

<pre class="programlisting"><span class="hl-comment">// &#26500;&#36896;&#19968;&#20010;&#36866;&#24403;&#30340;&#20107;&#21153;&#31649;&#29702;&#22120;</span>
DataSourceTransactionManager txManager = <span class="hl-keyword">new</span> DataSourceTransactionManager(getDataSource());

<span class="hl-comment">// &#37197;&#32622;AnnotationTransactionAspect&#21435;&#20351;&#29992;&#23427;; &#36825;&#20010;&#25805;&#20316;&#24517;&#39035;&#22312;&#25191;&#34892;&#20107;&#21153;&#26041;&#27861;&#20043;&#21069;&#36827;&#34892;</span>
AnnotationTransactionAspect.aspectOf().setTransactionManager(txManager);</pre>

<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>&#24403;&#20351;&#29992;&#20999;&#38754;&#26102;, &#20320;&#24517;&#39035;&#22312;<span class="emphasis"><em>&#23454;&#29616;</em></span>&#31867;(&#20197;&#21450;/&#25110;&#32773;&#35828;&#36825;&#20123;&#31867;&#30340;&#26041;&#27861;)&#19978;&#36827;&#34892;&#27880;&#35299;, <span class="emphasis"><em>&#19981;&#35201;</em></span>&#22312;&#23454;&#29616;&#31867;&#30340;&#25509;&#21475;(&#22914;&#26524;&#26377;)&#19978;
&#27880;&#35299;. AspectJ&#36981;&#24490;Java&#30340;&#35268;&#21017;&#22312;&#25509;&#21475;&#19978;&#30340;&#27880;&#35299;<span class="emphasis"><em>&#19981;&#20250;&#32487;&#25215;</em></span>.</p>
</td></tr></table></div>

<p>&#22312;&#31867;&#19978;&#30340;<code class="literal">@Transactional</code>&#27880;&#35299;&#23450;&#20041;&#20102;&#25191;&#34892;&#31867;&#20013;&#25152;&#26377;&#26041;&#27861;&#30340;&#40664;&#35748;&#20107;&#21153;&#34892;&#20026;.</p>
<p>&#22312;&#31867;&#20013;&#26041;&#27861;&#19978;&#30340;<code class="literal">@Transactional</code>&#27880;&#35299;&#35206;&#30422;&#20102;&#30001;&#31867;&#19978;&#30340;&#27880;&#35299;(&#23384;&#22312;&#30340;&#35805;)&#23450;&#20041;&#30340;&#40664;&#35748;&#20107;&#21153;&#34892;&#20026;. &#20219;&#20309;&#26041;&#27861;&#22343;&#21487;&#20197;
&#34987;&#27880;&#35299;, &#19981;&#35770;&#20854;&#35775;&#38382;&#21487;&#35265;&#24615;&#22914;&#20309;.</p>
<p>&#20026;&#20102;&#20351;&#29992;<code class="literal">AnnotationTransactionAspect</code>&#32534;&#32455;&#20320;&#30340;&#24212;&#29992;&#20320;&#24517;&#39035;&#36830;&#21516;AspectJ&#36827;&#34892;&#26500;&#24314;(&#26597;&#30475;
<a class="ulink" href="http://www.eclipse.org/aspectj/doc/released/devguide/index.html" target="_top">AspectJ&#24320;&#21457;&#25351;&#21335;</a>)&#25110;&#32773;&#20351;&#29992;
&#21152;&#36733;&#26102;&#32534;&#32455;. &#26597;&#30475;<a class="xref" href="aop.html#aop-aj-ltw" title="9.8.4&nbsp;Load-time weaving with AspectJ in the Spring Framework">Section&nbsp;9.8.4, &#8220;Load-time weaving with AspectJ in the Spring Framework&#8221;</a>&#20102;&#35299;&#20851;&#20110;&#20351;&#29992;AspectJ&#36827;&#34892;&#21152;&#36733;&#26102;&#32534;&#32455;&#30340;&#35752;&#35770;.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="transaction-programmatic" href="#transaction-programmatic"></a>11.6&nbsp;&#32534;&#31243;&#24335;&#20107;&#21153;&#31649;&#29702;</h2></div></div></div>

<p>Spring Framework&#25552;&#20379;&#20102;&#20004;&#31181;&#26041;&#24335;&#30340;&#32534;&#31243;&#24335;&#20107;&#21153;&#31649;&#29702;:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
&#20351;&#29992;<code class="literal">TransactionTemplate</code>.
</li><li class="listitem">
&#30452;&#25509;&#20351;&#29992;<code class="literal">PlatformTransactionManager</code>&#30340;&#19968;&#20010;&#23454;&#29616;.
</li></ul></div>

<p>Spring&#19968;&#33324;&#37117;&#25512;&#33616;&#20351;&#29992;<code class="literal">TransactionTemplate</code>&#26469;&#36827;&#34892;&#32534;&#31243;&#24335;&#20107;&#21153;&#31649;&#29702;. &#31532;&#20108;&#31181;&#26041;&#24335;&#26377;&#28857;&#31867;&#20284;&#20110;&#20351;&#29992;JTA&#30340;
<code class="literal">UserTransaction</code>&#25509;&#21475;, &#23613;&#31649;&#24322;&#24120;&#22788;&#29702;&#27809;&#26377;&#37027;&#20040;&#22797;&#26434;&#21270;&#20102;.</p>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="tx-prog-template" href="#tx-prog-template"></a>11.6.1&nbsp;&#20351;&#29992;TransactionTemplate</h3></div></div></div>

<p><code class="literal">TransactionTemplate</code>&#37319;&#29992;&#20102;&#20687;<code class="literal">JdbcTemplate</code>&#31561;&#20854;&#20182;Spring&#30340;<span class="emphasis"><em>templates</em></span>&#30340;&#19968;&#26679;&#30340;&#26041;&#24335;. &#23427;&#25165;&#29992;&#20102;
&#22238;&#35843;&#30340;&#26041;&#24335;&#26469;&#20351;&#24471;&#24212;&#29992;&#30340;&#20195;&#30721;&#33073;&#31163;&#38656;&#35201;&#30340;&#26679;&#26412;&#37319;&#38598;&#21644;&#39135;&#29289;&#36164;&#28304;&#37322;&#25918;, &#24182;&#19988;&#22312;&#20195;&#30721;&#20013;&#34920;&#29616;&#20026;&#24847;&#22270;&#39537;&#21160;, &#36825;&#26679;&#20195;&#30721;&#30340;
&#32534;&#20889;&#23601;&#21487;&#20197;&#23436;&#20840;&#21482;&#20851;&#27880;&#20110;&#24320;&#21457;&#20154;&#21592;&#24819;&#35201;&#20570;&#30340;&#37096;&#20998;.</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
<p>&#23601;&#20687;&#20320;&#23558;&#22312;&#19979;&#38754;&#30340;&#20363;&#23376;&#20013;&#30475;&#21040;&#30340;&#37027;&#26679;, &#20351;&#29992;<code class="literal">TransactionTemplate</code>&#20250;&#25226;&#20320;&#21644;Spring&#30340;&#20107;&#21153;&#22522;&#30784;&#35774;&#26045;&#21644;API&#32465;&#23450;
&#22312;&#19968;&#36215;. &#29992;&#19982;&#19981;&#29992;&#32534;&#31243;&#24335;&#20107;&#21153;&#31649;&#29702;&#26159;&#19981;&#26159;&#31526;&#21512;&#20320;&#20204;&#24320;&#21457;&#30340;&#38656;&#27714;&#21462;&#20915;&#20110;&#20320;&#33258;&#24049;.</p>
</td></tr></table></div>

<p>&#24212;&#29992;&#20195;&#30721;&#24517;&#39035;&#22312;&#20107;&#21153;&#19978;&#19979;&#25991;&#20013;&#25191;&#34892;, &#24182;&#19988;&#24517;&#39035;&#26174;&#31034;&#22320;&#20351;&#29992;<code class="literal">TransactionTemplate</code>, &#30475;&#36215;&#26469;&#23601;&#20687;&#19979;&#38754;&#36825;&#26679;. &#20320;,
&#20316;&#20026;&#19968;&#21517;&#24320;&#21457;&#32773;, &#32534;&#20889;&#19968;&#20010;<code class="literal">TransactionCallback</code>&#30340;&#23454;&#29616;&#31867;(&#36890;&#24120;&#34920;&#29616;&#20026;&#19968;&#20010;&#21311;&#21517;&#20869;&#37096;&#31867;)&#26469;&#21253;&#21547;&#38656;&#35201;&#22312;&#20107;&#21153;
&#19978;&#19979;&#25991;&#20013;&#25191;&#34892;&#30340;&#20195;&#30721;. &#28982;&#21518;&#20320;&#38656;&#35201;&#23558;&#20320;&#33258;&#23450;&#20041;&#30340;<code class="literal">TransactionCallback</code>&#30340;&#23454;&#20363;&#20256;&#36882;&#32473;&#22312;<code class="literal">TransactionTemplate</code>
&#20013;&#26292;&#38706;&#20986;&#26469;&#30340;<code class="literal">execute(..)</code>&#26041;&#27861;.</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleService <span class="hl-keyword">implements</span> Service {

    <span class="hl-comment">// &#22312;&#36825;&#20010;&#23454;&#20363;&#32780;&#30340;&#25152;&#26377;&#26041;&#27861;&#20013;&#20849;&#20139;&#30340;TransactionTemplate&#21333;&#20363;</span>
    <span class="hl-keyword">private</span> <span class="hl-keyword">final</span> TransactionTemplate transactionTemplate;

    <span class="hl-comment">// &#20351;&#29992;&#26500;&#36896;&#22120;&#27880;&#20837;PlatformTransactionManager</span>
    <span class="hl-keyword">public</span> SimpleService(PlatformTransactionManager transactionManager) {
        Assert.notNull(transactionManager, <span class="hl-string">"The </span><span class="emphasis"><em>'transactionManager</em></span><span class="hl-string">' argument must not be null.");
</span>        <span class="hl-keyword">this</span>.transactionTemplate = <span class="hl-keyword">new</span> TransactionTemplate(transactionManager);
    }

    <span class="hl-keyword">public</span> Object someServiceMethod() {
        <span class="hl-keyword">return</span> transactionTemplate.execute(<span class="hl-keyword">new</span> TransactionCallback() {
            <span class="hl-comment">// &#26412;&#26041;&#27861;&#30340;&#20195;&#30721;&#22312;&#20107;&#21153;&#19978;&#19979;&#25991;&#20013;&#25191;&#34892;</span>
            <span class="hl-keyword">public</span> Object doInTransaction(TransactionStatus status) {
                updateOperation1();
                <span class="hl-keyword">return</span> resultOfUpdateOperation2();
            }
        });
    }
}</pre>

<p>&#22914;&#26524;&#27809;&#26377;&#36820;&#22238;&#20540;&#30340;&#35805;, &#20351;&#29992;&#26041;&#20415;&#30340;<code class="literal">TransactionCallbackWithoutResult</code>&#30340;&#21311;&#21517;&#31867;&#23601;&#20687;&#19979;&#38754;&#36825;&#26679;:</p>
<pre class="programlisting">transactionTemplate.execute(<span class="hl-keyword">new</span> <span class="strong"><strong>TransactionCallbackWithoutResult</strong></span>() {
    <span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> doInTransactionWithoutResult(TransactionStatus status) {
        updateOperation1();
        updateOperation2();
    }
});</pre>

<p>&#22312;&#22238;&#35843;&#26041;&#27861;&#20013;&#21487;&#20197;&#36890;&#36807;&#35843;&#29992;<code class="literal">TransactionStatus</code>&#23545;&#35937;&#25552;&#20379;&#30340;<code class="literal">setRollbackOnly()</code>&#26041;&#27861;&#26469;&#22238;&#28378;&#20107;&#21153;:</p>
<pre class="programlisting">transactionTemplate.execute(<span class="hl-keyword">new</span> TransactionCallbackWithoutResult() {

    <span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> doInTransactionWithoutResult(TransactionStatus status) {
        <span class="hl-keyword">try</span> {
            updateOperation1();
            updateOperation2();
        } <span class="hl-keyword">catch</span> (SomeBusinessExeption ex) {
            <span class="strong"><strong>status.setRollbackOnly();</strong></span>
        }
    }
});</pre>

<div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="tx-prog-template-settings" href="#tx-prog-template-settings"></a>&#25351;&#23450;&#20107;&#21153;&#35774;&#32622;</h4></div></div></div>

<p>&#20320;&#21487;&#20197;&#25351;&#23450;&#20107;&#21153;&#35774;&#32622;, &#22914;&#20256;&#25773;&#31867;&#22411;&#12289;&#38548;&#31163;&#31561;&#32423;&#12289;&#36229;&#26102;, &#37117;&#21487;&#20197;&#36890;&#36807;<code class="literal">TransactionTemplate</code>&#35774;&#32622;, &#19981;&#31649;&#26159;&#32534;&#31243;&#24335;
&#36824;&#26159;&#37197;&#32622;&#25991;&#20214;. <code class="literal">TransactionTemplate</code>&#30340;&#23454;&#20363;&#40664;&#35748;&#25317;&#26377;
<a class="link" href="transaction.html#transaction-declarative-txadvice-settings" title="11.5.5&nbsp;<tx:advice/&gt; &#35774;&#32622;">&#40664;&#35748;&#20107;&#21153;&#37197;&#32622;</a>. &#19979;&#38754;&#30340;&#20195;&#30721;&#23637;&#31034;&#20102;&#23545;
<code class="literal">TransactionTemplate</code>&#30340;&#20107;&#21153;&#37197;&#32622;&#30340;&#23450;&#21046;&#26041;&#27861;:</p>
<pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleService <span class="hl-keyword">implements</span> Service {

    <span class="hl-keyword">private</span> <span class="hl-keyword">final</span> TransactionTemplate transactionTemplate;

    <span class="hl-keyword">public</span> SimpleService(PlatformTransactionManager transactionManager) {
        Assert.notNull(transactionManager, <span class="hl-string">"The </span><span class="emphasis"><em>'transactionManager</em></span><span class="hl-string">' argument must not be null.");
</span>        <span class="hl-keyword">this</span>.transactionTemplate = <span class="hl-keyword">new</span> TransactionTemplate(transactionManager);

        <span class="hl-comment">// &#22914;&#26524;&#38656;&#35201;, &#21487;&#20197;&#23558;&#38656;&#35201;&#30340;&#37197;&#32622;&#26126;&#30830;&#30340;&#35774;&#32622;&#22312;&#36825;&#37324;</span>
        <span class="hl-keyword">this</span>.transactionTemplate.setIsolationLevel(TransactionDefinition.ISOLATION_READ_UNCOMMITTED);
        <span class="hl-keyword">this</span>.transactionTemplate.setTimeout(<span class="hl-number">30</span>); <span class="hl-comment">// 30 &#31186;</span>
        <span class="hl-comment">// &#36824;&#21487;&#20197;&#26377;&#26356;&#22810;...</span>
    }
}</pre>

<p>&#19979;&#38754;&#30340;&#20195;&#30721;&#20351;&#29992;Spring XML&#37197;&#32622;&#25991;&#20214;&#20351;&#29992;&#33258;&#23450;&#20041;&#30340;&#20107;&#21153;&#35774;&#32622;&#23450;&#20041;&#20102;&#19968;&#20010;<code class="literal">TransactionTemplate</code>.
<code class="literal">sharedTransactionTemplate</code>&#21487;&#20197;&#34987;&#27880;&#20837;&#21040;&#24456;&#22810;&#38656;&#35201;&#30340;&#26381;&#21153;&#37324;&#38754;.</p>
<pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"sharedTransactionTemplate"</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.transaction.support.TransactionTemplate"</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"isolationLevelName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"ISOLATION_READ_UNCOMMITTED"</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"timeout"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"30"</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>"</pre>

<p>&#26368;&#21518;, <code class="literal">TransactionTemplate</code>&#31867;&#30340;&#23454;&#20363;&#26102;&#32447;&#31243;&#23433;&#20840;&#30340;, &#22312;&#19968;&#20010;&#23454;&#20363;&#37324;&#38754;&#19981;&#20250;&#32500;&#25252;&#20219;&#20309;&#20250;&#35805;&#30340;&#29366;&#24577;. &#20294;&#26159;
<code class="literal">TransactionTemplate</code>&#30340;&#23454;&#20363;&#21364;<span class="emphasis"><em>&#20250;</em></span>&#32500;&#25252;&#37197;&#32622;&#30340;&#29366;&#24577;, &#25152;&#20197;&#23613;&#31649;&#35768;&#22810;&#30340;&#31867;&#21487;&#20197;&#20849;&#20139;&#19968;&#20010;
<code class="literal">TransactionTemplate</code>&#30340;&#21333;&#20363;, &#20294;&#22914;&#26524;&#26576;&#19968;&#20010;&#31867;&#38656;&#35201;<code class="literal">TransactionTemplate</code>&#25317;&#26377;&#19981;&#19968;&#26679;&#30340;&#35774;&#32622;(&#20363;&#22914;,
&#19981;&#19968;&#26679;&#30340;&#38548;&#31163;&#31561;&#32423;), &#37027;&#20040;&#20320;&#38656;&#35201;&#21019;&#24314;&#20004;&#20010;<code class="literal">TransactionTemplate</code>&#30340;&#19981;&#21516;&#23454;&#20363;.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-programmatic-ptm" href="#transaction-programmatic-ptm"></a>11.6.2&nbsp;PlatformTransactionManager&#30340;&#20351;&#29992;</h3></div></div></div>

<p>&#20320;&#20063;&#21487;&#20197;&#30452;&#25509;&#20351;&#29992;<code class="literal">org.springframework.transaction.PlatformTransactionManager</code>&#26469;&#31649;&#29702;&#20320;&#30340;&#20107;&#21153;.
&#21482;&#38656;&#31616;&#21333;&#30340;&#23558;&#20320;&#25152;&#20351;&#29992;&#30340;<code class="literal">PlatformTransactionManager</code>&#30340;&#23454;&#29616;&#31867;&#36890;&#36807;&#19968;&#20010;bean&#24341;&#29992;&#20256;&#36882;&#32473;&#20320;&#30340;bean. &#28982;&#21518;,
&#20320;&#23601;&#21487;&#20197;&#20351;&#29992;<code class="literal">TransactionDefinition</code>&#21644;<code class="literal">TransactionStatus</code>&#23545;&#35937;&#26469;&#26032;&#24314;&#12289;&#22238;&#28378;&#12289;&#25552;&#20132;&#20107;&#21153;&#20102;.</p>
<pre class="programlisting">DefaultTransactionDefinition def = <span class="hl-keyword">new</span> DefaultTransactionDefinition();
<span class="hl-comment">// &#26174;&#31034;&#25351;&#23450;&#20107;&#21153;&#21517;&#31216;&#26159;&#21482;&#33021;&#36890;&#36807;&#32534;&#31243;&#24335;&#25165;&#33021;&#20570;&#21040;&#30340;</span>
def.setName(<span class="hl-string">"SomeTxName"</span>);
def.setPropagationBehavior(TransactionDefinition.PROPAGATION_REQUIRED);

TransactionStatus status = txManager.getTransaction(def);
<span class="hl-keyword">try</span> {
    <span class="hl-comment">// &#22312;&#36825;&#37324;&#25191;&#34892;&#20320;&#30340;&#19994;&#21153;&#36923;&#36753;</span>
}
<span class="hl-keyword">catch</span> (MyException ex) {
    txManager.rollback(status);
    <span class="hl-keyword">throw</span> ex;
}
txManager.commit(status);</pre>

</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="tx-decl-vs-prog" href="#tx-decl-vs-prog"></a>11.7&nbsp;&#22312;&#32534;&#31243;&#24335;&#21644;&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;&#20013;&#36873;&#25321;</h2></div></div></div>

<p>&#32534;&#31243;&#24335;&#20107;&#21153;&#31649;&#29702;&#21482;&#22312;&#20320;&#21482;&#26377;&#24456;&#23567;&#25968;&#37327;&#30340;&#20107;&#21153;&#25805;&#20316;&#30340;&#26102;&#20505;&#26159;&#22909;&#20027;&#24847;. &#20363;&#22914;, &#22914;&#26524;&#20320;&#26377;&#19968;&#20010;web&#24212;&#29992;&#21482;&#26377;&#30830;&#23450;&#30340;&#26356;&#26032;
&#25805;&#20316;&#38656;&#35201;&#20107;&#21153;, &#20320;&#23601;&#26377;&#21487;&#33021;&#19981;&#24819;&#36890;&#36807;Spring&#25110;&#32773;&#20854;&#20182;&#25216;&#26415;&#26469;&#24314;&#31435;&#20107;&#21153;&#20195;&#29702;. &#22312;&#36825;&#31181;&#24773;&#20917;&#19979;, &#20351;&#29992;
<code class="literal">TransactionTemplate</code>&#23601;<span class="emphasis"><em>&#21487;&#33021;</em></span>&#26159;&#19968;&#20010;&#22909;&#30340;&#26041;&#27861;. &#21487;&#20197;&#26126;&#30830;&#30340;&#35774;&#32622;&#20107;&#21153;&#30340;&#21517;&#23383;&#20063;&#26159;&#21482;&#26377;&#32534;&#31243;&#24335;&#20107;&#21153;&#31649;&#29702;&#25165;&#33021;
&#20570;&#30340;&#19968;&#20123;&#20107;&#24773;&#20043;&#19968;.</p>
<p>&#21478;&#19968;&#26041;&#38754;, &#22914;&#26524;&#20320;&#26377;&#22823;&#37327;&#30340;&#20107;&#21153;&#25805;&#20316;, &#37027;&#20040;&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#36890;&#24120;&#26159;&#20540;&#24471;&#30340;. &#23427;&#35753;&#20107;&#21153;&#31649;&#29702;&#21644;&#19994;&#21153;&#36923;&#36753;&#20998;&#24320;, &#24182;&#19988;&#20063;
&#19981;&#38590;&#37197;&#32622;. &#24403;&#20351;&#29992;Spring Framework&#26102;, &#19981;&#24819;EJB CMT, &#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;&#30340;&#37197;&#32622;&#22823;&#22823;&#30340;&#20943;&#23569;&#20102;.</p>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="transaction-application-server-integration" href="#transaction-application-server-integration"></a>11.8&nbsp;&#24212;&#29992;&#26381;&#21153;&#22120;&#30340;&#29305;&#24322;&#24615;&#38598;&#25104;</h2></div></div></div>

<p>Spring&#30340;&#20107;&#21153;&#25277;&#35937;&#36890;&#24120;&#37117;&#26159;&#21644;&#24212;&#29992;&#26381;&#21153;&#22120;&#26080;&#20851;&#30340;. &#34917;&#20805;&#19968;&#19979;, Spring&#30340;<code class="literal">JtaTransactionManager</code>&#31867;, &#33021;&#22815;
&#21487;&#36873;&#22320;&#25191;&#34892;&#19968;&#20010;JNDI&#21457;&#29616;&#26469;&#33258;&#21160;&#22320;&#23450;&#20301;&#30001;&#20110;&#24212;&#29992;&#26381;&#21153;&#22120;&#25913;&#21464;&#30340;JTA&#30340;<code class="literal">UserTransaction</code>&#21644;<code class="literal">TransactionManager</code>
&#30340;&#26368;&#26032;&#23545;&#35937;. &#36890;&#36807;&#35775;&#38382;JTA&#30340;<code class="literal">TransactionManager</code>&#20801;&#35768;&#25805;&#20316;&#20107;&#21153;&#35821;&#20041;, &#20197;&#19968;&#31181;&#29305;&#27530;&#30340;&#26041;&#24335;&#26469;&#25903;&#25345;&#20107;&#21153;&#24748;&#20572;.
&#26597;&#30475;<code class="literal">JtaTransactionManager</code>&#30340;API&#26469;&#20102;&#35299;&#35814;&#24773;.</p>
<p>Spring&#30340;<code class="literal">JtaTransactionManager</code>&#26159;&#36816;&#34892;&#22312;Java EE&#24212;&#29992;&#26381;&#21153;&#22120;&#19978;&#38754;&#30340;&#26631;&#20934;&#36873;&#25321;, &#24182;&#19988;&#20063;&#26159;&#24050;&#30693;&#30340;&#33021;&#22815;&#22312;
&#25152;&#26377;&#30340;&#36890;&#29992;&#26381;&#21153;&#22120;&#19978;&#24456;&#22909;&#24037;&#20316;&#30340;. &#39640;&#32423;&#21151;&#33021;, &#22914;&#20107;&#21153;&#24748;&#28014;, &#33021;&#22815;&#22312;&#35768;&#22810;&#26381;&#21153;&#22120;&#19978;&#24456;&#22909;&#24037;&#20316;&#8212;&#8212;&#8212;&#8212;&#21253;&#25324;GlassFish,
JBoss&#20197;&#21450;Geronimo&#8212;&#8212;&#8212;&#8212;&#19981;&#38656;&#35201;&#39069;&#22806;&#30340;&#29305;&#27530;&#37197;&#32622;. &#28982;&#32780;, &#20026;&#20102;&#23436;&#25972;&#30340;&#25903;&#25345;&#20107;&#21153;&#24748;&#28014;&#21644;&#26356;&#22810;&#30340;&#39640;&#32423;&#29305;&#24615;&#30340;&#38598;&#25104;,
Spring&#20026;WebLogic Server&#21644;WebSphere&#25552;&#20379;&#20102;&#29305;&#27530;&#30340;&#36866;&#37197;&#22120;. &#20851;&#20110;&#36825;&#20123;&#36866;&#37197;&#22120;&#23558;&#22312;&#19979;&#38754;&#30340;&#31456;&#33410;&#20013;&#35752;&#35770;.</p>
<p><span class="emphasis"><em>&#22312;&#26631;&#20934;&#22330;&#26223;&#19979;, &#21253;&#25324;WebLogic Server&#21644;WebSphere, &#32771;&#34385;&#20351;&#29992;&#26041;&#20415;&#30340;<code class="literal">&lt;tx:jta-transaction-manager/&gt;</code>
&#37197;&#32622;&#20803;&#32032;.</em></span> &#24403;&#37197;&#32622;&#20043;&#21518;, &#36825;&#20010;&#20803;&#32032;&#23601;&#20250;&#33258;&#21160;&#25506;&#27979;&#24213;&#23618;&#26381;&#21153;&#22120;&#24182;&#19988;&#36873;&#25321;&#38024;&#23545;&#24179;&#21488;&#21487;&#29992;&#30340;&#26368;&#20339;&#30340;&#20107;&#21153;&#31649;&#29702;&#22120;. &#36825;&#20063;
&#24847;&#21619;&#30528;&#20320;&#19981;&#38656;&#35201;&#21333;&#29420;&#26126;&#30830;&#37197;&#32622;&#38024;&#23545;&#26381;&#21153;&#22120;&#30340;&#36866;&#37197;&#22120;&#31867;(&#20363;&#22914;&#19979;&#38754;&#23558;&#35201;&#35752;&#35770;&#30340;); &#23545;&#24212;&#30340;, &#23427;&#20204;&#26159;&#30001;&#26631;&#20934;&#30340;
<code class="literal">JtaTransactionManager</code>&#20351;&#29992;&#40664;&#35748;&#30340;&#20540;&#33258;&#21160;&#36873;&#25321;&#30340;.</p>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-application-server-integration-websphere" href="#transaction-application-server-integration-websphere"></a>11.8.1&nbsp;IBM WebSphere</h3></div></div></div>

<p>&#22312;WebSphere 6.1.0.9&#21450;&#26356;&#39640;&#29256;&#26412;&#20013;, &#25512;&#33616;&#20351;&#29992;&#30340;Spring JTA&#20107;&#21153;&#31649;&#29702;&#22120;&#26159;
<code class="literal">WebSphereUowTransactionManager</code>. &#36825;&#20010;&#29305;&#27530;&#30340;&#36866;&#37197;&#22120;&#20351;&#29992;&#20102;IBM&#30340;<code class="literal">UOWManager</code> API, &#36825;&#20010;&#23454;&#22312;WebSphere
&#24212;&#29992;&#26381;&#21153;&#22120;&#30340;6.0.2.19&#21450;&#26356;&#39640;&#29256;&#26412;&#21644;6.1.0.9&#21450;&#26356;&#39640;&#29256;&#26412;&#20013;&#21487;&#29992;&#30340;. &#36890;&#36807;&#36825;&#20010;&#36866;&#37197;&#22120;, Spring&#25552;&#20379;&#30340;&#20107;&#21153;&#24748;&#28014;
(&#22914;<code class="literal">PROPAGATION_REQUIRES_NEW</code>&#24320;&#21551;&#30340;&#25346;&#36215;/&#24674;&#22797;)&#23601;&#26159;&#30001;IBM&#23448;&#26041;&#25903;&#25345;&#30340;&#20102;!</p>
</div>
<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-application-server-integration-weblogic" href="#transaction-application-server-integration-weblogic"></a>11.8.2&nbsp;Oracle WebLogic Server</h3></div></div></div>

<p>&#22312;WebLogic Server 9.0&#25110;&#26356;&#39640;&#29256;&#26412;&#20013;, &#20320;&#36890;&#24120;&#24212;&#35813;&#20351;&#29992;<code class="literal">WebLogicJtaTransactionManager</code>&#26469;&#20195;&#26367;&#22791;&#29992;&#30340;
<code class="literal">JtaTransactionManager</code>&#31867;. &#36825;&#20010;&#29305;&#27530;&#30340;&#26377;WebLogic&#22768;&#26126;&#30340;&#27491;&#24120;&#30340;<code class="literal">JtaTransactionManager</code>&#30340;&#23376;&#31867;&#25903;&#25345;
&#20840;&#37096;&#30340;&#22312;WebLogic&#31649;&#29702;&#30340;&#29615;&#22659;&#20013;&#30340;Spring&#30340;&#20107;&#21153;&#23450;&#20041;, &#36229;&#36234;&#20102;&#26631;&#20934;&#30340;JTA&#35821;&#20041;: &#29305;&#24615;&#21253;&#25324;&#20107;&#21153;&#21517;&#31216;, &#27599;&#20010;&#20107;&#21153;&#30340;
&#38548;&#31163;&#31561;&#32423;, &#20197;&#21450;&#22312;&#25152;&#26377;&#22330;&#26223;&#20013;&#30340;&#20107;&#21153;&#30340;&#27491;&#24120;&#24674;&#22797;.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="transaction-solutions-to-common-problems" href="#transaction-solutions-to-common-problems"></a>11.9&nbsp;&#36890;&#29992;&#38382;&#39064;&#30340;&#35299;&#20915;</h2></div></div></div>

<div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-solutions-to-common-problems-wrong-ptm" href="#transaction-solutions-to-common-problems-wrong-ptm"></a>11.9.1&nbsp;&#29305;&#27530;DataSource&#20351;&#29992;&#38169;&#35823;&#30340;&#20107;&#21153;&#31649;&#29702;&#22120;</h3></div></div></div>

<p>&#20351;&#29992;<span class="emphasis"><em>&#27491;&#30830;&#30340;</em></span> <code class="literal">PlatformTransactionManager</code>&#23454;&#29616;&#21462;&#20915;&#20110;&#20320;&#23545;&#20107;&#21153;&#25216;&#26415;&#30340;&#36873;&#25321;&#21644;&#38656;&#27714;.&#20351;&#29992;&#21512;&#36866;&#20102;,
Spring Framework&#20165;&#20165;&#26159;&#25552;&#20379;&#20102;&#31616;&#21333;&#21448;&#32534;&#20889;&#30340;&#25277;&#35937;. &#22914;&#26524;&#20320;&#20351;&#29992;&#20840;&#23616;&#30340;&#20107;&#21153;, &#20320;<span class="emphasis"><em>&#24517;&#39035;</em></span>&#22312;&#25152;&#26377;&#30340;&#20107;&#21153;&#25805;&#20316;&#20013;
&#20351;&#29992;<code class="literal">org.springframework.transaction.jta.JtaTransactionManager</code>&#31867;(&#25110;&#32773;&#26159;&#23427;
<a class="link" href="transaction.html#transaction-application-server-integration" title="11.8&nbsp;&#24212;&#29992;&#26381;&#21153;&#22120;&#30340;&#29305;&#24322;&#24615;&#38598;&#25104;">&#24212;&#29992;&#26381;&#21153;&#22120;&#23450;&#20041;&#30340;&#23376;&#31867;</a>).&#21542;&#21017;&#20107;&#21153;&#22522;&#30784;&#35774;&#26045;&#20250;&#23581;&#35797;&#22312;
&#22914;&#23481;&#22120;&#30340;<code class="literal">DataSource</code>&#31561;&#36164;&#28304;&#19978;&#25191;&#34892;&#26412;&#22320;&#20107;&#21153;. &#36825;&#20123;&#26412;&#22320;&#20107;&#21153;&#19981;&#20250;&#26377;&#25928;&#26524;, &#24182;&#19988;&#22909;&#30340;&#24212;&#29992;&#26381;&#21153;&#22120;&#20250;&#25226;&#20182;&#20204;&#24403;&#20570;
&#38169;&#35823;.</p>
</div>
</div>
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="transaction-resources" href="#transaction-resources"></a>11.10&nbsp;&#26356;&#22810;&#36164;&#28304;</h2></div></div></div>

<p>&#20851;&#20110;Spring Framework&#30340;&#20107;&#21153;&#25903;&#25345;&#30340;&#26356;&#22810;&#20449;&#24687;:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
<a class="ulink" href="http://www.javaworld.com/javaworld/jw-01-2009/jw-01-spring-transactions.html" target="_top">Spring
&#30340;&#20998;&#24067;&#24335;&#20107;&#21153;, &#20351;&#29992;&#21644;&#19981;&#20351;&#29992;XA</a>&#26159;&#19968;&#20010;JavaWorld &#30340;&#28436;&#31034;, &#36890;&#36807;7&#20010;&#22312;Spring&#24212;&#29992;&#20013;&#30340;&#20998;&#24067;&#24335;&#20107;&#21153;,
Spring&#30340;David Syer&#24341;&#23548;&#20320;, 3&#20010;&#20351;&#29992;&#20102;XA, 4&#20010;&#27809;&#26377;&#20351;&#29992;.
</li><li class="listitem">
<a class="ulink" href="http://www.infoq.com/minibooks/JTDS" target="_top">Java&#20107;&#21153;&#35774;&#35745;&#31574;&#30053;</a>&#26159;&#19968;&#26412;&#26469;&#33258;
<a class="ulink" href="http://www.infoq.com/" target="_top">InfoQ</a>&#30340;&#20070;&#31821;, &#20351;&#29992;&#20102;&#24456;&#22909;&#30340;&#33410;&#22863;&#26469;&#20171;&#32461;&#20171;&#32461;&#20102;Java&#20013;&#30340;&#20107;&#21153;.
&#23427;&#20063;&#21253;&#21547;&#20102;&#24590;&#26679;&#37197;&#32622;&#21644;&#20351;&#29992;Spring Framework&#21644;EJB3&#20107;&#21153;&#30340;&#23545;&#27604;&#20363;&#23376;.
</li></ul></div>

</div>
</div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="spring-data-tier.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="spring-data-tier.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="dao.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Part&nbsp;IV.&nbsp;&#25968;&#25454;&#35775;&#38382;&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;12.&nbsp;DAO &#25903;&#25345;</td></tr></table></div></body></html>